{"version":3,"sources":["Cache.js","cont_song_desk.png","cont_song_mob.png","songs_desktop.png","songs_mobile.png","Bannertop.js","Common.js","Comments.js","RecentComments.js","Home.js","About.js","PrivacyPolicy.js","Song.js","ErrorBoundaries.js","MuteComment.js","App.js","serviceWorkerRegistration.js","index.js"],"names":["_cache","cachedFetch","url","options","cached","undefined","response","window","Response","Blob","Promise","resolve","err","console","log","fetch","then","status","ct","headers","get","match","clone","text","content","Bannertop","isServer","document","defaultHTMLHeaders","title","image","querySelector","SetHTMLHeaders","warn","ogtitle","itemtitle","img","ResetHTMLHeaders","Loading","className","FormattedNumber","value","toLocaleString","AmazonRelatedProducts","song","useState","result","setResult","page","setPage","loadingMore","setLoadingMore","useEffect","mounted","id","r","ok","json","items","length","total","map","item","AmazonRelatedItem","asin","ASIN","style","textAlign","onClick","disabled","detail_page_url","productTypeInfo","ItemAttributes","ProductGroup","Binding","href","URL","target","rel","src","SmallImage","alt","Title","Creator","ListPrice","FormattedPrice","old__AmazonRelatedItem","product_group","binding","loading","image_small","image_medium","contributor","price","release_date","SpotifySnippet","compact","useSWR","a","Error","revalidateOnFocus","data","embed_url","width","height","frameBorder","allowtransparency","allow","YouTubeSnippet","state","snippet","searched","clicked","onClickThumbnail","event","preventDefault","setState","this","props","dismounted","media","videoId","containerDiv","offsetWidth","allowFullScreen","thumbnail","thumbnails","medium","high","React","PureComponent","IntersectionLazy","render","entered","setEntered","onEnter","loadCarbonScript","carbonParent","getElementById","script","createElement","async","appendChild","RenderParagraphs","memo","dangerouslySetInnerHTML","__html","CustomTimeAgo","minPeriod","formatter","unit","suffix","epochSeconds","nextFormatter","ServerError","to","SUBMITTED_COMMENTS_STORAGE_KEY","SongComments","loadingComments","savingComment","serverError","submissionError","comments","commentsCount","submittedComments","commentSubmitted","commentEdited","commentDeleted","searchedId","replyComment","editComment","csrfToken","highlightComment","highlitComment","hasCommented","loadCSRFToken","csrf_token","catch","error","loadComments","search","submittedCommentIds","filter","submission","forEach","includes","comments_count","consolidateSubmittedComments","removeSubmittedComments","recurse","comment","not_approved","submittedComment","push","newSubmittedComments","sessionStorage","setItem","JSON","stringify","ex","removeItem","setTimeout","submitCommentHandler","_submitCommentHandler","formData","FormData","append","name","email","oid","askedWasSearchedFor","wasSearchedFor","parent","experiment","method","body","localStorage","submitted","querySelectorAll","scrollIntoView","behavior","slice","o","toPush","deleteCommentHandler","_deleteCommentHandler","filteredSubmittedComments","setEditComment","setReplyComment","clearCommentSubmitted","clearCommentEdited","clearCommentDeleted","submittedCommentStorage","getItem","parse","some","location","hash","re","parseInt","element","prevProps","Helmet","type","language","artist","ShowCommentDeleted","ShowCommentSubmitted","role","ShowCommentEdited","ShowSubmissionError","errorMessage","validationErrors","setValidationErrors","isErrorResponse","errors","Object","keys","key","message","code","toString","ShowComments","allComments","replyingComment","ShowCommentsRecursive","confirmDelete","canEdit","c","canReply","replies","editingComment","margin","focusOnMount","highlit","CommentForm","showNameEmailInputs","canSubmit","warnAboutName","textareaRef","createRef","clearComment","preview","submitHandler","trim","askWasSearchedFor","getTextareaRows","minimum","maximum","linebreaks","Math","min","max","update","current","focus","onSubmit","ShowSavingStatus","marginBottom","onChange","e","rows","ref","onBlur","htmlFor","placeholder","DisplayComment","created","notApproved","text_rendered","date","hasOwnProperty","was_searched_for","emojis","emoji","floor","random","getRandomCelebration","RecentComments","recentComments","useParams","mountedRef","useRef","setServerError","setData","getPage","p","fetchComments","useCallback","pageInt","showLoading","setShowLoading","pagination","next_page","Pagination","next","previous","ShowRecentComments","isRoot","previousSong","previousChronological","imageLink","_url","thumbnail100","geoString","geo","city","country","chronologicalDiff","rating","chronological","approved_human","score","lazyloadThumbnailImage","placeholderImage","NO_ADS","process","REACT_APP_NO_ADS","samplePlaceholders","sort","Date","getTime","Home","artistRef","languageRef","searchRef","startSearchFromLocation","q","decodeURIComponent","params","sp","URLSearchParams","year","searchExample","stateUpdate","maxLength","searchMaxLength","loadSearchAggregates","advancedSearch","searchLanguage","searchYear","artistName","startSearch","resultsPageIndex","onFocusSearch","clearInterval","placeholderSampleInterval","fillerInterval","showAutocompleteSuggestions","shareSearch","_firstFocusSearch","innerHeight","onBlurSearch","setNextSamplePlaceholder","startSamplePlaceholderInterval","onFocusArtist","showAutocompleteArtistSuggestions","onBlurArtist","sampleSearch","term","searchLanguages","searchYears","submitSearch","_fetchSearchAlternatives","parentSearch","results","keyPhrases","key_phrases","onChangeSearch","desperateSearch","originalQ","autocompleteWaitingFor","endsWith","fetchAutocompleteSuggestionsThrottled","fetchAutocompleteSuggestionsDebouncedLong","fetchAutocompleteSuggestionsDebounced","autocompleteSuggestions","autocompleteSearchSuggestions","autocompleteHighlight","onKeyDownSearch","suggestions","highlight","suggestion","fetchAutocompleteSuggestions","searchSuggestions","redirectTo","pathname","onKeyDownArtistSearch","autocompleteArtistSuggestions","autocompleteArtistHighlight","fetchAutocompleteArtistSuggestions","toggleShareSearch","toggleAdvancedSearch","withCountsLanguages","x","count","withCountsYears","onChangeLanguage","onChangeYear","onChangeArtistName","onSelectSuggestion","newText","split","pop","join","appendSuggestion","onSelectSuggestionAll","onSelectArtistSuggestion","onLoadMore","submitPhrase","keyPhrase","phrase","reloadSearch","reload","loadMoreByName","previousByNameLimit","by_name_limit","by_name_total","encodeURIComponent","by_name","displayYears","yearEnd","currentYear","getFullYear","searchResults","desperate","missing","popularityFactor","original","search_example","Boolean","searchExamples","showExamples","examples","showRecentComments","searching","searchError","slowSearch","onlyResults","debounce","throttle","_autocompleteSuggestionsCache","fetchSearchExamples","fetchRecentComments","stopSamplePlaceholderInterval","slowSearchTimer","clearTimeout","currentPlaceholder","setInterval","el","substring","newURL","currentURL","history","blur","sendSearch","allResults","popularity_factor","cacheHash","matches","search_suggestions","startsWith","languages","years","onlyIds","row","showYear","byName","SongsByName","limit","searchToggles","advancedSearchStatus","parts","advancedInput","position","onFocus","onKeyDown","ShowAutocompleteArtistSuggestions","each","ShowKeyPhrases","nothingFound","phrases","action","autoComplete","ShowMaxlengthWarning","ShowDesperateSearchWarning","ShowMissingSearchWarning","ShowAutocompleteSuggestions","ShowResultCount","SearchError","ShowExamples","SlowSearch","Component","ShowRecentCommentsWrapper","marginTop","countResults","byNameCount","ShareInput","copied","failed","hasFocused","absurlRef","absoluteUrl","readOnly","select","copy","subTitle","diff_html","capped","float","s","index","ShowAutocompleteSuggestionSong","ShowAutocompleteSuggestion","html","found","imageUrl","AutocompleteImage","fragments","fragment","i","songs","textDecoration","link","searchMeta","searchMetaStrings","language_human","n","Fragment","total_found","opened","Results","firstLoad","expandedByDefault","firstResult","Result","collapsed","itunes","amazon","textHtml","text_html","affiliateLookupStarted","onExpandClick","expand","wasCollapsed","fetchTextHTML","recordURL","songURL","SongImage","forceLoad","rest","tooltipTitle","albums","Albums","Image","loadedOnce","Set","has","setSrc","preloadImg","cb","add","decode","onload","decoding","album","About","totals","totalStats","ShowNumbers","numbers","artists","searches","PrivacyPolicy","AdTag","cf_async","unique_part","opts","Artistname","Songname","adunit_id","div_id","cf_div","setAttribute","parentNode","cf","showAsyncAd","getElementsByTagName","readyState","onreadystatechange","insertBefore","Song","notFound","songNotFound","loadSong","showLoadingSoon","timestamp","new_url","renderResult","NotFound","RenderSongHead","AmplifiedSnippet","ShareSong","ShowRelated","amplified","init","setParams","pushAdUnit","run","loadAmplifiedScript","showShare","setShowShare","shared","setShared","shareError","setShareError","navigator","share","shareData","finally","albumNames","related","setRelated","setLoading","_started","loadRelatedDebounced","categories","loadRelated","category","ShowRelatedGroup","label","AppErrorBoundary","submittedErrorId","errorInfo","stack","color","children","MuteComment","muted","ShowNotFound","ShowCommentData","NoMatch","App","recentCommentsHomepage","onSongPage","test","RotatingSubHeader","exact","path","component","SUB_HEADERS","quote","setQuote","cycle","nextIndex","indexOf","j","shuffle","isLocalhost","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","container","app","StrictMode","__song__","__related__","__results__","__songNotFound__","__totalStats__","__searchExamples__","__recentComments__","__recentCommentsHomepage__","firstElementChild","origin","ReactDOM","hydrate","addEventListener","contentType","ready","unregister","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.2cb25214.chunk.js","sourcesContent":["const _cache = {};\n\nexport const cachedFetch = (url, options) => {\n  const cached = _cache[url];\n  if (cached !== undefined) {\n    try {\n      const response = new window.Response(new Blob([cached]));\n      return Promise.resolve(response);\n    } catch (err) {\n      // Old browsers. E.g. Firefox 38.\n      console.log(\"Unable to create new window.Response\", err);\n    }\n  }\n\n  return fetch(url, options).then(response => {\n    // let's only store in cache if the content-type is\n    // JSON or something non-binary\n    if (response.status === 200) {\n      const ct = response.headers.get(\"Content-Type\");\n      if (ct && (ct.match(/application\\/json/i) || ct.match(/text\\//i))) {\n        // There is a .json() instead of .text() but\n        // we're going to store it in _cache as\n        // string anyway.\n        // If we don't clone the response, it will be\n        // consumed by the time it's returned. This\n        // way we're being un-intrusive.\n        response\n          .clone()\n          .text()\n          .then(content => {\n            _cache[url] = content;\n          });\n      }\n    }\n    return response;\n  });\n};\n","export default __webpack_public_path__ + \"static/media/cont_song_desk.299b76a7.png\";","export default __webpack_public_path__ + \"static/media/cont_song_mob.a45052cb.png\";","export default __webpack_public_path__ + \"static/media/songs_desktop.dceb29d3.png\";","export default __webpack_public_path__ + \"static/media/songs_mobile.6129f571.png\";","import React from \"react\";\r\nimport pic from \"./cont_song_desk.png\";\r\nimport mobileimg from \"./cont_song_mob.png\";\r\n\r\nfunction Bannertop(){\r\n    return(\r\n        <>\r\n        <div className=\"deskviews\">\r\n        <a href=\"http://contextbomb.com/songsearch\">\r\n          <img className=\"deskview\" src={pic} />\r\n        </a>\r\n        </div>\r\n        <div className=\"mobileviews\">\r\n        <a href=\"http://contextbomb.com/songsearch\">\r\n          <img className=\"mobileview\" src={mobileimg} />\r\n        </a>\r\n        </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Bannertop;","import React, { useEffect, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport TimeAgo from \"react-timeago\";\nimport { Waypoint } from \"react-waypoint\";\nimport useSWR from \"swr\";\n\nimport { cachedFetch } from \"./Cache\";\n\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\n// const itunesAppImage = PUBLIC_URL + \"/static/itunes-app-icon.png\";\nconst skullImage = PUBLIC_URL + \"/static/skull.png\";\n\nexport const isServer = typeof document === \"undefined\";\n\nconst defaultHTMLHeaders = {\n  title: \"Song Search - Find Songs by Lyrics\",\n  image: isServer\n    ? null\n    : document.querySelector('meta[itemprop=\"image\"]').content\n};\n\nexport const SetHTMLHeaders = function ({ title, image = null }) {\n  if (isServer) {\n    console.warn(\"SetHTMLHeaders should not be called in server mode\");\n    return;\n  }\n  /* Only set when it's different */\n  if (title !== document.title) {\n    document.title = title;\n  }\n  let ogtitle = document.querySelector('meta[property=\"og:title\"]');\n  if (ogtitle.content !== title) {\n    ogtitle.content = title;\n  }\n\n  let itemtitle = document.querySelector('meta[itemprop=\"name\"]');\n  if (itemtitle !== title) {\n    itemtitle.content = title;\n  }\n  let img = document.querySelector('meta[itemprop=\"image\"]');\n  if (img.content !== image) {\n    img.content = image;\n  }\n};\n\nexport const ResetHTMLHeaders = function () {\n  SetHTMLHeaders(defaultHTMLHeaders);\n};\n\nexport const Loading = ({ text }) => {\n  return (\n    <div className=\"loading\" title={text}>\n      <div className=\"cssload-wrapper\">\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n      </div>\n      <p>{text}</p>\n    </div>\n  );\n};\n\nexport function FormattedNumber({ value }) {\n  return value.toLocaleString();\n}\n\nexport function AmazonRelatedProducts({ song }) {\n  const [result, setResult] = useState(null);\n  const [page, setPage] = useState(1);\n  const [loadingMore, setLoadingMore] = useState(false);\n\n  useEffect(() => {\n    if (page > 1) {\n      setLoadingMore(true);\n    }\n  }, [page]);\n\n  useEffect(() => {\n    let mounted = true;\n    let url = `/api/song/${song.id}/amazon?v=5`;\n    if (page > 1) {\n      url += `&page=${page}`;\n    }\n    fetch(url).then((r) => {\n      if (!mounted) return;\n      if (r.ok) {\n        r.json().then((result) => {\n          setResult(result);\n          setLoadingMore(false);\n        });\n      }\n    });\n    return () => {\n      mounted = false;\n    };\n  }, [song, page]);\n\n  function loadMore() {\n    setPage(page + 1);\n  }\n\n  if (!result || !result.items.length) {\n    return null;\n  }\n  const { items, total } = result;\n  return (\n    <div className=\"amazon-related-products\">\n      <h4>Relevant on Amazon.com</h4>\n      {items.map((item) => (\n        <AmazonRelatedItem key={item.asin || item.ASIN} item={item} />\n      ))}\n      <small>As an Amazon Associate I earn from qualifying purchases.</small>\n      {total > items.length && (\n        <p style={{ textAlign: \"right\" }}>\n          <button\n            className=\"btn btn-default btn-sm\"\n            onClick={loadMore}\n            disabled={loadingMore}\n          >\n            {loadingMore ? \"Loading...\" : \"Load more products...\"}\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction AmazonRelatedItem({ item }) {\n  if (!item.detail_page_url) {\n    // Later in 2020, this can be replaced with just `return null`\n    return old__AmazonRelatedItem({ item });\n  }\n\n  let productTypeInfo = item.product_group;\n  if (productTypeInfo && item.binding && productTypeInfo !== item.binding) {\n    productTypeInfo += `, ${item.binding}`;\n  }\n  return (\n    <div className=\"media amazon-item\">\n      <div className=\"media-left media-top\">\n        <a\n          href={item.detail_page_url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          <img\n            className=\"media-object\"\n            loading=\"lazy\"\n            src={item.image_small || item.image_medium}\n            alt=\"Product\"\n          />\n        </a>\n      </div>\n      <div className=\"media-body\">\n        <h4 className=\"media-heading\">\n          <a\n            href={item.detail_page_url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            {item.title}\n          </a>\n        </h4>\n        {item.contributor && (\n          <p>\n            By <b>{item.contributor}</b>\n          </p>\n        )}\n        <p>\n          {item.price && <b className=\"price\">{item.price}</b>}\n          {productTypeInfo}\n          <br />\n          {item.release_date && <span>Release date: {item.release_date}</span>}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nfunction old__AmazonRelatedItem({ item }) {\n  let productTypeInfo = item.ItemAttributes.ProductGroup;\n  if (\n    productTypeInfo &&\n    item.ItemAttributes.Binding &&\n    productTypeInfo !== item.ItemAttributes.Binding\n  ) {\n    productTypeInfo += `, ${item.ItemAttributes.Binding}`;\n  }\n  return (\n    <div className=\"media amazon-item\">\n      <div className=\"media-left media-top\">\n        <a href={item.URL} target=\"_blank\" rel=\"noopener noreferrer\">\n          <img className=\"media-object\" src={item.SmallImage} alt=\"Product\" />\n        </a>\n      </div>\n      <div className=\"media-body\">\n        <h4 className=\"media-heading\">\n          <a href={item.URL} target=\"_blank\" rel=\"noopener noreferrer\">\n            {item.Title}\n          </a>\n        </h4>\n        {item.Creator && (\n          <p>\n            By <b>{item.Creator}</b>\n          </p>\n        )}\n        <p>\n          {item.ItemAttributes.ListPrice && (\n            <b className=\"price\">\n              {item.ItemAttributes.ListPrice.FormattedPrice}\n            </b>\n          )}\n          {productTypeInfo}\n        </p>\n      </div>\n    </div>\n  );\n}\n\n// export function Affiliates({ song }) {\n//   console.log(\"IS THIS STILL USED?!??!?!?!?!\");\n//   // const [amazon, setAmazon] = React.useState(null);\n//   const [itunes, setItunes] = React.useState(null);\n\n//   useEffect(() => {\n//     let dismounted = false;\n//     const url = `/api/song/${song.id}/affiliate/itunes`;\n//     cachedFetch(url).then((response) => {\n//       if (response.ok) {\n//         if (dismounted) {\n//           return;\n//         }\n//         response.json().then((results) => {\n//           if (\n//             results.itunes &&\n//             results.itunes.matches &&\n//             results.itunes.matches.length\n//           ) {\n//             setItunes(results.itunes);\n//           }\n//         });\n//       } else {\n//         console.warn(response);\n//       }\n//     });\n//     return () => {\n//       dismounted = true;\n//     };\n//   }, [song]);\n\n//   if (isServer) {\n//     return null;\n//   }\n//   return (\n//     <>\n//       {/* XXX This causes a double-render even though 'song' hasn't changed!! */}\n//       <AmazonRelatedProducts song={song} />\n//       <ITunesBadge itunes={itunes} />\n//     </>\n//   );\n// }\n\n// const ITunesBadge = React.memo(({ itunes }) => {\n//   if (!itunes) {\n//     return null;\n//   }\n//   if (!itunes.matches.length) {\n//     return null;\n//   }\n\n//   const first = itunes.matches[0];\n//   const trackURL = `${first.trackViewUrl}&at=${itunes.token}`;\n//   const trackLink = (\n//     <p>\n//       <a href={trackURL}>\n//         <b>{first.trackName}</b>\n//         {\" by \"}\n//         <b>{first.artistName}</b>\n//         {first.trackPrice &&\n//           first.trackPrice > 0.0 &&\n//           ` ($${first.trackPrice})`}\n//       </a>\n//     </p>\n//   );\n\n//   const trackIcon = (\n//     <p style={{ float: \"left\", marginBottom: 15 }}>\n//       <a href={trackURL} className=\"app-icon\" title={first.trackName}>\n//         <img src={itunesAppImage} alt=\"iTunes\" />\n//       </a>\n//     </p>\n//   );\n\n//   let albumLink = null;\n//   if (first.collectionName) {\n//     const collectionURL = `${first.collectionViewUrl}&at=${itunes.token}`;\n//     albumLink = (\n//       <p>\n//         <a href={collectionURL}>\n//           On album <b>{first.collectionName}</b>\n//           {first.collectionPrice &&\n//             first.collectionPrice > 0 &&\n//             ` ($${first.collectionPrice})`}\n//         </a>\n//       </p>\n//     );\n//   }\n\n//   let preview = null;\n//   if (first.previewUrl) {\n//     preview = (\n//       <div style={{ clear: \"left\", textAlign: \"center\" }}>\n//         <b>iTunes</b> Preview\n//         <br />\n//         <audio controls preload=\"none\" src={first.previewUrl} />\n//       </div>\n//     );\n//   }\n\n//   return (\n//     <div style={{ marginTop: 30, marginBottom: 20 }}>\n//       <h4>On Apple iTunes</h4>\n//       {trackIcon}\n//       {trackLink}\n//       {albumLink}\n//       {preview}\n//     </div>\n//   );\n// });\n\nexport function SpotifySnippet({ song, compact = true }) {\n  const { data } = useSWR(\n    `/api/song/${song.id}/spotify`,\n    async (url) => {\n      const r = await fetch(url);\n      if (!r.ok) {\n        if (process.env.NODE_ENV === \"development\") {\n          console.warn(`${r.status} on ${url}`);\n        }\n        throw new Error(`${r.status} on ${url}`);\n      }\n      return await r.json();\n    },\n    { revalidateOnFocus: false }\n  );\n  if (!data) {\n    return null;\n  }\n  return (\n    <div className=\"spotify\">\n      <h4>On Spotify</h4>\n      <div style={{ textAlign: \"center\" }}>\n        {/* https://developer.spotify.com/documentation/widgets/generate/embed/ */}\n        <iframe\n          src={data.embed_url}\n          width=\"300\"\n          height={compact ? 80 : 380}\n          frameBorder=\"0\"\n          allowtransparency=\"true\"\n          allow=\"encrypted-media\"\n        ></iframe>\n      </div>\n    </div>\n  );\n}\n\nexport class YouTubeSnippet extends React.PureComponent {\n  state = {\n    snippet: null,\n    searched: false,\n    clicked: false\n  };\n\n  componentDidMount() {\n    const id = this.props.song.id;\n    let url = `/api/song/${id}/youtube`;\n    return cachedFetch(url).then((r) => {\n      if (this.dismounted) {\n        return;\n      }\n      if (r.status !== 200) {\n        console.warn(r.status, \"loading\", url);\n      } else {\n        r.json().then((response) => {\n          if (response.snippet) {\n            this.setState({ snippet: response.snippet, searched: true });\n          } else {\n            this.setState({ searched: true });\n          }\n        });\n      }\n    });\n  }\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  onClickThumbnail = (event) => {\n    event.preventDefault();\n    this.setState({ clicked: true });\n  };\n\n  render() {\n    const { clicked, snippet } = this.state;\n    if (isServer || snippet === null) {\n      return null;\n    }\n    let media;\n    const videoId = snippet.videoId;\n    const href = `https://www.youtube.com/watch?v=${videoId}`;\n    if (clicked) {\n      // const src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0&amp;showinfo=0`\n      const src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`;\n      let width = 335;\n      let height = 178; // =335/(16/9)\n      const containerDiv = document.querySelector(\"div.result\");\n      if (containerDiv && containerDiv.offsetWidth > 335) {\n        width = 560;\n        height = 315;\n      }\n      media = (\n        <iframe\n          width={width}\n          height={height}\n          title={snippet.title || \"YouTube Snippet\"}\n          src={src}\n          frameBorder={0}\n          allow=\"autoplay; encrypted-media\"\n          allowFullScreen\n        />\n      );\n    } else {\n      let thumbnail = snippet.thumbnails.medium;\n      const containerDiv = document.querySelector(\"div.result\");\n      if (containerDiv && containerDiv.offsetWidth > 335) {\n        thumbnail = snippet.thumbnails.high;\n      }\n      media = (\n        <a href={href} onClick={this.onClickThumbnail}>\n          <img\n            src={thumbnail.url}\n            width={thumbnail.width}\n            height={thumbnail.height}\n            title=\"Click to load video\"\n            alt=\"Video thumbnail\"\n            loading=\"lazy\"\n          />\n        </a>\n      );\n    }\n    return (\n      <div className=\"youtube\">\n        <h4>\n          YouTube{\" \"}\n          {!clicked ? (\n            <small onClick={this.onClickThumbnail}>Click to load</small>\n          ) : null}\n        </h4>\n        <div style={{ textAlign: \"center\" }}>\n          {media}\n          <p>\n            <small>\n              <a href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n                Watch on YouTube\n              </a>\n            </small>\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport function IntersectionLazy({ render }) {\n  const [entered, setEntered] = useState(false);\n  function onEnter() {\n    setEntered(true);\n  }\n  if (entered) {\n    return render();\n    // return <YouTubeSnippet song={song} />;\n  }\n  return <Waypoint onEnter={onEnter} />;\n}\n\n// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\n\n// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\n\nexport function loadCarbonScript() {\n  const carbonParent = document.getElementById(\"carbonadsouter\");\n  if (carbonParent) {\n    if (!carbonParent.querySelector(\"script\")) {\n      const script = document.createElement(\"script\");\n      script.id = \"_carbonads_js\";\n      script.src =\n        \"https://cdn.carbonads.com/carbon.js?serve=CK7DCK7W&placement=songsearch\";\n      script.async = true;\n      carbonParent.appendChild(script);\n    }\n  }\n}\n\nexport function loadAdsenseScript() {\n  const carbonParent = document.getElementById(\"carbonadsouter\");\n  if (carbonParent) {\n    if (!carbonParent.querySelector(\"script\")) {\n      const script = document.createElement(\"script\");\n      script.id = \"_carbonads_js\";\n      script.src =\n        \"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\";\n      script.async = true;\n      script.setAttribute('data-ad-client', 'ca-pub-8561605615946624');\n      carbonParent.appendChild(script);\n    }\n  }\n}\n\nexport function loadAmplifiedScript({ song, artist }) {\n  const parent = document.getElementById(\"amplifiedouter\");\n  if (parent) {\n    if (!parent.querySelector(\"script\")) {\n      window.amplified = window.amplified || { init: [] };\n      window.amplified.init.push(() => {\n        amplified.setParams({\n          artist,\n          song\n        });\n        amplified.pushAdUnit(100003500);\n        amplified.run();\n      });\n      const script = document.createElement(\"script\");\n      script.id = \"_amplified_js\";\n      script.src = \"https://srv.clickfuse.com/ads/ads.js\";\n      script.async = true;\n      parent.appendChild(script);\n    }\n  }\n}\n\nexport const RenderParagraphs = React.memo(({ text }) => {\n  return <blockquote dangerouslySetInnerHTML={{ __html: text }} />;\n});\n\nexport function CustomTimeAgo(props) {\n  return (\n    <TimeAgo\n      // Since the smallest granularity is 1 min, no point making the\n      // setInterval any smaller than this.\n      minPeriod={60}\n      formatter={(value, unit, suffix, epochSeconds, nextFormatter) => {\n        if (unit === \"second\") {\n          return \"seconds ago\";\n        }\n        return nextFormatter(value, unit, suffix, epochSeconds);\n      }}\n      {...props}\n    />\n  );\n}\n\nexport function ServerError() {\n  return (\n    <div className=\"not-found\">\n      <h3>Server Error</h3>\n      <p>\n        <img alt=\"Skull\" src={skullImage} />\n      </p>\n      <p>\n        Most likely a <b>temporary problem</b> which will go away if you{\" \"}\n        <b>reload this page soon</b>.\n      </p>\n      <p>\n        <Link to=\"/\">Back to the home page</Link>\n      </p>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport { cachedFetch } from \"./Cache\";\nimport { CustomTimeAgo, isServer } from \"./Common\";\nimport \"./Comments.css\";\nimport { Helmet } from \"react-helmet\";  \n\n\nconst SUBMITTED_COMMENTS_STORAGE_KEY = \"submittedComments\";\n\nexport class SongComments extends React.PureComponent {\n  state = {\n    loadingComments: false,\n    savingComment: false,\n    serverError: null,\n    submissionError: null,\n    comments: this.props.comments || null,\n    commentsCount: this.props.commentsCount || null,\n    submittedComments: [],\n    commentSubmitted: null,\n    commentEdited: null,\n    commentDeleted: null,\n    searchedId: this.props.searchedId,\n    replyComment: null,\n    editComment: null,\n    csrfToken: null,\n    highlightComment: null,\n    highlitComment: null,\n    hasCommented: false\n  };\n\n  componentDidMount() {\n    // If you're here, you're a browser and no a server rendering.\n    let submittedCommentStorage = \"[]\";\n    try {\n      submittedCommentStorage =\n        sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY) || \"[]\";\n    } catch (ex) {\n      console.warn(\n        \"'sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY)' didn't work\"\n      );\n    }\n    const submittedComments = JSON.parse(submittedCommentStorage);\n    if (submittedComments.length) {\n      // Definitely load comments. Even if you arrived here with the comments\n      // already server-side rendered.\n      // Because, this call to loadingComments might be potentially different.\n\n      // If you have commented on this song before, update that in state.\n      let hasCommented = false;\n      const { song } = this.props;\n      if (song) {\n        hasCommented = submittedComments.some(\n          (comment) => comment.song && comment.song === song.id\n        );\n      }\n\n      this.setState(\n        {\n          submittedComments,\n          hasCommented,\n          loadingComments: !this.state.comments\n        },\n        this.loadComments\n      );\n    } else {\n      // If the comments were already loaded, we only need the csrfToken.\n      if (!this.state.comments) {\n        this.setState({ loadingComments: true }, this.loadComments);\n      } else {\n        // We just need a new csrfToken\n        this.loadCSRFToken();\n      }\n    }\n\n    if (window.location.hash) {\n      const re = /c(\\d+)$/;\n      if (window.location.hash.match(re)) {\n        const id = parseInt(window.location.hash.match(re)[1], 10);\n        this.setState({ highlitComment: id }, () => {\n          window.setTimeout(() => {\n            if (!this.dismounted) {\n              const element = document.querySelector(\n                `#c${this.state.highlitComment}`\n              );\n              if (element && element.scrollIntoView) {\n                element.scrollIntoView({\n                  behavior: \"smooth\"\n                });\n              }\n            }\n          }, 1000);\n\n          window.setTimeout(() => {\n            if (!this.dismounted && this.state.highlitComment === id) {\n              this.setState({ highlitComment: null });\n            }\n          }, 10 * 1000);\n        });\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.song !== this.props.song) {\n      this.setState(\n        { loadingComments: true, comments: null, commentsCount: null },\n        this.loadComments\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  loadCSRFToken = () => {\n    let url = \"/api/comments?csrftoken=1\";\n    fetch(url)\n      .then((r) => {\n        if (this.dismounted) return;\n        if (r.ok) {\n          return r.json().then((result) => {\n            this.setState({\n              csrfToken: result.csrf_token\n            });\n          });\n        } else {\n          this.setState({ serverError: r });\n        }\n      })\n      .catch((error) => {\n        if (this.dismounted) return;\n        this.setState({ serverError: error });\n      });\n  };\n\n  loadComments = () => {\n    const { song, search } = this.props;\n    const { submittedComments, commentEdited } = this.state;\n    let submittedCommentIds = [];\n    let url = \"/api/comments\";\n    if (song) {\n      url += `?song=${song.id}`;\n    } else if (search) {\n      url += `?search=${search.id}`;\n    } else {\n      // throw new Error(\"Don't know how to do this outside of song\");\n    }\n\n    if (submittedComments.length) {\n      submittedCommentIds = submittedComments\n        .filter((submission) => {\n          if (song) {\n            return submission.song === song.id;\n          } else if (search) {\n            return submission.search === search.id;\n          } else {\n            return !submission.song && !submission.search;\n          }\n        })\n        .map((submission) => submission.id);\n    }\n\n    submittedCommentIds.forEach((id) => {\n      url += url.includes(\"?\") ? \"&\" : \"?\";\n      url += `submitted=${id}`;\n    });\n\n    if (commentEdited) {\n      // Just to extra-bust the cache\n      url += url.includes(\"?\") ? \"&\" : \"?\";\n      url += `edited=${commentEdited.id}`;\n    }\n\n    let fetchFunc;\n    if (commentEdited && submittedCommentIds.length) {\n      // Don't use the caching one\n      fetchFunc = fetch;\n    } else {\n      fetchFunc = cachedFetch;\n    }\n\n    fetchFunc(url)\n      .then((r) => {\n        if (this.dismounted) return;\n        this.setState({ loadingComments: false });\n        if (r.ok) {\n          return r.json().then((result) => {\n            this.setState(\n              {\n                csrfToken: result.csrf_token,\n                comments: result.comments,\n                commentsCount: result.comments_count,\n                loadingComments: false\n              },\n              this.consolidateSubmittedComments\n            );\n          });\n        } else {\n          this.setState({ serverError: r, loadingComments: false });\n        }\n      })\n      .catch((error) => {\n        if (this.dismounted) return;\n        this.setState({ serverError: error, loadingComments: false });\n      });\n  };\n\n  consolidateSubmittedComments = () => {\n    const { comments } = this.state;\n    let { submittedComments } = this.state;\n    if (submittedComments.length && comments[\"\"] && comments[\"\"].length) {\n      // If any of your submitted comments is now approved, we need to remove\n      // it from sessionStorage.\n      const removeSubmittedComments = [];\n      function recurse(comments) {\n        comments.forEach((comment) => {\n          if (!comment.not_approved) {\n            // Add to removeSubmittedComments only if this is one of the ones\n            // you submitted.\n            submittedComments.forEach((submittedComment) => {\n              if (submittedComment.id === comment.id) {\n                removeSubmittedComments.push(submittedComment.id);\n              }\n            });\n          }\n          if (comments[comment.id]) {\n            recurse(comments[comment.id]);\n          }\n        });\n      }\n      recurse(comments[\"\"]);\n\n      if (removeSubmittedComments.length) {\n        const newSubmittedComments = submittedComments.filter(\n          (submittedComment) => {\n            return !removeSubmittedComments.includes(submittedComment.id);\n          }\n        );\n        this.setState({ submittedComments: newSubmittedComments }, () => {\n          if (this.state.submittedComments.length) {\n            // Update\n            try {\n              sessionStorage.setItem(\n                SUBMITTED_COMMENTS_STORAGE_KEY,\n                JSON.stringify(this.state.submittedComments)\n              );\n            } catch (ex) {\n              console.warn(\n                \"'sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY)' did't work\"\n              );\n            }\n          } else {\n            // Reset\n            try {\n              sessionStorage.removeItem(SUBMITTED_COMMENTS_STORAGE_KEY);\n            } catch (ex) {}\n          }\n        });\n      }\n    }\n  };\n\n  highlightComment = (id) => {\n    let { highlitComment } = this.state;\n    if (highlitComment && highlitComment === id) {\n      highlitComment = null;\n    } else {\n      highlitComment = id;\n    }\n    this.setState({ highlitComment }, () => {\n      window.setTimeout(() => {\n        if (!this.dismounted && this.state.highlitComment === id) {\n          this.setState({ highlitComment: null });\n        }\n      }, 10 * 1000);\n    });\n  };\n\n  submitCommentHandler = (data) => {\n    this.setState({ savingComment: true }, () => {\n      this._submitCommentHandler(data).then(() => {\n        this.setState({ savingComment: false });\n      });\n    });\n  };\n  _submitCommentHandler = async (data) => {\n    let response;\n    const { song, search } = this.props;\n    const { submittedComments, csrfToken } = this.state;\n    if (!csrfToken) {\n      throw new Error(\"No csrfToken prepared\");\n    }\n    const formData = new FormData();\n    formData.append(\"csrfmiddlewaretoken\", csrfToken);\n    formData.append(\"text\", data.comment);\n    formData.append(\"name\", data.name);\n    formData.append(\"email\", data.email);\n\n    if (submittedComments.length) {\n      submittedComments\n        .filter((submission) => {\n          if (song) {\n            return submission.song === song.id;\n          } else if (search) {\n            return submission.search === search.id;\n          } else {\n            return !submission.song && !submission.search;\n          }\n        })\n        .forEach((submission) => {\n          formData.append(\"submitted\", submission.id);\n        });\n    }\n\n    if (data.editComment) {\n      formData.append(\"id\", data.editComment.id);\n      if (!data.editComment.oid) {\n        throw new Error(\"Can't edit if you don't have the oid\");\n      }\n      formData.append(\"oid\", data.editComment.oid);\n    }\n    if (data.replyComment) {\n      formData.append(\"parent\", data.replyComment.id);\n    }\n    if (data.askedWasSearchedFor) {\n      formData.append(\"was_searched_for\", data.wasSearchedFor || false);\n    }\n    if (this.state.searchedId) {\n      formData.append(\"search\", this.state.searchedId || null);\n    }\n    if (data.parent) {\n      formData.append(\"parent\", data.parent || null);\n    }\n    formData.append(\"experiment\", data.experiment || {});\n\n    if (song) {\n      formData.append(\"song\", song.id);\n    } else if (search) {\n      formData.append(\"search\", search.id);\n    } else {\n      // throw new Error(\"Don't know how to do this outside of song\");\n    }\n\n    try {\n      response = await fetch(\"/api/comments\", {\n        method: \"POST\",\n        body: formData\n      });\n      if (response.ok) {\n        // If posted a comment because this *was* the song you\n        // searched for, let's kill that not to stop asking that question.\n        if (this.state.searchedId) {\n          try {\n            localStorage.removeItem(\"searched\");\n          } catch (ex) {\n            console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");\n          }\n        }\n\n        const result = await response.json();\n\n        if (data.editComment) {\n          return this.setState({\n            searchedId: null,\n            commentEdited: result.submitted,\n            submissionError: null,\n            commentSubmitted: null,\n            editComment: null,\n            replyComment: null,\n            comments: result.comments,\n            commentsCount: result.comments_count\n          });\n        } else {\n          return this.setState(\n            {\n              searchedId: null,\n              submissionError: null,\n              commentEdited: null,\n              commentSubmitted: result.submitted,\n              commentDeleted: null,\n              replyComment: null,\n              comments: result.comments,\n              commentsCount: result.comments_count\n            },\n            () => {\n              // Only do this if there is only exactly 1 of these in the DOM.\n              // The reason why is that when repeatedly injecting the <SongComments>\n              // components in multiple places, you might have different ones\n              // for different expanded songs.\n              if (document.querySelectorAll(\".alert-comment\").length === 1) {\n                document\n                  .querySelector(\".alert-comment.alert-success\")\n                  .scrollIntoView({ behavior: \"smooth\" });\n              }\n\n              const { commentSubmitted } = this.state;\n              const { song, search } = this.props;\n\n              this.highlightComment(commentSubmitted.id);\n\n              const submittedComments = this.state.submittedComments.slice(0);\n              // If you accidentally double-clicked to submit twice.\n              // Or, just wrote the exact same comment twice, the server\n              // won't create another record but it will respond as if it worked\n              // so we need to check first that we don't already have\n              // this 'commentSubmitted.id` already.\n              if (\n                !submittedComments\n                  .map((o) => o.id)\n                  .filter((id) => id === commentSubmitted.id).length\n              ) {\n                const toPush = {\n                  id: commentSubmitted.id,\n                  oid: commentSubmitted.oid\n                };\n                if (song) {\n                  toPush.song = song.id;\n                } else if (search) {\n                  toPush.search = search.id;\n                }\n                submittedComments.push(toPush);\n              }\n              this.setState(\n                { submittedComments, submissionError: null },\n                () => {\n                  this.loadComments();\n                  try {\n                    sessionStorage.setItem(\n                      SUBMITTED_COMMENTS_STORAGE_KEY,\n                      JSON.stringify(this.state.submittedComments)\n                    );\n                  } catch (ex) {}\n                }\n              );\n            }\n          );\n        }\n      } else {\n        return this.setState({ submissionError: response });\n      }\n    } catch (error) {\n      console.warn(\"Submission failed:\", error);\n      return this.setState({ submissionError: error });\n    }\n  };\n\n  deleteCommentHandler = (comment) => {\n    this.setState({ savingComment: true }, () => {\n      this._deleteCommentHandler(comment).then(() => {\n        this.setState({ savingComment: false });\n      });\n    });\n  };\n\n  _deleteCommentHandler = async (comment) => {\n    let response;\n    const formData = new FormData();\n    if (!comment.oid) {\n      throw new Error(\"Can't edit if you don't have the oid\");\n    }\n    formData.append(\"id\", comment.id);\n    formData.append(\"oid\", comment.oid);\n    const url = \"/api/comments/delete\";\n    try {\n      response = await fetch(url, {\n        method: \"POST\",\n        body: formData\n      });\n    } catch (ex) {\n      return this.setState({ submissionError: ex });\n    }\n    if (!response.ok) {\n      return this.setState({ submissionError: response });\n    }\n    return this.setState(\n      {\n        commentDeleted: comment,\n        commentEdited: null,\n        editComment: null,\n        submissionError: null\n      },\n      () => {\n        // Before we load comments, remove this one from localStorage\n        const submittedComments = this.state.submittedComments;\n        const filteredSubmittedComments = submittedComments.filter(\n          (submission) => submission.id !== comment.id\n        );\n        this.setState({ submittedComments: filteredSubmittedComments }, () => {\n          this.loadComments();\n          try {\n            sessionStorage.setItem(\n              SUBMITTED_COMMENTS_STORAGE_KEY,\n              JSON.stringify(this.state.submittedComments)\n            );\n          } catch (ex) {}\n        });\n      }\n    );\n  };\n\n  setEditComment = (comment) => {\n    this.setState({ editComment: comment });\n  };\n\n  setReplyComment = (comment) => {\n    if (this.state.replyComment && this.state.replyComment.id === comment.id) {\n      this.setState({\n        replyComment: null,\n        highlitComment: null,\n        commentEdited: null\n      });\n    } else {\n      this.setState({\n        replyComment: comment,\n        highlitComment: comment.id,\n        commentEdited: null\n      });\n    }\n  };\n\n  clearCommentSubmitted = () => {\n    this.setState({ commentSubmitted: null });\n  };\n\n  clearCommentEdited = () => {\n    this.setState({ commentEdited: null });\n  };\n\n  clearCommentDeleted = () => {\n    this.setState({ commentDeleted: null });\n  };\n\n  render() {\n    const { song } = this.props;\n    const {\n      comments,\n      commentsCount,\n      submissionError,\n      commentSubmitted,\n      commentEdited,\n      commentDeleted,\n      submittedComments,\n      searchedId,\n      editComment,\n      replyComment,\n      savingComment,\n      highlitComment,\n      hasCommented,\n      csrfToken\n    } = this.state;\n\n    return (\n      \n      <div className=\"comments masters song-comments\">\n             <Helmet>  \n             <script type=\"text/javascript\" language=\"javascript\" src=\"https://live.primis.tech/live/liveView.php?s=113482\"></script>\n             </Helmet>   \n        <h3>\n          Song Comments {commentsCount ? <span>({commentsCount})</span> : null}\n          <br />\n          <small>\n            On <b>{song.name}</b> <span className=\"by\">by</span>{\" \"}\n            {song.artist.name}\n          </small>\n        </h3>\n\n        <ShowCommentDeleted\n          commentDeleted={commentDeleted}\n          clearCommentDeleted={this.clearCommentDeleted}\n        />\n\n        <ShowComments\n          {...this.props}\n          submissionError={submissionError}\n          comments={comments}\n          editComment={editComment}\n          replyComment={replyComment}\n          searchedId={searchedId}\n          setEditComment={this.setEditComment}\n          setReplyComment={this.setReplyComment}\n          submitCommentHandler={this.submitCommentHandler}\n          deleteCommentHandler={this.deleteCommentHandler}\n          commentSubmitted={commentSubmitted}\n          commentEdited={commentEdited}\n          submittedComments={submittedComments}\n          savingComment={savingComment}\n          highlitComment={highlitComment}\n          highlightComment={this.highlightComment}\n          clearCommentSubmitted={this.clearCommentSubmitted}\n          clearCommentEdited={this.clearCommentEdited}\n          csrfToken={csrfToken}\n          hasCommented={hasCommented}\n        />\n      </div>\n    );\n  }\n}\n\nfunction ShowCommentSubmitted({ commentSubmitted, clearCommentSubmitted }) {\n  if (!commentSubmitted) return null;\n  return (\n    <div\n      className=\"alert-comment alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentSubmitted();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment submitted. Thank you!</b>\n      </p>\n      <p>It needs to be moderated before publishing.</p>\n    </div>\n  );\n}\n\nfunction ShowCommentEdited({ commentEdited, clearCommentEdited }) {\n  if (!commentEdited) return null;\n  return (\n    <div\n      className=\"alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentEdited();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment edited.</b>\n      </p>\n      <p>You can keep editing it until it gets approved.</p>\n    </div>\n  );\n}\n\nfunction ShowCommentDeleted({ commentDeleted, clearCommentDeleted }) {\n  if (!commentDeleted) return null;\n  return (\n    <div\n      className=\"alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentDeleted();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment removed.</b>\n      </p>\n      <p>Feel free to write a new comment.</p>\n    </div>\n  );\n}\n\nfunction ShowSubmissionError({ submissionError }) {\n  const [validationErrors, setValidationErrors] = useState({});\n\n  let isErrorResponse = false;\n  if (!isServer) {\n    try {\n      isErrorResponse = submissionError instanceof window.Response;\n    } catch (err) {\n      // Old browsers. E.g. Firefox 38.\n      console.log(\"instanceof window.Response did not work:\", err);\n    }\n  }\n\n  useEffect(() => {\n    if (!isServer && isErrorResponse && submissionError.status === 400) {\n      submissionError.json().then((data) => {\n        setValidationErrors(data.errors);\n      });\n    }\n  }, [submissionError, isErrorResponse]);\n\n  if (!submissionError) return null;\n\n  let errorMessage;\n  if (!isServer && isErrorResponse) {\n    if (submissionError.status === 400) {\n      errorMessage = (\n        <div>\n          <p>\n            <b>Something's not right with the submission</b>\n          </p>\n          {Object.keys(validationErrors).map((key) => {\n            return (\n              <p key={key}>\n                <b>{key}:</b>{\" \"}\n                {validationErrors[key].map((err) => (\n                  <span key={err.message + err.code}>\n                    <i>{err.message}</i>{\" \"}\n                    {err.code ? (\n                      <span>\n                        (<code>{err.code}</code>)\n                      </span>\n                    ) : null}\n                  </span>\n                ))}\n              </p>\n            );\n          })}\n        </div>\n      );\n    } else if (submissionError.status >= 500) {\n      errorMessage = (\n        <p>Server error. Perhaps simply try again a little later.</p>\n      );\n    } else {\n      errorMessage = (\n        <p>The server basically failed to process the submission.</p>\n      );\n    }\n  } else {\n    errorMessage = (\n      <p>\n        <code>{submissionError.toString()}</code>\n      </p>\n    );\n  }\n\n  return (\n    <div className=\"search-error\">\n      <h4>Sorry, an error occured</h4>\n      {errorMessage}\n    </div>\n  );\n}\n\nclass ShowComments extends React.PureComponent {\n  render() {\n    const { comments, replyComment, editComment } = this.props;\n    return (\n      <>\n        {comments && comments[\"\"] && (\n          <ShowCommentsRecursive\n            {...this.props}\n            allComments={comments}\n            comments={comments[\"\"]}\n          />\n        )}\n        {!replyComment && !editComment && (\n          <CommentForm replyingComment={false} {...this.props} />\n        )}\n      </>\n    );\n  }\n}\n\nclass ShowCommentsRecursive extends React.PureComponent {\n  state = {\n    confirmDelete: false\n  };\n\n  render() {\n    const { confirmDelete } = this.state;\n    const {\n      replyComment,\n      editComment,\n      setEditComment,\n      setReplyComment,\n      comments,\n      allComments,\n      submittedComments,\n      deleteCommentHandler,\n      highlightComment,\n      highlitComment,\n      commentSubmitted,\n      clearCommentSubmitted,\n      commentEdited,\n      clearCommentEdited,\n      csrfToken\n    } = this.props;\n    if (!comments.length) return null;\n\n    return (\n      <div className=\"comments\">\n        {comments.map((comment) => {\n          // You're allowed to edit it if it was yours and it's not approved yet.\n          let canEdit = false;\n          if (comment.not_approved) {\n            // Take 'editComment' into account\n            if (submittedComments.filter((c) => c.id === comment.id).length) {\n              canEdit = true;\n            }\n          }\n          let canReply = !canEdit && csrfToken;\n\n          const replies = allComments[comment.id];\n\n          const editingComment = !!(\n            canEdit &&\n            editComment &&\n            editComment.id === comment.id\n          );\n\n          const replyingComment = !!(\n            canReply &&\n            replyComment &&\n            replyComment.id === comment.id\n          );\n\n          return (\n            <div className=\"comment\" key={comment.id} id={`c${comment.id}`}>\n              {commentSubmitted && commentSubmitted.id === comment.id && (\n                <ShowCommentSubmitted\n                  commentSubmitted={commentSubmitted}\n                  clearCommentSubmitted={clearCommentSubmitted}\n                />\n              )}\n\n              {commentEdited && commentEdited.id === comment.id && (\n                <ShowCommentEdited\n                  commentEdited={commentEdited}\n                  clearCommentEdited={clearCommentEdited}\n                />\n              )}\n\n              {canEdit && !(editComment && editComment.id === comment.id) && (\n                <p className=\"buttons\">\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      setEditComment(comment);\n                    }}\n                  >\n                    Edit your comment\n                  </button>\n                </p>\n              )}\n\n              {confirmDelete && editComment && editComment.id === comment.id && (\n                <p style={{ margin: 20, textAlign: \"center\" }}>\n                  <b>Are you sure?</b>\n                  <br />\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-danger\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      deleteCommentHandler(comment);\n                    }}\n                  >\n                    Yes\n                  </button>{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      this.setState({ confirmDelete: false });\n                    }}\n                  >\n                    No\n                  </button>\n                </p>\n              )}\n\n              {canEdit && editComment && editComment.id === comment.id && (\n                <p className=\"buttons\">\n                  {!confirmDelete && (\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-warning btn-sm\"\n                      onClick={(event) => {\n                        event.preventDefault();\n                        this.setState({ confirmDelete: true });\n                      }}\n                    >\n                      Remove your comment\n                    </button>\n                  )}{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      if (confirmDelete) {\n                        this.setState({ confirmDelete: false }, () => {\n                          setEditComment(null);\n                        });\n                      } else {\n                        setEditComment(null);\n                      }\n                    }}\n                  >\n                    Close edit\n                  </button>\n                </p>\n              )}\n\n              {editComment && editComment.id === comment.id ? (\n                <CommentForm\n                  focusOnMount={true}\n                  editingComment={editingComment}\n                  replyingComment={false}\n                  {...this.props}\n                />\n              ) : (\n                <DisplayComment\n                  highlightComment={highlightComment}\n                  canReply={canReply}\n                  replyingComment={replyingComment}\n                  setReplyComment={setReplyComment}\n                  comment={comment}\n                  highlit={highlitComment && highlitComment === comment.id}\n                />\n              )}\n\n              {replyComment && comment.id === replyComment.id && (\n                <CommentForm\n                  {...this.props}\n                  replyingComment={replyingComment}\n                  focusOnMount={true}\n                />\n              )}\n              {replies && (\n                <ShowCommentsRecursive {...this.props} comments={replies} />\n              )}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass CommentForm extends React.PureComponent {\n  state = {\n    comment: this.props.editComment ? this.props.editComment.text : \"\",\n    name: \"\",\n    email: \"\",\n    showNameEmailInputs: true,\n    wasSearchedFor: false,\n    canSubmit: false,\n    warnAboutName: false\n  };\n\n  textareaRef = React.createRef();\n\n  componentDidMount() {\n    const update = {};\n\n    let { canSubmit, name, email, showNameEmailInputs } = this.state;\n\n    try {\n      name = localStorage.getItem(\"commentName\") || \"\";\n      email = localStorage.getItem(\"commentEmail\") || \"\";\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"commentName\\\")' didn't work\");\n    }\n\n    if (name || email) {\n      update.name = name;\n      update.email = email;\n    }\n\n    if (!canSubmit && (name || email)) {\n      update.canSubmit = true;\n    }\n    if (name && email && showNameEmailInputs && !this.props.editComment) {\n      update.showNameEmailInputs = false;\n    }\n\n    if (Object.keys(update).length) {\n      this.setState(update);\n    }\n\n    if (this.props.focusOnMount) {\n      // Usually true when doing an edit\n      this.textareaRef.current.focus();\n    }\n  }\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.commentSubmitted !== this.props.commentSubmitted) {\n      this.setState({ comment: \"\" });\n    }\n  }\n\n  clearComment = () => {\n    this.setState({\n      comment: \"\",\n      preview: false\n    });\n  };\n\n  submitHandler = (event) => {\n    event.preventDefault();\n    const { comment, name, email, warnAboutName, wasSearchedFor } = this.state;\n    const { submitCommentHandler, editComment, replyComment } = this.props;\n\n    if (!comment.trim()) {\n      return;\n    }\n    try {\n      if (name && name.trim()) {\n        localStorage.setItem(\"commentName\", name.trim());\n      }\n      if (email && email.trim()) {\n        localStorage.setItem(\"commentEmail\", email.trim());\n      }\n    } catch (ex) {\n      console.warn(\"'localStorage.stItem(\\\"commentName\\\")' didn't work\");\n    }\n\n    if ((!name || !email) && !warnAboutName) {\n      this.setState({ warnAboutName: true });\n    } else {\n      if (warnAboutName) {\n        this.setState({ warnAboutName: false });\n      }\n      submitCommentHandler({\n        comment,\n        email,\n        name,\n        wasSearchedFor,\n        editComment,\n        replyComment,\n        askedWasSearchedFor: this.askWasSearchedFor()\n      });\n    }\n  };\n\n  getTextareaRows = (text, minimum = 4, maximum = 16) => {\n    const linebreaks = (text.match(/\\n/g) || []).length;\n    return Math.min(maximum, Math.max(minimum, linebreaks + 2));\n  };\n\n  askWasSearchedFor = () => {\n    const { searchedId, replyingComment, hasCommented, editingComment } =\n      this.props;\n    return !!(\n      searchedId &&\n      !replyingComment &&\n      !editingComment &&\n      !hasCommented\n    );\n  };\n\n  render() {\n    const { comment, name, email, warnAboutName, showNameEmailInputs } =\n      this.state;\n    const {\n      editComment,\n      savingComment,\n      submissionError,\n      editingComment,\n      csrfToken\n    } = this.props;\n\n    if (!csrfToken) {\n      if (isServer) {\n        return <i>Must have JavaScript enabled to comment.</i>;\n      } else {\n        return null;\n      }\n    }\n\n    return (\n      <form onSubmit={this.submitHandler}>\n        <ShowSubmissionError submissionError={submissionError} />\n\n        {editingComment && (\n          <i>\n            You can edit <b>your</b> recently added, but not yet approved\n            comments.\n          </i>\n        )}\n\n        {savingComment && <ShowSavingStatus />}\n\n        {this.askWasSearchedFor() && (\n          <div style={{ textAlign: \"center\", marginBottom: 20 }}>\n            <h4>Was this the song you were looking for?</h4>\n\n            <label className=\"radio-inline\">\n              <input\n                type=\"radio\"\n                name=\"wasSearchedFor\"\n                value=\"yes\"\n                disabled={savingComment}\n                onChange={(e) => {\n                  this.setState({ wasSearchedFor: true }, () => {\n                    if (this.textareaRef.current) {\n                      this.textareaRef.current.focus();\n                    }\n                  });\n                }}\n              />{\" \"}\n              Yes!\n            </label>\n            <label className=\"radio-inline\">\n              <input\n                type=\"radio\"\n                name=\"wasSearchedFor\"\n                id=\"inlineRadio2\"\n                value=\"no\"\n                disabled={savingComment}\n                onChange={(e) => {\n                  this.setState({ wasSearchedFor: false }, () => {\n                    if (this.textareaRef.current) {\n                      this.textareaRef.current.focus();\n                    }\n                  });\n                }}\n              />{\" \"}\n              No :(\n            </label>\n          </div>\n        )}\n        <div className=\"form-group\">\n          <textarea\n            className=\"form-control\"\n            rows={this.getTextareaRows(this.state.comment)}\n            ref={this.textareaRef}\n            value={comment}\n            disabled={savingComment}\n            onChange={(e) => this.setState({ comment: e.target.value })}\n            onBlur={(event) => {\n              if (this.state.comment.trim()) {\n                setTimeout(() => {\n                  if (!this.dismounted) {\n                    if (!this.state.canSubmit) {\n                      this.setState({ canSubmit: true });\n                    }\n                  }\n                }, 100);\n              }\n            }}\n          />\n        </div>\n        {showNameEmailInputs && (\n          <div className=\"form-inlinexxx\">\n            <div className=\"form-group\">\n              <label htmlFor=\"_name\" className=\"sr-only\">\n                Your name\n              </label>\n              <input\n                type=\"text\"\n                className=\"form-control\"\n                id=\"_name\"\n                placeholder=\"Your name...\"\n                disabled={savingComment}\n                value={name}\n                onChange={(e) => this.setState({ name: e.target.value })}\n              />\n            </div>\n\n            <div className=\"form-group\" style={{ marginBottom: 3 }}>\n              <label htmlFor=\"_email\" className=\"sr-only\">\n                Email address\n              </label>\n              <input\n                type=\"email\"\n                className=\"form-control\"\n                id=\"_email\"\n                placeholder=\"Your email address...\"\n                disabled={savingComment}\n                value={email}\n                onChange={(e) => this.setState({ email: e.target.value })}\n              />\n            </div>\n            <p>\n              <small>\n                Your email will <b>never be published</b> and{\" \"}\n                <b>never be shared</b>. Useful to receive reply comments.\n              </small>\n            </p>\n          </div>\n        )}\n        {warnAboutName && (\n          <div\n            className=\"alert-comment alert alert-warning alert-dismissible\"\n            role=\"alert\"\n          >\n            <button\n              type=\"button\"\n              className=\"close\"\n              data-dismiss=\"alert\"\n              aria-label=\"Close\"\n              onClick={(event) => {\n                this.setState({ warnAboutName: false });\n              }}\n            >\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n            <p>\n              {name ? (\n                <b>Please enter your email</b>\n              ) : (\n                <b>Please enter your name</b>\n              )}\n            </p>\n            <p>\n              A real name and email helps the comment be approved.\n              <br />\n              An email address makes it possible to receive notification on\n              replies to your comment.\n            </p>\n          </div>\n        )}\n        <div className=\"row\">\n          <div className=\"col-md-8\">\n            {name && email && !showNameEmailInputs && (\n              <>\n                <p>\n                  Commenting as <b>{name}</b>. Replies sent to <b>{email}</b>.\n                </p>\n                <p>\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      this.setState({ showNameEmailInputs: true });\n                    }}\n                  >\n                    Change name\n                  </button>\n                </p>\n              </>\n            )}\n          </div>\n\n          <div className=\"col-md-4\" style={{ textAlign: \"right\" }}>\n            <button\n              type=\"submit\"\n              className=\"btn btn-primary\"\n              disabled={!comment.trim() || savingComment}\n            >\n              {editComment ? \"Save Changes\" : \"Post Comment\"}\n            </button>\n          </div>\n        </div>\n\n        {!this.state.wasSearchedFor && (\n          <p style={{ margin: \"20px 0\" }}>\n            <small>\n              Can't find the song you're looking for?{\" \"}\n              <a href=\"https://www.peterbe.com/plog/blogitem-040601-1\">\n                Try posting on <b>Find song by lyrics</b>\n              </a>\n              .\n            </small>\n          </p>\n        )}\n      </form>\n    );\n  }\n}\n\nfunction ShowSavingStatus() {\n  return (\n    <p>\n      <i>Please wait....</i>\n    </p>\n  );\n}\n\nclass DisplayComment extends React.PureComponent {\n  render() {\n    const {\n      highlit,\n      highlightComment,\n      canReply,\n      replyingComment,\n      setReplyComment,\n      comment\n    } = this.props;\n    const { id, name, created } = comment;\n    const notApproved = comment.not_approved;\n    const text = comment.text_rendered;\n\n    function getRandomCelebration() {\n      const emojis = [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"];\n      const emoji = emojis[Math.floor(Math.random() * emojis.length)];\n      return (\n        <span role=\"img\" aria-label=\"muted\">\n          {emoji}\n        </span>\n      );\n    }\n\n    return (\n      <div className={highlit ? \"display highlit\" : \"display\"}>\n        {canReply && (\n          <p className=\"buttons\">\n            <button\n              type=\"button\"\n              className={\n                replyingComment\n                  ? \"btn btn-warning btn-sm\"\n                  : \"btn btn-info btn-sm\"\n              }\n              onClick={(event) => {\n                event.preventDefault();\n                setReplyComment(comment);\n              }}\n            >\n              {replyingComment ? \"Close\" : \"Reply\"}\n            </button>\n          </p>\n        )}\n        <h5>\n          By <b>{name ? name : <i>Anonymous</i>}</b>\n        </h5>\n        <p className=\"meta\">\n          <a\n            href={`#c${id}`}\n            title={created}\n            onClick={(event) => {\n              highlightComment(id);\n            }}\n          >\n            Posted <CustomTimeAgo date={created} title={created} />\n          </a>\n          {notApproved && <small>Not yet approved!</small>}\n        </p>\n        {comment.hasOwnProperty(\"was_searched_for\") && (\n          <p>\n            <i>Was it the song you were looking for?</i>{\" \"}\n            <b>{comment.was_searched_for ? \"Yes\" : \"No\"}</b>{\" \"}\n            {comment.was_searched_for && getRandomCelebration()}\n          </p>\n        )}\n\n        {typeof text === \"string\" ? (\n          <blockquote dangerouslySetInnerHTML={{ __html: text }} />\n        ) : (\n          <blockquote>{text}</blockquote>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { useCallback, useRef, useEffect, useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { Loading, SetHTMLHeaders, ServerError } from \"./Common\";\nimport { cachedFetch } from \"./Cache\";\nimport \"./RecentComments.css\";\n\nfunction RecentComments({ recentComments }) {\n  let { page } = useParams();\n\n  let mountedRef = useRef(false);\n  const [serverError, setServerError] = useState(null);\n  const [data, setData] = useState(recentComments || null);\n\n  function getPage(p) {\n    return parseInt(p || \"1\", 10);\n  }\n\n  const fetchComments = useCallback(() => {\n    let url = \"/api/comments/recent\";\n    const pageInt = getPage(page);\n    if (pageInt > 1) {\n      url += `?page=${pageInt}`;\n    }\n    return cachedFetch(url)\n      .then((r) => {\n        if (!r.ok) {\n          return mountedRef.current && setServerError(r);\n        }\n        r.json().then((data) => {\n          return mountedRef.current && setData(data);\n        });\n      })\n      .catch((ex) => {\n        return mountedRef.current && setServerError(ex);\n      });\n  }, [page]);\n\n  useEffect(() => {\n    const pageInt = getPage(page);\n\n    const suffix = \" - Song Search\";\n    SetHTMLHeaders({\n      title:\n        pageInt > 1\n          ? `Recent Comments (page ${pageInt})${suffix}`\n          : `Recent Comments${suffix}`\n    });\n    setData(null);\n    mountedRef.current = true;\n    fetchComments(page);\n    return () => {\n      mountedRef.current = false;\n    };\n  }, [page, fetchComments]);\n\n  const loading = !data && !serverError;\n\n  const [showLoading, setShowLoading] = useState(false);\n  useEffect(() => {\n    if (loading) {\n      window.setTimeout(() => {\n        mountedRef.current && setShowLoading(true);\n      }, 1000);\n    } else {\n      setShowLoading(false);\n    }\n  }, [loading]);\n\n  const pageInt = getPage(page);\n\n  let pagination = null;\n  if (data && (data.next_page || pageInt > 1)) {\n    pagination = <Pagination next={data.next_page} previous={pageInt - 1} />;\n  }\n\n  return (\n    <div className=\"recent-comments\">\n      {!serverError && (\n        <h2>\n          Recent Comments {pageInt !== 1 && <small>Page {pageInt}</small>}\n        </h2>\n      )}\n      <p>\n        <Link to=\"/\">Back to the home page</Link>\n      </p>\n      {loading && showLoading && <Loading text=\"Loading...\" />}\n      {serverError && !data && <ServerError />}\n\n      {pagination}\n\n      {data && <ShowRecentComments comments={data.comments} isRoot={true} />}\n\n      {pagination}\n    </div>\n  );\n}\n\nexport default RecentComments;\n\nexport function ShowRecentComments({ comments, isRoot }) {\n  let previousSong = null;\n  let previousChronological = null;\n  return (\n    <div className=\"comments\">\n      {comments.map((comment) => {\n        let imageLink = null;\n        if (isRoot) {\n          if (comment.image && previousSong !== comment.song.id) {\n            imageLink = (\n              <Link to={comment._url}>\n                <img\n                  className=\"pull-right img-thumbnail found\"\n                  loading=\"lazy\"\n                  src={comment.image.thumbnail100 || comment.image.url}\n                  alt={comment.song.artist.name}\n                />\n              </Link>\n            );\n          }\n          previousSong = comment.song.id;\n        }\n\n        let geoString = null;\n        if (comment.geo) {\n          if (comment.geo.city && comment.geo.country) {\n            geoString = ` (from ${comment.geo.city}, ${comment.geo.country}) `;\n          } else if (comment.geo.country) {\n            geoString = ` (from ${comment.geo.country}) `;\n          }\n        }\n\n        let chronologicalDiff = null;\n        if (comment.rating) {\n          if (previousChronological) {\n            chronologicalDiff =\n              comment.rating.chronological - previousChronological - 1;\n          }\n          previousChronological = comment.rating.chronological;\n        }\n\n        return (\n          <div key={comment.id} className=\"comment\">\n            {imageLink}\n            {isRoot && (\n              <h4>\n                On{\" \"}\n                <Link to={comment._url}>\n                  <b>{comment.song.name}</b> <span className=\"by\">by</span>{\" \"}\n                  {comment.song.artist.name}\n                </Link>\n              </h4>\n            )}\n            <blockquote\n              dangerouslySetInnerHTML={{ __html: comment.text_rendered }}\n            />\n            {isRoot && (\n              <p>\n                <Link to={comment._url} className=\"btn btn-info btn-sm\">\n                  Reply\n                </Link>\n              </p>\n            )}\n            <p>\n              By {comment.name ? <b>{comment.name}</b> : <i>Anonymous</i>}\n              {geoString}\n              on {comment.approved_human}{\" \"}\n              {comment.rating && (\n                <span>\n                  rating:<code>{comment.rating.score}</code>\n                  chronological: <code>{comment.rating.chronological}</code>\n                  {!!chronologicalDiff && (\n                    <i>\n                      {chronologicalDiff > 0\n                        ? ` +${chronologicalDiff}`\n                        : chronologicalDiff}\n                    </i>\n                  )}\n                </span>\n              )}\n            </p>\n            {comment.replies && comment.replies.length ? (\n              <ShowRecentComments comments={comment.replies} isRoot={false} />\n            ) : null}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nfunction Pagination({ previous, next }) {\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\" style={{ textAlign: \"right\" }}>\n        {previous ? (\n          <div className=\"load-more\">\n            <Link to={previous === 1 ? \"/comments\" : `/comments/p${previous}`}>\n              Previous page\n            </Link>\n          </div>\n        ) : null}\n      </div>\n      <div className=\"col-md-6\" style={{ textAlign: \"left\" }}>\n        {next && (\n          <div className=\"load-more\">\n            <Link to={`/comments/p${next}`}>Next page</Link>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { throttle, debounce } from \"throttle-debounce\";\n// import { Waypoint } from \"react-waypoint\";\nimport copy from \"copy-to-clipboard\";\nimport { cachedFetch } from \"./Cache\";\nimport Countdown from \"react-countdown\";\nimport CountdownTimer from \"./CountdownTimer\";\nimport Bannertop from \"./Bannertop\";\nimport pics from \"./songs_desktop.png\";\nimport mobileimgs from \"./songs_mobile.png\";\nimport {\n  Loading,\n  SetHTMLHeaders,\n  ResetHTMLHeaders,\n  isServer,\n  // YouTubeSnippetIntersectionLazy,\n  loadCarbonScript,\n  AmazonRelatedProducts,\n  RenderParagraphs\n} from \"./Common\";\nimport { SongComments } from \"./Comments\";\nimport { ShowRecentComments } from \"./RecentComments\";\n\n// if (process.env.PUBLIC_URL === undefined) {\n//   // console.error(\"process.env.PUBLIC_URL should not be undefined\");\n//   throw new Error(\"process.env.PUBLIC_URL should not be undefined\");\n// }\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst lazyloadThumbnailImage = PUBLIC_URL + \"/static/lazyload-thumbnail.png\";\nconst placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\n\nconst NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\n\nconst samplePlaceholders = [\n  \"Born to be wild\",\n  \"No one ever told me life was kind\",\n  \"But here it comes again, straight thru the heart\",\n  \"I'm an alligator\",\n  \"My mouth, it moves\"\n];\nsamplePlaceholders.sort(() => 0.5 - Math.random());\n\nconst appendSuggestion = (text, append) => {\n  let split = text.split(/\\s+/);\n  split.pop();\n  split.push(append);\n  return split.join(\" \");\n};\n\nconst Completionist = () => <span>You are good to go!</span>;\nconst THREE_DAYS_IN_MS = 3 * 24 * 60 * 60 * 1000;\nconst NOW_IN_MS = new Date().getTime();\n\nconst dateTimeAfterThreeDays = NOW_IN_MS + THREE_DAYS_IN_MS;\n\nclass Home extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let q = \"\";\n    let originalQ = \"\";\n    let artistName = \"\";\n    let total = 0;\n    let searchResults = null;\n    let desperate = false;\n    let missing = null;\n    // let suggestions = null;\n    let by_name = null;\n    let by_name_total = null;\n    let by_name_limit = null;\n    let searchLanguage = \"\";\n    let searchYear = \"\";\n    let parentSearch = null;\n    let keyPhrases = null;\n    let popularityFactor = null;\n    let searchExample = null;\n\n    const { results } = this.props;\n\n    if (results) {\n      this.searched = results.searched;\n\n      q = results.search;\n      total = results.total;\n      searchResults = results.results;\n      desperate = results.desperate;\n      missing = results.missing;\n      by_name = results.by_name || null;\n      by_name_total = results.by_name_total || null;\n      by_name_limit = results.by_name_limit || null;\n      artistName = results.artist;\n      originalQ = results.original || \"\";\n      searchLanguage = results.language || \"\";\n      searchYear = results.year || \"\";\n      parentSearch = results.searched || null;\n      keyPhrases = results.key_phrases || null;\n      popularityFactor = results.popularityFactor || null;\n      searchExample = results.search_example || null;\n    }\n    let advancedSearch = Boolean(artistName || searchLanguage || searchYear);\n\n    let searchExamples = null;\n    let showExamples = false;\n    if (props.searchExamples && props.searchExamples.examples) {\n      searchExamples = props.searchExamples.examples;\n      showExamples = true;\n    }\n\n    let recentComments = null;\n    let showRecentComments = false;\n    if (\n      props.recentComments &&\n      props.recentComments.comments &&\n      props.recentComments.comments.length\n    ) {\n      recentComments = props.recentComments;\n      showRecentComments = true;\n    }\n\n    this.state = {\n      q,\n      originalQ,\n      artistName,\n      searching: false,\n      searchError: null,\n      total,\n      results: searchResults,\n      resultsPageIndex: 0,\n      by_name,\n      by_name_total,\n      by_name_limit,\n      placeholder: samplePlaceholders[0],\n      slowSearch: null,\n      showExamples,\n      searchExamples,\n      parentSearch,\n      desperateSearch: desperate,\n      missing,\n      keyPhrases,\n      popularityFactor,\n      searchExample,\n      showRecentComments,\n      recentComments,\n\n      onlyResults: null,\n\n      searchMaxLength: null,\n\n      autocompleteSuggestions: null,\n      autocompleteSearchSuggestions: null,\n      autocompleteHighlight: -1,\n      showAutocompleteSuggestions: true,\n\n      autocompleteArtistSuggestions: null,\n      autocompleteArtistHighlight: -1,\n      showAutocompleteArtistSuggestions: true,\n\n      advancedSearch,\n      searchLanguage,\n      searchLanguages: [],\n      searchYear,\n      searchYears: [],\n\n      redirectTo: null,\n      shareSearch: false\n    };\n\n    // When you've typed something longer.\n    // If you steadily type something every 100ms for a long time\n    // without pausing, this won't fire till you stop.\n    this.fetchAutocompleteSuggestionsDebounced = debounce(\n      800,\n      this.fetchAutocompleteSuggestions\n    );\n    this.fetchAutocompleteSuggestionsDebouncedLong = debounce(\n      1800,\n      this.fetchAutocompleteSuggestions\n    );\n\n    // When you've started typing.\n    // Will basically fire without being postponed.\n    this.fetchAutocompleteSuggestionsThrottled = throttle(\n      1100,\n      this.fetchAutocompleteSuggestions\n    );\n\n    this._autocompleteSuggestionsCache = {};\n  }\n\n  artistRef = React.createRef();\n  languageRef = React.createRef();\n  searchRef = React.createRef();\n\n  componentDidMount() {\n    ResetHTMLHeaders();\n    if (this.props.match.params.q) {\n      this.startSearchFromLocation(this.props);\n    } else {\n      this.startSamplePlaceholderInterval();\n      if (!this.state.searchExamples) {\n        this.fetchSearchExamples();\n      }\n      if (!this.state.recentComments) {\n        this.fetchRecentComments();\n      }\n    }\n    if (this.state.results) {\n      if (\n        (this.state.desperateSearch || !this.state.total) &&\n        this.state.q.length > 10\n      ) {\n        this._fetchSearchAlternatives();\n      }\n    }\n  }\n\n  startSearchFromLocation = (props) => {\n    const { match } = props;\n    const q = decodeURIComponent(match.params.q);\n\n    const sp = new URLSearchParams(props.location.search || \"\");\n    let artist = sp.get(\"artist\");\n    let language = sp.get(\"language\");\n    let year = sp.get(\"year\");\n    let searchExample = sp.get(\"example\");\n\n    // XXX should this compare artist and language too?\n    if (this.state.q !== q) {\n      const stateUpdate = {\n        q\n      };\n      if (q.length > this.searchRef.current.maxLength - 10) {\n        stateUpdate.searchMaxLength = [\n          q.length,\n          this.searchRef.current.maxLength\n        ];\n      }\n\n      if (language || year) {\n        this.loadSearchAggregates();\n        stateUpdate.advancedSearch = true;\n      }\n      if (language) {\n        stateUpdate.searchLanguage = language;\n      }\n      if (year) {\n        stateUpdate.searchYear = year;\n      }\n      if (artist) {\n        stateUpdate.artistName = artist;\n        stateUpdate.advancedSearch = true;\n      }\n      if (searchExample) {\n        stateUpdate.searchExample = searchExample;\n      }\n      this.setState(stateUpdate, () => {\n        this.startSearch(\n          q,\n          language,\n          year,\n          artist,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      });\n    } else {\n      SetHTMLHeaders({\n        title: `${q} - Song Search`\n      });\n    }\n  };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.q !== prevProps.match.params.q) {\n      if (!this.props.match.params.q) {\n        ResetHTMLHeaders();\n        this.setState({\n          q: \"\",\n          originalQ: \"\",\n          artistName: \"\",\n          searching: false,\n          total: null,\n          results: null,\n          resultsPageIndex: 0,\n          slowSearch: null,\n          showExamples: false,\n          searchExamples: null,\n          showRecentComments: false,\n          parentSearch: null,\n          desperateSearch: false,\n          searchExample: null,\n          missing: null,\n          searchError: null,\n          by_name: null,\n          by_name_total: null,\n          by_name_limit: null,\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1,\n          redirectTo: null,\n          shareSearch: false\n        });\n        // this.refs.q.value = \"\";\n        this.fetchSearchExamples();\n      } else if (\n        decodeURIComponent(this.props.match.params.q) !== this.state.q\n      ) {\n        this.startSearchFromLocation(this.props);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n    this.stopSamplePlaceholderInterval();\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    if (this.slowSearchTimer) {\n      window.clearTimeout(this.slowSearchTimer);\n    }\n  }\n\n  fetchSearchExamples() {\n    let url = \"/api/search/examples\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                searchExamples: results.examples,\n                showExamples: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchRecentComments() {\n    let url = \"/api/comments/recent/home\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                recentComments: results,\n                showRecentComments: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  stopSamplePlaceholderInterval() {\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n  }\n\n  startSamplePlaceholderInterval() {\n    if (this.state.q) {\n      return;\n    }\n    // let el = document.querySelector('input[type=\"search\"]')\n    // if (!el || el.value) return\n    this.currentPlaceholder = 0;\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n    this.placeholderSampleInterval = window.setInterval(() => {\n      this.setNextSamplePlaceholder();\n    }, 3000);\n  }\n\n  setNextSamplePlaceholder() {\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    const placeholder =\n      samplePlaceholders[++this.currentPlaceholder % samplePlaceholders.length];\n    const el = this.searchRef.current;\n    if (!el) return;\n    let slice = 0;\n    this.fillerInterval = setInterval(() => {\n      if (!placeholder) {\n        // something's gone wrong\n        return;\n      }\n      el.placeholder = placeholder.substring(0, ++slice);\n      if (slice >= placeholder.length) {\n        clearInterval(this.fillerInterval);\n        el.placeholder += \"...\";\n      }\n    }, 10);\n  }\n\n  onFocusSearch = () => {\n    this.searchRef.current.placeholder = \"\";\n    clearInterval(this.placeholderSampleInterval);\n    if (this.fillerInterval) {\n      clearInterval(this.fillerInterval);\n    }\n    if (!this.state.showAutocompleteSuggestions) {\n      this.setState({ showAutocompleteSuggestions: true });\n    }\n    if (this.state.shareSearch) {\n      this.setState({ shareSearch: false });\n    }\n\n    if (!this._firstFocusSearch) {\n      this._firstFocusSearch = true;\n      // If you're on a small screen this is the first time you've focused,\n      // the scroll the top of the search input into view.\n      if (window.innerHeight && window.innerHeight < 600) {\n        this.searchRef.current.scrollIntoView();\n      }\n    }\n  };\n\n  onBlurSearch = (event) => {\n    if (!this.state.q) {\n      this.setNextSamplePlaceholder();\n      this.startSamplePlaceholderInterval();\n    }\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  onFocusArtist = (event) => {\n    if (!this.state.showAutocompleteArtistSuggestions) {\n      this.setState({ showAutocompleteArtistSuggestions: true });\n    }\n  };\n\n  onBlurArtist = (event) => {\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteArtistSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  sampleSearch = (event, search) => {\n    event.preventDefault();\n    const stateUpdate = { q: search.term, searchExample: search.id };\n\n    if (search.language || search.year) {\n      if (\n        !this.state.searchLanguages.length ||\n        !this.state.searchYears.length\n      ) {\n        this.loadSearchAggregates();\n      }\n    }\n\n    if (search.language) {\n      stateUpdate.searchLanguage = search.language;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchLanguage) {\n      stateUpdate.searchLanguage = \"\";\n    }\n\n    if (search.year) {\n      stateUpdate.searchYear = search.year;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchYear) {\n      stateUpdate.searchYear = \"\";\n    }\n\n    if (search.artist) {\n      stateUpdate.artistName = search.artist;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.artistName) {\n      stateUpdate.artistName = \"\";\n    }\n\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  onSubmit = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  submitSearch() {\n    let q = this.state.q.trim();\n    // let language = this.languageRef.current && this.languageRef.current.value;\n    // if (!language && this.state.searchLanguage) {\n    //   language = this.state.searchLanguage;\n    // }\n    const language = this.state.searchLanguage;\n    const year = this.state.searchYear;\n\n    let artistName =\n      this.artistRef.current && this.artistRef.current.value.trim();\n    if (!artistName && this.state.artistName) {\n      if (!this.state.advancedSearch) {\n        artistName = this.state.artistName;\n      }\n    } else if (artistName && !this.state.artistName) {\n      this.setState({ artistName });\n    }\n    if (q) {\n      let newURL = `/q/${encodeURIComponent(q)}`;\n      // only include the language= if it's set and not 'en'\n      if (language && language !== \"en\") {\n        newURL += `?language=${language}`;\n      }\n      if (year) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `year=${year}`;\n      }\n      if (artistName) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `artist=${encodeURIComponent(artistName)}`;\n      }\n      let currentURL = this.props.location.pathname;\n      if (this.props.location.search) {\n        currentURL += this.props.location.search;\n      }\n      if (newURL === currentURL) {\n        // get out of here\n        return;\n      }\n      this.props.history.push(newURL);\n      this.startSearch(q, language, year, artistName);\n\n      // XXX this.searchRef.current.blur()????\n      document.querySelector('input[type=\"search\"]').blur();\n      if (this.state.autocompleteSuggestions) {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n      if (this.state.autocompleteArtistSuggestions) {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    }\n  }\n\n  startSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n\n    page = 0,\n    searchExample = null\n  ) {\n    SetHTMLHeaders({\n      title: \"Searching... - Song Search\"\n    });\n    // The state change is quite differnet depend on it being\n    // the first page or a subsequent page.\n    if (page) {\n      this.setState(\n        {\n          searching: true,\n          searchError: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n        }\n      );\n    } else {\n      this.setState(\n        {\n          searching: true,\n          searchError: null,\n          // suggestions: null,\n          results: null,\n          by_name: null,\n          showExamples: false,\n          showRecentComments: false,\n          parentSearch: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n          this.slowSearchTimer = window.setTimeout(() => {\n            if (!this.state.searchError && !this.state.results) {\n              this.setState({ slowSearch: true });\n            }\n          }, 5 * 1000);\n        }\n      );\n    }\n  }\n\n  sendSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n    page = 0,\n    searchExample = null\n  ) {\n    let url = `/api/search?q=${encodeURIComponent(q)}`;\n    if (language) {\n      url += `&language=${language}`;\n    }\n    if (year) {\n      url += `&year=${year}`;\n    }\n    if (artist) {\n      url += `&artist=${encodeURIComponent(artist)}`;\n    }\n    if (page) {\n      url += `&page=${page + 1}`;\n      url += `&searched=${this.searched}`;\n    } else if (this.state.originalQ) {\n      url += `&original=${this.searched}`;\n    }\n    if (this.state.desperateSearch && !this.state.originalQ) {\n      url += `&desperate=true`;\n    }\n    if (searchExample) {\n      url += `&example=${searchExample}`;\n    }\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.slowSearchTimer) {\n            window.clearTimeout(this.slowSearchTimer);\n          }\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          if (results.error) {\n            this.setState({\n              searchError: results.error,\n              searching: false,\n              slowSearch: null\n            });\n            SetHTMLHeaders({\n              title: \"Sorry, search error\"\n            });\n            return;\n          } else if (this.state.searchError) {\n            this.setState({ searchError: null });\n          }\n\n          SetHTMLHeaders({\n            title: `${q} - Song Search`\n          });\n\n          // This is the first time sendSearch is called for\n          // this q (and this offset).\n          // Decide whether to get suggestions searches...\n          // console.log(\n          //   'Results:', results.results.length,\n          //   'Total:', results.total,\n          //   'Limit:', results.limit,\n          // )\n\n          // set this so that the onExpandClick can use it\n          if (!page) {\n            this.searched = results.searched;\n          }\n          // set in localStorage for the sake \"Open in a new tab\"\n          try {\n            localStorage.setItem(\n              \"searched\",\n              `${results.searched},${new Date().getTime()}`\n            );\n          } catch (ex) {\n            console.warn(\"'localStorage.setItem(\\\"searched\\\")' didn't work\");\n          }\n\n          let allResults;\n          if (page) {\n            allResults = [];\n            this.state.results.forEach((r) => allResults.push(r));\n            results.results.forEach((r) => allResults.push(r));\n          } else {\n            allResults = results.results;\n          }\n          this.setState(\n            {\n              desperateSearch: results.desperate,\n              missing: results.missing,\n              popularityFactor: results.popularity_factor,\n              parentSearch: results.searched,\n              searching: false,\n              results: allResults,\n              keyPhrases: null,\n              by_name: results.by_name,\n              by_name_total: results.by_name_total,\n              by_name_limit: results.by_name_limit,\n              total: results.total,\n              searchError: null,\n              slowSearch: null\n            },\n            () => {\n              if (\n                (this.state.desperateSearch || !this.state.total) &&\n                this.state.q.length > 10\n              ) {\n                this._fetchSearchAlternatives();\n              }\n            }\n          );\n        });\n      } else {\n        r.text().then((text) => {\n          SetHTMLHeaders({\n            title: \"Search Error\"\n          });\n          this.setState({\n            searching: false,\n            searchError: { status: r.status, text: text },\n            slowSearch: false\n          });\n        });\n      }\n    });\n  }\n\n  _fetchSearchAlternatives = () => {\n    const url = `/api/search/alternatives?searched=${this.state.parentSearch}`;\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          this.setState({ keyPhrases: results.key_phrases });\n        });\n      }\n    });\n  };\n\n  onChangeSearch = (event) => {\n    const q = event.target.value;\n    this.setState({ q }, () => {\n      if (this.state.desperateSearch) {\n        this.setState({ desperateSearch: false });\n      }\n      if (this.state.originalQ) {\n        this.setState({ originalQ: \"\" });\n      }\n\n      let length = q.length;\n      if (length > this.searchRef.current.maxLength - 10) {\n        this.setState({\n          searchMaxLength: [length, this.searchRef.current.maxLength],\n          showAutocompleteSuggestions: false\n        });\n      } else if (this.state.searchMaxLength) {\n        this.setState({\n          searchMaxLength: null,\n          showAutocompleteSuggestions: true\n        });\n      }\n\n      if (this.state.q.trim()) {\n        if (this.autocompleteWaitingFor) {\n          if (q.trim() === this.autocompleteWaitingFor) {\n            return;\n          }\n        }\n        if ((length < 4 || q.endsWith(\" \")) && length < 24) {\n          // the impatient one\n          this.fetchAutocompleteSuggestionsThrottled(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length > 24) {\n          // When what you've typed is really long use the really\n          // delayed throttle.\n          this.fetchAutocompleteSuggestionsDebouncedLong(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length) {\n          this.fetchAutocompleteSuggestionsDebounced(\n            q,\n            this.state.searchLanguage\n          );\n        } else {\n          this.setState({\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            showAutocompleteSuggestions: true\n          });\n        }\n      } else {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n    });\n  };\n\n  fetchAutocompleteSuggestions(q, language = null) {\n    let cacheHash = q.trim();\n    let url = `/api/search/autocomplete?q=${encodeURIComponent(q)}`;\n    if (language) {\n      cacheHash += language.trim();\n      url += `&language=${language}`;\n    }\n    const cached = this._autocompleteSuggestionsCache[cacheHash];\n    if (cached) {\n      return Promise.resolve(cached).then((results) => {\n        this.setState({\n          autocompleteSuggestions: results.matches,\n          autocompleteSearchSuggestions: results.search_suggestions,\n          autocompleteHighlight: -1,\n          missing: results.missing\n        });\n      });\n    }\n\n    // Store a \"global\" of what the latest q was.\n    this.autocompleteWaitingFor = q;\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (q.startsWith(this.autocompleteWaitingFor)) {\n            this._autocompleteSuggestionsCache[cacheHash] = results;\n            if (this.state.q) {\n              this.setState({\n                autocompleteSuggestions: results.matches,\n                autocompleteSearchSuggestions: results.search_suggestions,\n                autocompleteHighlight: -1\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchAutocompleteArtistSuggestions(q) {\n    const url = `/api/search/autocomplete?q=${q}&artist=true`;\n    return fetch(url)\n      .then((r) => {\n        if (r.status === 200) {\n          return r.json();\n        }\n      })\n      .then((results) => {\n        if (this.dismounted) {\n          return;\n        }\n        if (results) {\n          this.setState({\n            autocompleteArtistSuggestions: results.matches,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      });\n  }\n\n  onKeyDownSearch = (event) => {\n    let suggestions = this.state.autocompleteSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        let suggestion =\n          highlight > -1 ? suggestions[highlight] : suggestions[0];\n        if (!suggestion._url) {\n          this.setState({\n            q: suggestion.text + \" \"\n          });\n          this.fetchAutocompleteSuggestions(\n            suggestion.text,\n            this.state.searchLanguage\n          );\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          const searchSuggestions = this.state.autocompleteSearchSuggestions;\n          if (highlight === 0 && searchSuggestions && searchSuggestions.total) {\n            this.submitSearch();\n            return;\n          }\n          highlight--;\n          if (!suggestions[highlight]) {\n            // Not sure how this can happen\n            console.warn(\"SUGGESTIONS\", suggestions);\n            console.warn(\"HIGHLIGHT\", highlight);\n            // But bail!\n            this.setState(\n              {\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n            return;\n          }\n          if (suggestions[highlight]._url) {\n            this.setState({\n              redirectTo: {\n                pathname: suggestions[highlight]._url\n              }\n            });\n          } else {\n            this.setState(\n              {\n                q: suggestions[highlight].text,\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onKeyDownArtistSearch = (event) => {\n    let suggestions = this.state.autocompleteArtistSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteArtistHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        if (highlight > -1) {\n          this.setState({\n            artistName: suggestions[highlight].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[highlight].text);\n        } else if (suggestions.length) {\n          this.setState({\n            artistName: suggestions[0].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[0].text);\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteArtistHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteArtistHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          this.setState({\n            artistName: suggestions[highlight].text,\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      }\n    }\n  };\n\n  toggleShareSearch = (event) => {\n    event.preventDefault();\n    this.setState({\n      shareSearch: !this.state.shareSearch,\n      advancedSearch: false\n    });\n  };\n\n  toggleAdvancedSearch = (event) => {\n    event.preventDefault();\n    if (!this.state.advancedSearch) {\n      // it was not enabled before\n      const withCountsLanguages = this.state.searchLanguages.filter(\n        (x) => x.count\n      );\n      const withCountsYears = this.state.searchYears.filter((x) => x.count);\n      if (!withCountsLanguages.length || !withCountsYears.length) {\n        this.loadSearchAggregates();\n      }\n    }\n    this.setState({\n      advancedSearch: !this.state.advancedSearch,\n      shareSearch: false\n    });\n  };\n\n  // loadSearchLanguages() {\n  //   return fetch(\"/api/search/languages\").then(r => {\n  //     if (r.status === 200) {\n  //       r.json().then(r => {\n  //         this.setState({ searchLanguages: r.languages });\n  //       });\n  //     }\n  //   });\n  // }\n  loadSearchAggregates() {\n    return fetch(\"/api/search/aggregates\").then((r) => {\n      if (r.status === 200) {\n        r.json().then((r) => {\n          this.setState({ searchLanguages: r.languages, searchYears: r.years });\n        });\n      }\n    });\n  }\n\n  onChangeLanguage = (event) => {\n    event.preventDefault();\n    const searchLanguage = event.target.value;\n    this.setState({ searchLanguage });\n  };\n\n  onChangeYear = (event) => {\n    event.preventDefault();\n    const searchYear = event.target.value;\n    this.setState({ searchYear });\n  };\n\n  onChangeArtistName = (event) => {\n    event.preventDefault();\n    const artistName = event.target.value;\n    this.setState({ artistName }, () => {\n      if (artistName.length) {\n        this.fetchAutocompleteArtistSuggestions(this.state.artistName.trim());\n      } else {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    });\n  };\n\n  onSelectSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    if (suggestion._url) {\n      return this.setState({ redirectTo: suggestion._url });\n    }\n    let newText = suggestion.text;\n    if (suggestion.append) {\n      newText = appendSuggestion(this.state.q, newText);\n    }\n    this.setState(\n      {\n        q: newText,\n        autocompleteSuggestions: null,\n        autocompleteHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onSelectSuggestionAll = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  onSelectArtistSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    this.setState(\n      {\n        artistName: suggestion.text,\n        autocompleteArtistSuggestions: null,\n        autocompleteArtistHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onLoadMore = (event) => {\n    event.preventDefault();\n    this.setState(\n      {\n        resultsPageIndex: this.state.resultsPageIndex + 1\n      },\n      () => {\n        this.startSearch(\n          this.state.q,\n          this.state.searchLanguage,\n          this.state.searchYear,\n          this.state.artistName,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      }\n    );\n  };\n\n  submitPhrase = (event, keyPhrase) => {\n    event.preventDefault();\n    const stateUpdate = { q: keyPhrase.phrase, originalQ: this.state.q };\n    if (keyPhrase.year) {\n      stateUpdate.searchYear = keyPhrase.year;\n    }\n    if (keyPhrase.language) {\n      stateUpdate.searchLanguage = keyPhrase.language;\n    }\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  reloadSearch = (event) => {\n    event.preventDefault();\n    window.location.reload();\n  };\n\n  loadMoreByName = (event) => {\n    const previousByNameLimit = this.state.by_name_limit;\n    this.setState(\n      {\n        by_name_total: 0,\n        by_name_limit: 0\n      },\n      () => {\n        const url = `/api/search?q=${encodeURIComponent(\n          this.state.q\n        )}&by_name=${previousByNameLimit}`;\n        fetch(url).then((r) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (r.status === 200) {\n            r.json().then((results) => {\n              if (results) {\n                this.setState({\n                  by_name: results.by_name,\n                  by_name_total: results.by_name_total,\n                  by_name_limit: results.by_name_limit\n                });\n              }\n            });\n          }\n        });\n      }\n    );\n  };\n\n  displayYears = (year) => {\n    let yearEnd = year + 9;\n    const currentYear = new Date().getFullYear();\n    if (yearEnd > currentYear) {\n      yearEnd = currentYear;\n    }\n    return `${year}${yearEnd}`;\n  };\n\n  render() {\n    const { redirectTo, searchYear } = this.state;\n    if (redirectTo) {\n      return <Redirect to={redirectTo} push={true} />;\n    }\n    let results = null;\n    let pagination = null;\n    if (this.state.results) {\n      let rows = this.state.results;\n      if (this.state.onlyResults) {\n        let onlyIds = this.state.onlyResults.map((r) => r.id);\n        rows = rows.filter((row) => onlyIds.includes(row.id));\n      }\n      results = (\n        <Results\n          results={rows}\n          searched={this.searched}\n          popularityFactor={this.state.popularityFactor}\n          showYear={Boolean(searchYear)}\n        />\n      );\n      if (this.state.results.length < this.state.total) {\n        pagination = (\n          <Pagination\n            location={this.props.location}\n            page={this.state.resultsPageIndex}\n            onLoadMore={this.onLoadMore}\n          />\n        );\n      }\n    }\n\n    let byName = null;\n    if (this.state.by_name && this.state.by_name.length) {\n      byName = (\n        <SongsByName\n          results={this.state.by_name}\n          total={this.state.by_name_total}\n          limit={this.state.by_name_limit}\n          loadMoreByName={this.loadMoreByName}\n        />\n      );\n    }\n\n    let searchToggles = (\n      <span className=\"help-block toggles\">\n        {this.state.results && this.state.results.length ? (\n          <button\n            type=\"button\"\n            className={\n              this.state.shareSearch\n                ? \"btn btn-default btn-sm active\"\n                : \"btn btn-default btn-sm\"\n            }\n            onClick={this.toggleShareSearch}\n          >\n            {this.state.shareSearch\n              ? \"Hide share search\"\n              : \"Share search results\"}\n          </button>\n        ) : null}\n        <button\n          type=\"button\"\n          className={\n            this.state.advancedSearch\n              ? \"btn btn-default btn-sm active\"\n              : \"btn btn-default btn-sm\"\n          }\n          onClick={this.toggleAdvancedSearch}\n        >\n          {this.state.advancedSearch ? \"Hide search options\" : \"Search options\"}\n        </button>\n      </span>\n    );\n    let advancedSearchStatus = null;\n    if (!this.state.advancedSearch) {\n      let parts = [];\n      // if you currently don't have the advanced search options open,\n      // show what's currently selected.\n      if (this.state.searchLanguage && this.state.searchLanguage !== \"en\") {\n        const language = this.state.searchLanguages.filter((e) => {\n          return e.code === this.state.searchLanguage;\n        })[0].language;\n        parts.push(`Language: ${language}`);\n      }\n\n      if (this.state.searchYear) {\n        parts.push(\n          `Years: ${this.displayYears(parseInt(this.state.searchYear))}`\n        );\n      }\n\n      if (this.state.artistName) {\n        parts.push(`Artist: ${this.state.artistName}`);\n      }\n      if (parts.length) {\n        advancedSearchStatus = (\n          <span className=\"help-block advanced-search-status\">\n            <b>Search options:</b> {parts.join(\", \")}\n          </span>\n        );\n      }\n    }\n\n    let advancedInput = null;\n    if (this.state.advancedSearch) {\n      advancedInput = (\n        <div className=\"advanced\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <input\n              type=\"search\"\n              ref={this.artistRef}\n              value={this.state.artistName}\n              className=\"form-control input-lg\"\n              maxLength={100}\n              onFocus={this.onFocusArtist}\n              onBlur={this.onBlurArtist}\n              onChange={this.onChangeArtistName}\n              onKeyDown={this.onKeyDownArtistSearch}\n              aria-label=\"Artist search\"\n              placeholder=\"Artist or band name\"\n            />\n            {this.state.autocompleteArtistSuggestions &&\n            this.state.showAutocompleteArtistSuggestions ? (\n              <ShowAutocompleteArtistSuggestions\n                onSelectSuggestion={this.onSelectArtistSuggestion}\n                highlight={this.state.autocompleteArtistHighlight}\n                suggestions={this.state.autocompleteArtistSuggestions}\n              />\n            ) : null}\n          </div>\n          <div className=\"form-group\">\n            <select\n              ref={this.languageRef}\n              onChange={this.onChangeLanguage}\n              value={this.state.searchLanguage}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any language</option>\n              {this.state.searchLanguages.map((each) => {\n                let text = each.language;\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={each.code} value={each.code}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group\">\n            <select\n              // ref={this.yearRef}\n              onChange={this.onChangeYear}\n              value={this.state.searchYear}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any year</option>\n              {this.state.searchYears.map((each) => {\n                let text = this.displayYears(each.year);\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={text} value={each.year}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group text-right\">\n            <button type=\"submit\" className=\"btn btn-primary\">\n              Search Now\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    let keyPhrases = null;\n    if (\n      this.state.results &&\n      // !this.state.results.length &&\n      this.state.keyPhrases &&\n      this.state.keyPhrases.length\n    ) {\n      keyPhrases = (\n        <ShowKeyPhrases\n          nothingFound={!this.state.results.length}\n          phrases={this.state.keyPhrases}\n          submitPhrase={this.submitPhrase}\n        />\n      );\n    }\n\n    return (\n      <div>\n        <form onSubmit={this.onSubmit} action=\"/api/search/redirect\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <div className=\"input-group input-group-lg\">\n              <input\n                type=\"search\"\n                ref={this.searchRef}\n                name=\"q\"\n                autoComplete=\"off\"\n                value={this.state.q}\n                onFocus={this.onFocusSearch}\n                onBlur={this.onBlurSearch}\n                onChange={this.onChangeSearch}\n                onKeyDown={this.onKeyDownSearch}\n                className=\"form-control\"\n                maxLength={150}\n                aria-label=\"Lyrics search\"\n                placeholder={this.state.placeholder}\n              />\n              <span className=\"input-group-btn\">\n                <button\n                  className=\"btn btn-default btn-lg\"\n                  type=\"submit\"\n                  title=\"Click to search\"\n                >\n                  Search\n                </button>\n              </span>\n            </div>\n            {this.state.searchMaxLength ? (\n              <ShowMaxlengthWarning\n                length={this.state.searchMaxLength[0]}\n                maxLength={this.state.searchMaxLength[1]}\n              />\n            ) : null}\n            {this.state.desperateSearch &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowDesperateSearchWarning />\n            ) : null}\n            {!this.state.desperateSearch &&\n            this.state.missing &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowMissingSearchWarning missing={this.state.missing} />\n            ) : null}\n            {this.state.autocompleteSuggestions &&\n            this.state.showAutocompleteSuggestions ? (\n              <ShowAutocompleteSuggestions\n                q={this.state.q}\n                onSelectSuggestion={this.onSelectSuggestion}\n                onSelectSuggestionAll={this.onSelectSuggestionAll}\n                highlight={this.state.autocompleteHighlight}\n                suggestions={this.state.autocompleteSuggestions}\n                searchSuggestions={this.state.autocompleteSearchSuggestions}\n              />\n            ) : null}\n          </div>\n          <ShowResultCount\n            results={this.state.results}\n            total={this.state.total}\n            byName={this.state.by_name}\n            onlyResults={this.state.onlyResults}\n          />\n\n          {searchToggles}\n          {advancedSearchStatus}\n          {this.state.shareSearch ? (\n            <ShareInput searched={this.searched} />\n          ) : null}\n          {advancedInput}\n        </form>\n       \n        {/* <a href=\"http://insiderapps.com/\" target=\"_blank\">\n          <img className=\"deskview\" src={pics} />\n        </a> */}\n       {/* <a href=\"http://insiderapps.com/\" target=\"_blank\">\n          <img className=\"mobileview\" src={mobileimgs}  />\n        </a> */}\n      \n        \n        <div id=\"waldo-tag-11815\">\n          <script>\n            {`googletag.cmd.push(function() {\n              googletag.display = \"waldo-tag-11815\";\n            })`};\n          </script>\n        </div>\n\n        \n        {/* <CountdownTimer targetDate={dateTimeAfterThreeDays} /> */}\n        \n\n        {this.state.searchError ? (\n          <SearchError error={this.state.searchError} />\n        ) : null}\n        {this.state.showExamples ? (\n          <ShowExamples\n            sampleSearch={this.sampleSearch}\n            examples={this.state.searchExamples}\n          />\n        ) : null}\n        {this.state.showRecentComments && this.state.recentComments ? (\n          <ShowRecentCommentsWrapper\n            comments={this.state.recentComments.comments}\n          />\n        ) : null}\n        {/* {suggestions} */}\n        {byName}\n        {keyPhrases}\n        {results}\n        {this.state.searching ? <Loading text=\"Searching...\" /> : null}\n        {pagination}\n        {this.state.slowSearch ? (\n          <SlowSearch reloadSearch={this.reloadSearch} />\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default Home;\n\nclass ShowRecentCommentsWrapper extends React.PureComponent {\n  render() {\n    const { comments } = this.props;\n    return (\n      <div className=\"recent-comments\" style={{ marginTop: 50 }}>\n        <h4>\n          Recent Comments (<Link to=\"/comments\">All</Link>)\n        </h4>\n        <ShowRecentComments comments={comments} isRoot={true} />\n        <div className=\"load-more\">\n          <Link to=\"/comments\">More recent comments</Link>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst ShowResultCount = React.memo(\n  ({ results, total, onlyResults, byName }) => {\n    if (!results) {\n      return null;\n    }\n    let countResults = null;\n    if (results) {\n      const byNameCount = byName ? byName.length : 0;\n      if (onlyResults) {\n        countResults = onlyResults.length + byNameCount;\n      } else {\n        countResults = results.length + byNameCount;\n      }\n    }\n    return (\n      <p className=\"result-metadata text-right\">\n        <b>\n          {total >= 10000 ? \"More than \" : \"\"}\n          {total.toLocaleString()} {total === 1 ? \"song found\" : \"songs found\"}\n        </b>{\" \"}\n        {countResults && countResults < total\n          ? `(showing ${countResults})`\n          : null}\n      </p>\n    );\n  }\n);\n\nclass ShareInput extends React.PureComponent {\n  state = {\n    copied: false,\n    failed: false,\n    hasFocused: false\n  };\n\n  absurlRef = React.createRef();\n\n  render() {\n    const absoluteUrl = window.location.href;\n    return (\n      <div className=\"form-group\" style={{ marginTop: 30 }}>\n        <div className=\"input-group\">\n          <label className=\"sr-only\">URL:</label>\n          <input\n            ref={this.absurlRef}\n            type=\"text\"\n            className=\"form-control\"\n            readOnly\n            value={absoluteUrl}\n            onFocus={() => {\n              if (!this.state.hasFocused) {\n                this.absurlRef.current.select();\n                this.setState({ hasFocused: true });\n              }\n            }}\n          />\n          <span className=\"input-group-btn\">\n            <button\n              type=\"button\"\n              className={\n                this.state.copied ? \"btn btn-success\" : \"btn btn-primary\"\n              }\n              title=\"Click to copy to clipboard\"\n              onClick={(event) => {\n                event.preventDefault();\n                this.absurlRef.current.select();\n                if (copy(absoluteUrl)) {\n                  this.setState({ copied: true, failed: false }, () => {\n                    if (this.props.searched && !this.copied) {\n                      this.copied = this.props.searched;\n                      fetch(`/api/search/copied/${this.props.searched}`, {\n                        method: \"POST\"\n                      });\n                    }\n                  });\n                } else {\n                  this.setState({ copied: false, failed: true });\n                }\n              }}\n            >\n              {this.state.copied ? \"Copied to clipboard\" : \"Copy to clipboard\"}\n            </button>\n          </span>\n        </div>\n        {this.state.copied ? (\n          <p>\n            The URL to this search has now been copied to your clipboard so you\n            can paste it anywhere. Thanks!\n          </p>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst ShowKeyPhrases = React.memo(({ phrases, submitPhrase, nothingFound }) => {\n  let subTitle = null;\n  if (nothingFound) {\n    if (phrases.length === 1) {\n      subTitle = <h4>But, try this...</h4>;\n    } else {\n      subTitle = <h4>But, try these...</h4>;\n    }\n  }\n  return (\n    <div className=\"key-phrases\">\n      {nothingFound ? (\n        <h3>Nothing found</h3>\n      ) : (\n        <h3>Fuzzy results. Try breaking it up...</h3>\n      )}\n      {subTitle}\n      <table className=\"table suggestions table-condensed\">\n        <tbody>\n          {phrases.map((phrase) => {\n            let url = `/q/${phrase.phrase}`;\n            if (phrase.year) {\n              url += `?year=${phrase.year}`;\n            }\n            return (\n              <tr key={phrase.phrase}>\n                <td>\n                  <a href={url} onClick={(e) => submitPhrase(e, phrase)}>\n                    {phrase.diff_html ? (\n                      <span\n                        dangerouslySetInnerHTML={{ __html: phrase.diff_html }}\n                      />\n                    ) : (\n                      phrase.phrase\n                    )}\n                  </a>\n                </td>\n                <td>\n                  <b>{phrase.total}</b> {phrase.total === 1 ? \"song\" : \"songs\"}\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n});\n\nconst ShowAutocompleteSuggestions = React.memo(\n  ({\n    q,\n    highlight,\n    suggestions,\n    searchSuggestions,\n    onSelectSuggestion,\n    onSelectSuggestionAll\n  }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {searchSuggestions && q && searchSuggestions.total ? (\n            <li\n              onClick={onSelectSuggestionAll}\n              className={\n                highlight === 0\n                  ? \"active search-suggestion\"\n                  : \"search-suggestion\"\n              }\n            >\n              {searchSuggestions.capped ? (\n                <a\n                  style={{ float: \"right\" }}\n                  href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}\n                >\n                  {searchSuggestions.total.toLocaleString()}{\" \"}\n                  {searchSuggestions.desperate\n                    ? \"approximate matches\"\n                    : \"good matches\"}\n                </a>\n              ) : null}\n              <a href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}>\n                Search for <i>{q}</i>\n              </a>\n            </li>\n          ) : null}\n\n          {suggestions.map((s, index) => {\n            const className = index + 1 === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={s.id ? s.id : s.text}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                {s.id ? (\n                  <ShowAutocompleteSuggestionSong song={s} />\n                ) : (\n                  <ShowAutocompleteSuggestion\n                    text={s.text}\n                    html={s.html}\n                    found={s.found}\n                  />\n                )}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nconst ShowAutocompleteSuggestion = React.memo(({ found, html }) => {\n  if (found) {\n    return (\n      <p className=\"search\">\n        <small>{found}</small>\n        <span dangerouslySetInnerHTML={{ __html: html }} />\n      </p>\n    );\n  } else {\n    return <p className=\"search\" dangerouslySetInnerHTML={{ __html: html }} />;\n  }\n});\n\nconst ShowAutocompleteSuggestionSong = React.memo(({ song }) => {\n  let imageUrl = placeholderImage;\n  if (song.image) {\n    if (song.image.thumbnail100) {\n      imageUrl = song.image.thumbnail100;\n    } else {\n      imageUrl = song.image.url;\n    }\n  }\n  return (\n    <div className=\"media autocomplete-suggestion-song\">\n      <div className=\"media-left\">\n        <AutocompleteImage url={imageUrl} name={song.name} />\n      </div>\n      <div className=\"media-body\">\n        <h5 className=\"artist-name\">\n          <b>{song.name}</b>\n          <span className=\"by\">{\" by \"}</span>\n          {song.artist.name}\n        </h5>\n        {song.fragments.map((fragment, i) => {\n          return (\n            <p\n              key={`${song.id}:${i}`}\n              dangerouslySetInnerHTML={{ __html: fragment }}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n});\n\nconst ShowAutocompleteArtistSuggestions = React.memo(\n  ({ highlight, suggestions, onSelectSuggestion }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {suggestions.map((s, index) => {\n            let className = index === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={`${s.text}${index}`}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                <div className=\"media\">\n                  <div className=\"media-left\">\n                    <AutocompleteImage\n                      url={s.thumbnail100 || s.image || placeholderImage}\n                      name={s.text}\n                    />\n                  </div>\n                  <div className=\"media-body\">\n                    <h5\n                      className=\"artist-name\"\n                      dangerouslySetInnerHTML={{ __html: s.html }}\n                    />\n                    <span className=\"artist-metadata\">\n                      {s.songs ? s.songs : \"0\"} songs\n                    </span>\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nfunction ShowMaxlengthWarning({ length, maxLength }) {\n  let className = \"help-block maxlength\";\n  if (length === maxLength) {\n    className += \" danger\";\n  }\n  return (\n    <span className={className}>\n      {length} of max {maxLength} characters!\n    </span>\n  );\n}\n\nfunction ShowDesperateSearchWarning() {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Nothing could be found with that exact search. Showing fuzzy\n      matches.\n    </span>\n  );\n}\n\nfunction ShowMissingSearchWarning({ missing }) {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Results found by discarding{\" \"}\n      <i style={{ textDecoration: \"line-through\" }}>{missing}</i>.\n    </span>\n  );\n}\n\nconst ShowExamples = React.memo(({ sampleSearch, examples }) => {\n  return (\n    <div className=\"examples\">\n      <h4>Successful searches for songs by lyrics</h4>\n      <ul>\n        {examples.map((search) => {\n          let link = \"/q/\" + encodeURIComponent(search.term);\n          link += `?example=${search.id}`;\n          if (search.artist) {\n            link += `&artist=${encodeURIComponent(search.artist)}`;\n          }\n          if (search.language) {\n            link += `&language=${encodeURIComponent(search.language)}`;\n          }\n          if (search.year) {\n            link += `&year=${search.year}`;\n          }\n          let searchMeta = null;\n          const searchMetaStrings = [];\n\n          if (search.artist) {\n            searchMetaStrings.push([\"artist\", search.artist]);\n          }\n          if (search.language) {\n            searchMetaStrings.push([\"language\", search.language_human]);\n          }\n          if (search.year) {\n            searchMetaStrings.push([\"year\", search.year]);\n          }\n          if (searchMetaStrings.length) {\n            searchMeta = (\n              <span>\n                (\n                {searchMetaStrings.map((n, i) => {\n                  return (\n                    <React.Fragment key={n[0]}>\n                      {n[0]} <b>{n[1]}</b>\n                      {i + 1 < searchMetaStrings.length ? \", \" : \"\"}\n                    </React.Fragment>\n                  );\n                })}\n                )\n              </span>\n            );\n          }\n\n          return (\n            <li key={search.id}>\n              <Link to={link} onClick={(e) => sampleSearch(e, search)}>\n                <b>{search.term}</b>\n              </Link>{\" \"}\n              {searchMeta} <i>{search.total_found} found</i>\n              <br />\n              {search.opened.map((song) => {\n                return (\n                  <span className=\"opened\" key={song.id}>\n                    clicked on{\" \"}\n                    <Link to={song._url}>\n                      <b>{song.name}</b> by <b>{song.artist.name}</b>\n                    </Link>\n                  </span>\n                );\n              })}\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n});\n\nfunction SlowSearch({ reloadSearch }) {\n  return (\n    <div className=\"slow-search\">\n      <h4>Sorry, search seems to take longer than normal!</h4>\n      <p>\n        Perhaps it got stuck? <br />\n        <button\n          type=\"button\"\n          className=\"btn btn-default btn-sm\"\n          onClick={reloadSearch}\n        >\n          Reload search\n        </button>\n      </p>\n    </div>\n  );\n}\n\nfunction SearchError({ error }) {\n  return (\n    <div className=\"search-error\">\n      <h4>Sorry, an error occured</h4>\n      {error.status === 400 ? (\n        <p>\n          The query was invalid <code>{error.text}</code>\n        </p>\n      ) : (\n        <p>The server basically failed to compute the search</p>\n      )}\n      {error.status >= 500 && <p>Perhaps simply try again a little later.</p>}\n      {error.status >= 500 && (\n        <p>\n          <button\n            type=\"button\"\n            className=\"btn btn-default\"\n            onClick={(event) => {\n              window.location.reload(true);\n            }}\n          >\n            Reload to try again\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nclass Results extends React.PureComponent {\n  firstLoad = true;\n  componentDidMount() {\n    if (!isServer) {\n      loadCarbonScript();\n    }\n    this.firstLoad = false;\n  }\n  componentDidUpdate(prevProps) {\n    // Is this if-statement necessary? I mean, isn't componentDidUpdate\n    // something that *only* happens with non-SSR rendering??\n    if (!isServer && prevProps.results !== this.props.results) {\n      loadCarbonScript();\n    }\n  }\n  render() {\n    const { results, searched, popularityFactor, showYear } = this.props;\n    return (\n      <div>\n        {/* This extra span exists to debug if ads are enabled or not */}\n        {!NO_ADS ? <div id=\"carbonadsouter\" /> : <span id=\"_nocardonads\" />}\n\n        <div className=\"results\">\n          {results.map((result, index) => {\n            return (\n              <Result\n                key={result.id}\n                result={result}\n                searched={searched}\n                expandedByDefault={results.length === 1}\n                firstResult={index === 0}\n                popularityFactor={popularityFactor}\n                firstLoad={this.firstLoad}\n                showYear={showYear}\n              />\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass Result extends React.PureComponent {\n  state = {\n    collapsed: true,\n    itunes: null,\n    amazon: null,\n    textHtml: this.props.result.text_html\n  };\n  affiliateLookupStarted = [];\n\n  componentDidMount() {\n    if (this.props.expandedByDefault) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  onExpandClick = (event) => {\n    event.preventDefault();\n    this.expand();\n  };\n\n  expand() {\n    const wasCollapsed = this.state.collapsed;\n    this.setState({ collapsed: false });\n    this.fetchTextHTML().then(() => {\n      if (wasCollapsed) {\n        if (this.props.searched) {\n          let recordURL = `/api/song/${this.props.result.id}/`;\n          recordURL += `expand/${this.props.searched}`;\n          fetch(recordURL, { method: \"POST\" })\n            .then((r) => r.json())\n            .then((result) => {\n              // nothing to do\n            });\n        }\n      }\n    });\n  }\n\n  fetchTextHTML() {\n    if (this.state.textHtml) {\n      return Promise.resolve();\n    } else {\n      const url = `/api/song/${this.props.result.id}?text_only=true`;\n      return fetch(url)\n        .then((r) => r.json())\n        .then((result) => {\n          if (this.dismounted) {\n            return;\n          }\n          this.setState({\n            textHtml: result.song.text_html\n          });\n        });\n    }\n  }\n\n  render() {\n    const { result, popularityFactor, firstResult, firstLoad, showYear } =\n      this.props;\n    let className = \"result\";\n    if (this.state.collapsed) {\n      className += \" collapsed\";\n    }\n    let songURL = result._url;\n    let image;\n\n    if (result.image) {\n      image = (\n        <SongImage\n          url={result.image.url}\n          className=\"pull-right img-thumbnail album\"\n          name={result.image.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    } else {\n      image = (\n        <SongImage\n          url={null}\n          className=\"pull-right img-thumbnail\"\n          name={result.artist.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    }\n\n    let rest = (\n      <p className=\"read-more\">\n        <Link to={songURL}>VIEW SONG</Link>{\" \"}\n        <Link to={songURL} onClick={this.onExpandClick}>\n          EXPAND SONG\n        </Link>\n      </p>\n    );\n    if (!this.state.collapsed) {\n      let searchedId = null;\n      let searched = null;\n      try {\n        searched = localStorage.getItem(\"searched\");\n      } catch (ex) {\n        console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n      }\n      if (searched) {\n        if (searched.includes(\",\")) {\n          // The new way\n          searchedId = parseInt(searched.split(\",\")[0], 10);\n        } else {\n          // The old way!\n          searchedId = parseInt(searched, 10);\n        }\n      }\n      rest = (\n        <div className=\"rest\">\n          <div className=\"text\">\n            <h3>Full Text</h3>\n            {this.state.textHtml ? (\n              <RenderParagraphs text={this.state.textHtml} />\n            ) : (\n              <i>Loading full text...</i>\n            )}\n            <SongComments\n              comments={null}\n              commentsCount={null}\n              song={result}\n              searchedId={searchedId}\n            />\n            <AmazonRelatedProducts song={result} />\n\n            {/* {this.state.textHtml && (\n              <YouTubeSnippetIntersectionLazy song={result} />\n            )} */}\n            <p className=\"load-more\">\n              <Link to={songURL}>GO TO SONG PAGE</Link>\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    let artistName = <b>{result.artist.name}</b>;\n    if (result.artist.fragment) {\n      artistName = (\n        <b dangerouslySetInnerHTML={{ __html: result.artist.fragment }} />\n      );\n    }\n\n    let tooltipTitle;\n    if (process.env.NODE_ENV === \"development\") {\n      let score = result.score.toFixed(4);\n      tooltipTitle = `Score ${score}`;\n      if (result.popularity) {\n        tooltipTitle += ` Popularity: ${result.popularity.toFixed(6)}`;\n      }\n    } else {\n      tooltipTitle = \"Click to view just this song\";\n    }\n\n    return (\n      <div className={className}>\n        <div className=\"head\">\n          <Link to={songURL}>{image}</Link>\n          <h2 title={tooltipTitle}>\n            <Link to={songURL}>{result.name}</Link>\n            {showYear && result.year && (\n              <span className=\"year\"> {result.year}</span>\n            )}\n            {process.env.NODE_ENV === \"development\" ? (\n              <ShowSongScore song={result} factor={popularityFactor} />\n            ) : null}\n          </h2>\n          <h3>\n            <span className=\"by\">by</span> {artistName}\n          </h3>\n\n          {result.albums.length ? <Albums albums={result.albums} /> : null}\n        </div>\n        <div className=\"fragments\">\n          {result.fragments.map((fragment, i) => {\n            return (\n              <p\n                key={`${result.id}${i}`}\n                dangerouslySetInnerHTML={{ __html: fragment }}\n              />\n            );\n          })}\n        </div>\n        {rest}\n      </div>\n    );\n  }\n}\n\nconst SongImage = React.memo(({ url, name, forceLoad, className }) => {\n  // If the song doesn't haven an image, no point messing around.\n  if (!url) {\n    return (\n      <img\n        src={placeholderImage}\n        className={className}\n        title={name}\n        alt={name}\n      />\n    );\n  }\n  return (\n    <img\n      src={url}\n      className={className}\n      title={name}\n      alt={name}\n      loading={forceLoad ? undefined : \"lazy\"}\n    />\n  );\n});\n\n// This assumes that we'll sooner or later need the lazyloadThumbnailImage image\nif (!isServer) {\n  new Image().src = lazyloadThumbnailImage;\n}\n\n// Module level \"cache\" of which image URLs have been successfully inserted\n// into the DOM at least once.\n// By knowing these, we can, on repeat URLs, avoid the whole lazy-load\n// image swapping trick.\nconst loadedOnce = new Set();\n\nfunction AutocompleteImage({ url, name }) {\n  const [src, setSrc] = useState(\n    loadedOnce.has(url) ? url : lazyloadThumbnailImage\n  );\n\n  useEffect(() => {\n    let preloadImg = null;\n    let dismounted = false;\n\n    if (src === lazyloadThumbnailImage) {\n      // We need to preload the eventually needed image.\n      preloadImg = new Image();\n\n      function cb() {\n        if (!dismounted) {\n          setSrc(url);\n        }\n        loadedOnce.add(url);\n      }\n      // This must come before .decode() otherwise Safari will\n      // raise an EncodingError.\n      preloadImg.src = url;\n      // https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-decode\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode#Browser_compatibility\n      preloadImg.decode\n        ? preloadImg.decode().then(cb, cb)\n        : (preloadImg.onload = cb);\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decoding\n      preloadImg.decoding = \"sync\";\n    }\n\n    return () => {\n      if (preloadImg) {\n        // Immediately undo the preloading since we might not need this image.\n        // See https://jsfiddle.net/nw34gLgt/ for demo of this technique.\n        preloadImg.src = \"\";\n      }\n      dismounted = true;\n    };\n  }, [url, src]);\n\n  if (!url) {\n    // Don't even bother with lazy loading.\n    return (\n      <img\n        className=\"img-rounded\"\n        src={lazyloadThumbnailImage}\n        alt={name}\n        title={name}\n      />\n    );\n  }\n\n  return <img className=\"img-rounded\" src={src} alt={name} title={name} />;\n}\n\nfunction ShowSongScore({ song, factor = 20 }) {\n  const s = song.score - factor * song.popularity;\n  return (\n    <code>\n      {song.score.toFixed(3)} = {s.toFixed(3)} + {factor}\n      &times;\n      {song.popularity.toFixed(4)}\n    </code>\n  );\n}\n\nconst SongsByName = React.memo(({ results, total, limit, loadMoreByName }) => {\n  return (\n    <div className=\"by-name\">\n      <h4>Songs by name</h4>\n      <ul>\n        {results.map((s) => {\n          return (\n            <li key={s.id}>\n              <Link to={s._url}>\n                <b dangerouslySetInnerHTML={{ __html: s.fragment }} /> by{\" \"}\n                <b>{s.artist.name}</b>\n              </Link>\n            </li>\n          );\n        })}\n      </ul>\n      {total > limit ? (\n        <button className=\"btn btn-default btn-sm\" onClick={loadMoreByName}>\n          {total > 20\n            ? \"Show more songs by name\"\n            : `Show all (${total}) songs by name`}\n        </button>\n      ) : null}\n    </div>\n  );\n});\n\nconst Albums = React.memo(({ albums }) => {\n  return (\n    <p className=\"albums\">\n      {albums.map((album, i) => {\n        const parts = [<b key={album.id}>{album.name}</b>];\n        if (album.year) {\n          parts.push(` (${album.year})`);\n        }\n        if (i + 1 < albums.length) {\n          parts.push(\", \");\n        }\n        return parts;\n      })}\n    </p>\n  );\n});\n\nconst Pagination = React.memo(({ location, onLoadMore }) => {\n  const currentURL = location.pathname + location.search;\n  return (\n    <div className=\"load-more\">\n      <a href={currentURL} onClick={onLoadMore}>\n        LOAD MORE RESULTS\n      </a>\n    </div>\n  );\n});\n","import React, { Component } from \"react\";\nimport { cachedFetch } from \"./Cache\";\nimport { FormattedNumber, ServerError, SetHTMLHeaders } from \"./Common\";\n\nclass About extends Component {\n  state = {\n    serverError: null,\n    totals: (this.props.totalStats && this.props.totalStats.totals) || null\n  };\n\n  componentDidMount() {\n    SetHTMLHeaders({\n      title: \"About - Song Search\"\n    });\n    if (!this.state.totals) {\n      return cachedFetch(\"/api/stats/totals-simple\").then(r => {\n        if (r.ok) {\n          return r.json().then(results => {\n            if (results) {\n              this.setState({ serverError: null, totals: results.totals });\n            }\n          });\n        } else {\n          this.setState({ serverError: r });\n        }\n      });\n    }\n  }\n\n  render() {\n    const { serverError, totals } = this.state;\n    return (\n      <div>\n        <p>\n          Made by Peter Bengtsson<br/>\n          For all inquires email <a href=\"mailto:info@songsear.ch\"> info@songsear.ch</a>\n        </p>\n        {serverError && <ServerError />}\n        {totals ? <ShowNumbers numbers={totals} /> : null}\n      </div>\n    );\n  }\n}\n\nexport default About;\n\nfunction ShowNumbers({ numbers }) {\n  return (\n    <div className=\"numbers\">\n      <p>\n        There are currently{\" \"}\n        <b>\n          <FormattedNumber value={numbers.songs} /> songs\n        </b>{\" \"}\n        to search amongst{\" \"}\n        <b>\n          <FormattedNumber value={numbers.artists} /> artists\n        </b>{\" \"}\n        in{\" \"}\n        <b>\n          <FormattedNumber value={numbers.albums} /> albums\n        </b>\n        .\n      </p>\n      <p>\n        In total{\" \"}\n        <b>\n          <FormattedNumber value={numbers.searches} /> searches\n        </b>{\" \"}\n        have been made.\n      </p>\n    </div>\n  );\n}\n","import React, { useEffect } from \"react\";\nimport useSWR from \"swr\";\n\nimport { ServerError } from \"./Common\";\n\nfunction PrivacyPolicy() {\n  useEffect(() => {\n    document.title = \"Privacy Policy of Song Search\";\n  });\n  const { data, error } = useSWR(\n    `${process.env.PUBLIC_URL}/static/privacy-policy-text.html`,\n    async (url) => {\n      const r = await fetch(url);\n      if (!r.ok) {\n        if (process.env.NODE_ENV === \"development\") {\n          console.warn(`${r.status} on ${url}`);\n        }\n        throw new Error(`${r.status} on ${url}`);\n      }\n      return await r.text();\n    },\n    { revalidateOnFocus: false }\n  );\n\n  if (error) {\n    return <ServerError />;\n  }\n\n  return (\n    <div>\n      <h2>Privacy Policy</h2>\n      {data ? (\n        <div dangerouslySetInnerHTML={{ __html: data }}></div>\n      ) : (\n        <p>\n          <i>Loading privacy policy text...</i>\n        </p>\n      )}\n    </div>\n  );\n}\n\nexport default PrivacyPolicy;\n","import React, { useEffect, useState, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Waypoint } from \"react-waypoint\";\nimport { Helmet } from \"react-helmet\";  \nimport {\n  Loading,\n  SetHTMLHeaders,\n  isServer,\n  YouTubeSnippet,\n  SpotifySnippet,\n  IntersectionLazy,\n  // loadCarbonScript,\n  loadAdsenseScript,\n  loadAmplifiedScript,\n  RenderParagraphs,\n  ServerError,\n  AmazonRelatedProducts\n} from \"./Common\";\nimport { cachedFetch } from \"./Cache\";\nimport { SongComments } from \"./Comments\";\n\nimport \"./Song.css\";\n\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\nconst skullImage = PUBLIC_URL + \"/static/skull.png\";\n\nconst NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\n\nconst AdTag = (props) => {\n   useEffect(() => {\n        if (window.cf_async === undefined) {\n            window.cf_async = false;\n        }\n        document.getElementById('inject_ad')\n        let unique_part = Math.floor((Math.random() * 999999999));\n        var opts = {\n            artist: props.Artistname,\n            song: props.Songname,\n            adunit_id: 100004858,\n            div_id: \"cf_async_\" + unique_part\n        };\n        var cf_div = document.createElement(\"div\");\n        cf_div.setAttribute(\"id\", opts.div_id);\n        document.getElementById('inject_ad').parentNode.setAttribute(\"id\", \"ad_\" + unique_part);\n        document.getElementById(\"ad_\" + unique_part).appendChild(cf_div);\n        var c=function(){cf.showAsyncAd(opts)};if(typeof window.cf !== 'undefined')c();else{cf_async=!0;var r=document.createElement(\"script\"),s=document.getElementsByTagName(\"script\")[0];r.async=!0;r.src=\"//srv.tunefindforfans.com/fruits/apricots.js\";r.readyState?r.onreadystatechange=function(){if(\"loaded\"==r.readyState||\"complete\"==r.readyState)r.onreadystatechange=null,c()}:r.onload=c;s.parentNode.insertBefore(r,s)};\n   }, [])\n\n    return <>\n        <div id=\"inject_ad\"></div>\n    </>\n}\n\nclass Song extends React.Component {\n  state = {\n    song: this.props.song || null,\n    loading: false,\n    notFound: this.props.songNotFound || false,\n    serverError: null\n  };\n\n  componentDidMount() {\n    const { match } = this.props;\n    const id = parseInt(match.params.id, 10);\n    if (!this.state.song || this.state.song.id !== id) {\n      if (!this.props.songNotFound) {\n        this.loadSong(id);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.id !== prevProps.match.params.id) {\n      this.setState(\n        {\n          song: null,\n          loading: false,\n          notFound: false,\n          serverError: null\n        },\n        () => {\n          try {\n            localStorage.removeItem(\"searched\");\n          } catch (ex) {\n            console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");\n          }\n\n          this.loadSong(this.props.match.params.id);\n        }\n      );\n    }\n  }\n\n  loadSong(id) {\n    SetHTMLHeaders({\n      title: \"Loading... - Song Search\"\n    });\n    if (!isServer) {\n      this.showLoadingSoon = window.setTimeout(() => {\n        if (!this.dismounted) {\n          if (\n            !this.state.serverError &&\n            !this.state.notFound &&\n            !this.state.song &&\n            !this.state.loading\n          ) {\n            this.setState({ loading: true });\n          }\n        }\n      }, 500);\n    }\n\n    let url = `/api/song/${id}`;\n    let searched = null;\n    try {\n      searched = localStorage.getItem(\"searched\");\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n    }\n    if (searched) {\n      if (searched.includes(\",\")) {\n        // It *used* to be that what was stored in localStorage.searched was just the\n        // search ID. Then in April 2019 this changed to become `ID,timestamp`.\n        // E.g. '92613,1556152340091'. So, we need to deal with handling both\n        // the new and the old.\n        const timestamp = parseInt(searched.split(\",\")[1], 10);\n        const age = (new Date().getTime() - timestamp) / 1000;\n        if (age > 3600) {\n          searched = null;\n        } else {\n          searched = searched.split(\",\")[0];\n        }\n      }\n      if (searched) {\n        url += `?searched=${encodeURIComponent(searched)}`;\n      }\n    }\n\n    return cachedFetch(url).then((r) => {\n      if (!isServer && this.showLoadingSoon) {\n        window.clearTimeout(this.showLoadingSoon);\n      }\n      if (r.status === 400) {\n        return r.json().then((result) => {\n          this.setState({ loading: false });\n          if (result.error && result.error === \"redirected\") {\n            if (isServer) {\n              this.setState({ notFound: true });\n            } else {\n              document.location.href = result.new_url;\n            }\n          } else {\n            // Some other error\n            this.setState({ serverError: true });\n          }\n        });\n      } else if (r.status === 404) {\n        this.setState({ loading: false, notFound: true });\n        SetHTMLHeaders({ title: \"Not Found\" });\n      } else if (r.status === 500) {\n        this.setState({ loading: false, serverError: true });\n        SetHTMLHeaders({ title: \"Song loading error :(\" });\n      } else {\n        return r.json().then((result) => {\n          if (result && !result.error) {\n            this.renderResult(result);\n          } else if (result && result.error) {\n            console.log(\"ERROR:\", result.error);\n          }\n          // if (searched) {\n          //   localStorage.removeItem(\"searched\");\n          // }\n          return result;\n        });\n      }\n    });\n  }\n\n  renderResult(result) {\n    // Make sure this matches server/render.js\n    let title = `${result.song.name} lyrics by ${result.song.artist.name}`;\n    if (!isServer) {\n      SetHTMLHeaders({\n        title: title,\n        image: result.song.image\n      });\n    }\n    this.setState({\n      loading: false,\n      song: result.song\n    });\n  }\n\n  render() {\n    const { loading, song, serverError, notFound } = this.state;\n\n    return (\n      <div>\n        {loading && <Loading text=\"Loading...\" />}\n        {song && <Result song={song} />}\n\n        {serverError && !song && <ServerError />}\n        {notFound && <NotFound />}\n      </div>\n    );\n  }\n}\n\nfunction Result({ song }) {\n  // useEffect(() => {\n  //   // loadCarbonScript();\n  // }, []);\n\n  let searchedId;\n\n  if (!isServer) {\n    let searched = null;\n    try {\n      searched = localStorage.getItem(\"searched\");\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n    }\n\n    if (searched) {\n      if (searched.includes(\",\")) {\n        // The new way\n        searchedId = parseInt(searched.split(\",\")[0], 10);\n      } else {\n        // The old way!\n        searchedId = parseInt(searched, 10);\n      }\n    }\n  }\n\n  let comments = null;\n  let commentsCount = null;\n  if (song.comments) {\n    comments = song.comments.comments;\n    commentsCount = song.comments.comments_count;\n  }\n\n  return (\n    <div className=\"result song\">\n      <RenderSongHead song={song} />\n      {/* {!NO_ADS ? <div id=\"carbonadsouter\" /> : <span id=\"_nocardonads\" />} */}\n      <RenderParagraphs song={song.id} text={song.text_html} />\n\n      {!NO_ADS && <AmplifiedSnippet song={song} />}\n\n      <SongComments\n        comments={comments}\n        commentsCount={commentsCount}\n        song={song}\n        searchedId={searchedId}\n      />\n      <ShareSong song={song} />\n      <AmazonRelatedProducts song={song} />\n      {!isServer ? (\n        <IntersectionLazy render={() => <SpotifySnippet song={song} />} />\n      ) : null}\n      {!isServer ? (\n        <IntersectionLazy render={() => <YouTubeSnippet song={song} />} />\n      ) : null}\n      {!isServer ? <ShowRelated song={song} /> : null}\n    </div>\n  );\n}\n\nfunction AmplifiedSnippet({ song }) {\n  useEffect(() => {\n    loadAmplifiedScript({ song: song.name, artist: song.artist.name });\n  }, [song]);\n\n  return (\n    <div id=\"amplifiedouter\">\n      <div id=\"amplified_100003500\" />\n    </div>\n  );\n}\n\nfunction ShareSong({ song }) {\n  const [showShare, setShowShare] = useState(false);\n  const [shared, setShared] = useState(false);\n  const [shareError, setShareError] = useState(null);\n  useEffect(() => {\n    if (navigator.share) {\n      setShowShare(true);\n    }\n  }, []);\n  if (!showShare) return null;\n\n  return (\n    <div style={{ margin: \"30px 0\", textAlign: \"center\" }}>\n      <button\n        className=\"btn btn-primary\"\n        onClick={() => {\n          const shareData = {\n            title: song.name,\n            text: `I found '${song.name}' on Song Search!`,\n            url: window.location.href\n          };\n          try {\n            navigator\n              .share(shareData)\n              .then(() => {\n                setShared(true);\n                setShareError(null);\n              })\n              .catch((e) => {\n                setShareError(e);\n              })\n              .finally(() => {\n                fetch(`/api/song/${song.id}/shared/`, {\n                  method: \"POST\"\n                });\n              });\n          } catch (err) {\n            setShareError(err);\n          }\n        }}\n      >\n        {shared ? \"Thanks!\" : \"Share this song\"}\n      </button>\n      {shareError && <p>Sharing failed or was canceled. Oh well.</p>}\n    </div>\n  );\n}\n\n// XXX Check if this React.memo works\nconst RenderSongHead = React.memo(({ song }) => {\n  let image = null;\n  if (song.image) {\n    image = (\n      <img\n        src={song.image.url}\n        alt={song.image.name}\n        className=\"song-picture\"\n      />\n    );\n  } else {\n    image = (\n      <img\n        src={placeholderImage}\n        alt={song.artist.name}\n        width={150}\n        height={150}\n      />\n    );\n  }\n  let albums = null;\n  if (song.albums.length) {\n    let albumNames = song.albums\n      .map((a) => {\n        if (a.year) {\n          return `${a.name} (${a.year})`;\n        } else {\n          return a.name;\n        }\n      })\n      .join(\", \");\n    albums = (\n      <h3>\n        <span className=\"by\">on</span> {albumNames}\n      </h3>\n    );\n  }\n  return (\n    <>\n   <Helmet>\n  <script type=\"text/javascript\">\n   {`cf_page_artist = \"\";\n    cf_page_song = \"\";\n    cf_adunit_id = \"100005466\";\n    cf_flex = true;`}\n    </script>\n<script src=\"//srv.tunefindforfans.com/fruits/apricots.js\"></script>\n    </Helmet>\n    <div className=\"text-center\">\n      {image}\n      <h2 className=\"\">{song.name}</h2>\n      <h3>\n        <span className=\"by\">by</span> {song.artist.name}\n      </h3>\n      {albums}\n      <AdTag Songname={song.name} Artistname={song.artist.name} />\n    </div>\n    </>\n  );\n});\n\nconst ShowRelated = React.memo(({ song }) => {\n  const [related, setRelated] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  const mounted = React.useRef(false);\n\n  useEffect(() => {\n    if (loading && related) {\n      setLoading(false);\n    }\n  }, [related, loading]);\n\n  function loadRelated() {\n    const url = `/api/song/${song.id}/related`;\n    return cachedFetch(url).then((r) => {\n      if (r.ok) {\n        r.json().then((result) => {\n          if (result && result.categories) {\n            setRelated(result.categories);\n          }\n        });\n      }\n    });\n  }\n\n  const _started = useRef();\n\n  function loadRelatedDebounced() {\n    if (!_started.current) {\n      _started.current = new Date().getTime();\n      loadRelated();\n    }\n  }\n\n  function onEnter() {\n    if (!related && !loading) {\n      loadRelatedDebounced();\n    }\n  }\n\n  useEffect(() => {\n    mounted.current = true;\n    return () => {\n      mounted.current = false;\n    };\n  }, []);\n\n  if (related) {\n    if (!related.length) {\n      return null;\n    }\n    return (\n      <div className=\"related\">\n        {related.map((category) => {\n          return (\n            <ShowRelatedGroup\n              key={category.label}\n              label={category.label}\n              songs={category.results}\n            />\n          );\n        })}\n      </div>\n    );\n  } else if (loading) {\n    return null;\n  }\n  return <Waypoint onEnter={onEnter} />;\n});\n\nfunction ShowRelatedGroup({ label, songs }) {\n  return (\n    <div>\n      <h4>{label}</h4>\n      <ul>\n        {songs.map((song) => {\n          return (\n            <li key={song.id}>\n              <Link to={song._url}>\n                <b>{song.name}</b> <span className=\"by\">by</span>{\" \"}\n                {song.artist.name}\n              </Link>\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n\nfunction NotFound() {\n  return (\n    <div className=\"not-found\">\n      <h3>Song Not Found</h3>\n      <p>\n        <img alt=\"Skull\" src={skullImage} />\n      </p>\n      <p>\n        <Link to=\"/\">Try another search</Link>\n      </p>\n    </div>\n  );\n}\n\nexport default Song;\n","import React from \"react\";\n\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst skullImage = PUBLIC_URL + \"/static/skull.png\";\n\nexport class AppErrorBoundary extends React.Component {\n  state = { error: null, submittedErrorId: null };\n\n  static getDerivedStateFromError(error) {\n    return { error };\n  }\n\n  async componentDidCatch(error, errorInfo) {\n    const formData = new FormData();\n    formData.append(\"error\", error.toString());\n    formData.append(\"error_info\", JSON.stringify(errorInfo));\n    formData.append(\"url\", document.location.href);\n    formData.append(\"stack\", error.stack);\n    try {\n      if (localStorage.getItem(\"searched\")) {\n        formData.append(\"searched\", localStorage.getItem(\"searched\"));\n      }\n      if (localStorage.getItem(\"commentEmail\")) {\n        formData.append(\"commentEmail\", localStorage.getItem(\"commentEmail\"));\n      }\n    } catch (ex) {\n      console.log(\"Unable to extract localStorage keys\");\n    }\n    let response;\n    try {\n      response = await fetch(\"/api/errorboundary\", {\n        method: \"POST\",\n        body: formData\n      });\n      if (response.ok) {\n        const submission = await response.json();\n        const submittedErrorId = submission.id;\n        this.setState({ submittedErrorId });\n      } else {\n        console.log(\"Bad response trying to store error boundary.\");\n        console.error(response);\n      }\n    } catch (fetchError) {\n      console.log(\"Unable to send error info to server.\");\n      console.error(fetchError);\n    }\n  }\n\n  render() {\n    if (this.state.error) {\n      return (\n        <div style={{ textAlign: \"center\" }}>\n          <h3 style={{ color: \"#b12704\" }}>Application Error</h3>\n\n          <p>\n            <img alt=\"Skull\" src={skullImage} />\n          </p>\n          <p>\n            <b>Soooo sorry!</b>\n            <br />\n            It appears the application encountered a crash trying to render this\n            page.\n            <br />\n            Please try again later or <a href=\"/\">try another search</a>.\n          </p>\n          <p>\n            <b>\n              <a href=\"/\">Return to home page</a>\n            </b>\n          </p>\n          {this.state.submittedErrorId && (\n            <p>\n              Your error has been submitted to our server. <br />\n              Submission ID: <code>{this.state.submittedErrorId}</code>\n            </p>\n          )}\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { CustomTimeAgo, SetHTMLHeaders, Loading, ServerError } from \"./Common\";\n\nclass MuteComment extends React.Component {\n  state = {\n    loading: false,\n    comment: null,\n    muted: false,\n    notFound: false,\n    serverError: null\n  };\n\n  async componentDidMount() {\n    SetHTMLHeaders({\n      title: \"Mute Comment - Song Search\"\n    });\n    window.setTimeout(() => {\n      const { comment, loading, notFound, serverError } = this.state;\n      if (\n        !this.dismounted &&\n        !comment &&\n        !loading &&\n        !notFound &&\n        !serverError\n      ) {\n        this.setState({ loading: true });\n      }\n    }, 1000);\n    const formData = new FormData();\n    const { match } = this.props;\n    formData.append(\"oid\", match.params.oid);\n    formData.append(\"id\", match.params.id);\n    let response;\n    try {\n      response = await fetch(\"/api/comments/mute\", {\n        method: \"POST\",\n        body: formData\n      });\n    } catch (ex) {\n      this.setState({ serverError: ex, loading: false });\n    }\n\n    if (response.ok) {\n      const result = await response.json();\n      this.setState(\n        {\n          comment: result.comment,\n          muted: true,\n          notFound: false,\n          loading: false,\n          serverError: null\n        },\n        () => {\n          SetHTMLHeaders({\n            title: \"Comment Muted - Song Search\"\n          });\n        }\n      );\n    } else if (response.status === 400) {\n      this.setState(\n        {\n          comment: null,\n          notFound: true,\n          loading: false,\n          serverError: null\n        },\n        () => {\n          SetHTMLHeaders({\n            title: \"Comment Not Found - Song Search\"\n          });\n        }\n      );\n    } else {\n      this.setState({ serverError: response, loading: false });\n    }\n  }\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  render() {\n    const { loading, comment, muted, notFound, serverError } = this.state;\n    if (loading) {\n      return <Loading text=\"One sec...\" />;\n    }\n    if (serverError) return <ServerError />;\n    return (\n      <div>\n        {muted && (\n          <div>\n            <h2>Comment Muted</h2>\n            <p>\n              You will not receive any more email notifications to replies on\n              this comment.\n            </p>\n            <p>\n              <Link to=\"/\">Go back to the Home page</Link>\n            </p>\n          </div>\n        )}\n\n        {notFound && <ShowNotFound />}\n\n        {comment && <ShowCommentData comment={comment} />}\n      </div>\n    );\n  }\n}\n\nexport default MuteComment;\n\nfunction ShowNotFound() {\n  return (\n    <div>\n      <h2>Comment Not Found</h2>\n      <p>\n        Sorry, but the instructions to mute this particular comment could not be\n        found.\n      </p>\n      <p>\n        <Link to=\"/\">Go back to the Home page</Link>\n      </p>\n    </div>\n  );\n}\n\nfunction ShowCommentData({ comment }) {\n  return (\n    <div style={{ marginTop: 70 }}>\n      {comment.song && (\n        <h4 style={{ marginBottom: 20 }}>\n          Song:{\" \"}\n          <a href={`${comment.song._url}#c${comment.id}`}>\n            <b>{comment.song.name}</b> <span className=\"by\">by</span>{\" \"}\n            <b>{comment.song.artist.name}</b>\n          </a>\n        </h4>\n      )}\n      <h4>Comment:</h4>\n      <blockquote dangerouslySetInnerHTML={{ __html: comment.text_rendered }} />\n      <p>\n        Posted <CustomTimeAgo date={comment.created} />\n      </p>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Switch, Route, Link } from \"react-router-dom\";\n\nimport Home from \"./Home\";\nimport About from \"./About\";\nimport PrivacyPolicy from \"./PrivacyPolicy\";\nimport Song from \"./Song\";\nimport { AppErrorBoundary } from \"./ErrorBoundaries\";\nimport MuteComment from \"./MuteComment\";\nimport RecentComments from \"./RecentComments\";\nimport { isServer } from \"./Common\";\n\nexport function NoMatch({ location }) {\n  return (\n    <div>\n      <h2>Page Not Found</h2>\n      <h3>\n        No match for <code>{location.pathname}</code>\n      </h3>\n    </div>\n  );\n}\n\nclass App extends React.Component {\n  render() {\n    const {\n      song,\n      related,\n      songNotFound,\n      results,\n      totalStats,\n      searchExamples,\n      recentComments,\n      recentCommentsHomepage\n    } = this.props;\n\n    let onSongPage = false;\n    if (isServer) {\n      if (song) {\n        onSongPage = true;\n      }\n    } else if (/\\/song\\//.test(window.location.pathname)) {\n      onSongPage = true;\n    }\n\n    return (\n      <div>\n        <div className=\"container\">\n          <div className=\"page-header\">\n            <h1>\n              <Link to=\"/\">Song Search</Link>\n            </h1>\n            {onSongPage ? (\n              <h5 className=\"home-link\">\n                <Link to=\"/\">Try another search</Link>\n              </h5>\n            ) : (\n              <RotatingSubHeader />\n            )}\n          </div>\n          <div className=\"container children\">\n            <AppErrorBoundary>\n              <Switch>\n                <Route\n                  exact\n                  path=\"/\"\n                  render={(props) => {\n                    return (\n                      <Home\n                        {...props}\n                        searchExamples={searchExamples}\n                        recentComments={recentCommentsHomepage}\n                      />\n                    );\n                  }}\n                />\n                <Route\n                  path=\"/q/:q\"\n                  render={(props) => {\n                    return <Home {...props} results={results} />;\n                  }}\n                />\n                <Route\n                  path=\"/song/:artist/:name/:id\"\n                  render={(props) => {\n                    return (\n                      <Song\n                        {...props}\n                        song={song}\n                        related={related}\n                        songNotFound={songNotFound}\n                      />\n                    );\n                  }}\n                />\n                <Route\n                  path=\"/about\"\n                  render={(props) => {\n                    return <About {...props} totalStats={totalStats} />;\n                  }}\n                />\n                <Route path=\"/privacy\" component={PrivacyPolicy} />\n                <Route\n                  path=\"/comments\"\n                  exact\n                  render={(props) => {\n                    return (\n                      <RecentComments\n                        {...props}\n                        recentComments={recentComments}\n                      />\n                    );\n                  }}\n                />\n                <Route\n                  path=\"/comments/p:page\"\n                  render={(props) => {\n                    return (\n                      <RecentComments\n                        {...props}\n                        recentComments={recentComments}\n                      />\n                    );\n                  }}\n                />\n                <Route\n                  path=\"/mute/:oid/:id\"\n                  render={(props) => {\n                    return <MuteComment {...props} />;\n                  }}\n                />\n                <Route component={NoMatch} />\n              </Switch>\n            </AppErrorBoundary>\n          </div>\n        </div>\n        <footer className=\"footer\">\n          <div className=\"container\">\n            <p className=\"text-muted\">\n              <Link to=\"/\">Home</Link>\n              {\"  \"}\n              <Link to=\"/comments\">Recent comments</Link>\n              {\"  \"}\n              <Link to=\"/about\">About this site</Link>\n              {\"  \"}\n              <Link to=\"/privacy\">Privacy Policy</Link>\n              {process.env.NODE_ENV === \"development\" ? (\n                <span> React version {React.version}</span>\n              ) : null}\n            </p>\n          </div>\n        </footer>\n      </div>\n    );\n  }\n}\n\nexport default App;\n\nconst SUB_HEADERS = [\n  \"I'm looking for a song that I heard.\",\n  \"I'm looking for a song I don't know the name of.\",\n  \"I'm looking for a song that goes like this.\",\n  \"Looking for a song I don't know the name of.\",\n  \"Find me a song by lyrics.\"\n];\n\nfunction shuffle(a) {\n  for (let i = a.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [a[i], a[j]] = [a[j], a[i]];\n  }\n  return a;\n}\nshuffle(SUB_HEADERS);\n\nfunction RotatingSubHeader() {\n  const [quote, setQuote] = useState(SUB_HEADERS[0]);\n\n  useEffect(() => {\n    let dismounted = false;\n    function cycle() {\n      setTimeout(() => {\n        if (!dismounted) {\n          const nextIndex =\n            (SUB_HEADERS.indexOf(quote) + 1) % SUB_HEADERS.length;\n          setQuote(SUB_HEADERS[nextIndex]);\n          cycle();\n        }\n      }, 10000);\n    }\n    cycle();\n\n    return () => {\n      dismounted = true;\n    };\n  }, [quote]);\n\n  return <h5>{quote}</h5>;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport App from \"./App\";\nimport * as serviceWorkerRegistration from \"./serviceWorkerRegistration\";\nimport \"./static/bootstrap.css\";\nimport \"./index.css\";\nimport \"./App.css\";\nimport \"./Home.css\";\nimport \"./Common.css\";\nimport \"./CarbonAds.css\";\n\nconst container = document.getElementById(\"root\");\nconst app = (\n  <BrowserRouter>\n    <React.StrictMode>\n      <App\n        song={window.__song__}\n        related={window.__related__}\n        results={window.__results__}\n        songNotFound={window.__songNotFound__}\n        totalStats={window.__totalStats__}\n        searchExamples={window.__searchExamples__}\n        recentComments={window.__recentComments__}\n        recentCommentsHomepage={window.__recentCommentsHomepage__}\n      />\n    </React.StrictMode>\n  </BrowserRouter>\n);\n\nif (container.firstElementChild) {\n  if (window.origin !== \"https://translate.googleusercontent.com\") {\n    ReactDOM.hydrate(app, container);\n  }\n} else {\n  ReactDOM.render(app, container);\n}\nserviceWorkerRegistration.register();\n"],"sourceRoot":""}