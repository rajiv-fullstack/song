(this["webpackJsonpsongsearch-client"]=this["webpackJsonpsongsearch-client"]||[]).push([[0],{49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),r=n(26),c=n.n(r),o=n(3),i=n(5),l=n(4),u=n(6),m=n(7),h=n(9),d=n(8),j=n(10),b=n(22),p=n(30),g=n.n(p),f={},x=function(e,t){var n=f[e];if(void 0!==n)try{var s=new window.Response(new Blob([n]));return Promise.resolve(s)}catch(a){console.log("Unable to create new window.Response",a)}return fetch(e,t).then((function(t){if(200===t.status){var n=t.headers.get("Content-Type");n&&(n.match(/application\/json/i)||n.match(/text\//i))&&t.clone().text().then((function(t){f[e]=t}))}return t}))},O=(n(40),n(0));n.p,n.p;n.p,n.p;var v=n(12),S=n.n(v),y=n(16),w=n(31),C=n.n(w),N=n(20),_=n(21),k="undefined"===typeof document,E={title:"Song Search - Find Songs by Lyrics",image:k?null:document.querySelector('meta[itemprop="image"]').content},A=function(e){var t=e.title,n=e.image,s=void 0===n?null:n;if(k)console.warn("SetHTMLHeaders should not be called in server mode");else{t!==document.title&&(document.title=t);var a=document.querySelector('meta[property="og:title"]');a.content!==t&&(a.content=t);var r=document.querySelector('meta[itemprop="name"]');r!==t&&(r.content=t);var c=document.querySelector('meta[itemprop="image"]');c.content!==s&&(c.content=s)}},I=function(){A(E)},T=function(e){var t=e.text;return Object(O.jsxs)("div",{className:"loading",title:t,children:[Object(O.jsxs)("div",{className:"cssload-wrapper",children:[Object(O.jsx)("div",{className:"cssload-square"}),Object(O.jsx)("div",{className:"cssload-square"}),Object(O.jsx)("div",{className:"cssload-square"}),Object(O.jsx)("div",{className:"cssload-square"}),Object(O.jsx)("div",{className:"cssload-square"})]}),Object(O.jsx)("p",{children:t})]})};function R(e){return e.value.toLocaleString()}function L(e){var t=e.song,n=Object(s.useState)(null),a=Object(i.a)(n,2),r=a[0],c=a[1],o=Object(s.useState)(1),l=Object(i.a)(o,2),u=l[0],m=l[1],h=Object(s.useState)(!1),d=Object(i.a)(h,2),j=d[0],b=d[1];if(Object(s.useEffect)((function(){u>1&&b(!0)}),[u]),Object(s.useEffect)((function(){var e=!0,n="/api/song/".concat(t.id,"/amazon?v=5");return u>1&&(n+="&page=".concat(u)),fetch(n).then((function(t){e&&t.ok&&t.json().then((function(e){c(e),b(!1)}))})),function(){e=!1}}),[t,u]),!r||!r.items.length)return null;var p=r.items,g=r.total;return Object(O.jsxs)("div",{className:"amazon-related-products",children:[Object(O.jsx)("h4",{children:"Relevant on Amazon.com"}),p.map((function(e){return Object(O.jsx)(D,{item:e},e.asin||e.ASIN)})),Object(O.jsx)("small",{children:"As an Amazon Associate I earn from qualifying purchases."}),g>p.length&&Object(O.jsx)("p",{style:{textAlign:"right"},children:Object(O.jsx)("button",{className:"btn btn-default btn-sm",onClick:function(){m(u+1)},disabled:j,children:j?"Loading...":"Load more products..."})})]})}function D(e){var t=e.item;if(!t.detail_page_url)return function(e){var t=e.item,n=t.ItemAttributes.ProductGroup;n&&t.ItemAttributes.Binding&&n!==t.ItemAttributes.Binding&&(n+=", ".concat(t.ItemAttributes.Binding));return Object(O.jsxs)("div",{className:"media amazon-item",children:[Object(O.jsx)("div",{className:"media-left media-top",children:Object(O.jsx)("a",{href:t.URL,target:"_blank",rel:"noopener noreferrer",children:Object(O.jsx)("img",{className:"media-object",src:t.SmallImage,alt:"Product"})})}),Object(O.jsxs)("div",{className:"media-body",children:[Object(O.jsx)("h4",{className:"media-heading",children:Object(O.jsx)("a",{href:t.URL,target:"_blank",rel:"noopener noreferrer",children:t.Title})}),t.Creator&&Object(O.jsxs)("p",{children:["By ",Object(O.jsx)("b",{children:t.Creator})]}),Object(O.jsxs)("p",{children:[t.ItemAttributes.ListPrice&&Object(O.jsx)("b",{className:"price",children:t.ItemAttributes.ListPrice.FormattedPrice}),n]})]})]})}({item:t});var n=t.product_group;return n&&t.binding&&n!==t.binding&&(n+=", ".concat(t.binding)),Object(O.jsxs)("div",{className:"media amazon-item",children:[Object(O.jsx)("div",{className:"media-left media-top",children:Object(O.jsx)("a",{href:t.detail_page_url,target:"_blank",rel:"noopener noreferrer",children:Object(O.jsx)("img",{className:"media-object",loading:"lazy",src:t.image_small||t.image_medium,alt:"Product"})})}),Object(O.jsxs)("div",{className:"media-body",children:[Object(O.jsx)("h4",{className:"media-heading",children:Object(O.jsx)("a",{href:t.detail_page_url,target:"_blank",rel:"noopener noreferrer",children:t.title})}),t.contributor&&Object(O.jsxs)("p",{children:["By ",Object(O.jsx)("b",{children:t.contributor})]}),Object(O.jsxs)("p",{children:[t.price&&Object(O.jsx)("b",{className:"price",children:t.price}),n,Object(O.jsx)("br",{}),t.release_date&&Object(O.jsxs)("span",{children:["Release date: ",t.release_date]})]})]})]})}function F(e){var t=e.song,n=e.compact,s=void 0===n||n,a=Object(_.a)("/api/song/".concat(t.id,"/spotify"),function(){var e=Object(y.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=6;break}throw new Error("".concat(n.status," on ").concat(t));case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{revalidateOnFocus:!1}),r=a.data;return r?Object(O.jsxs)("div",{className:"spotify",children:[Object(O.jsx)("h4",{children:"On Spotify\u2122"}),Object(O.jsx)("div",{style:{textAlign:"center"},children:Object(O.jsx)("iframe",{src:r.embed_url,width:"300",height:s?80:380,frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"})})]}):null}var P=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={snippet:null,searched:!1,clicked:!1},e.onClickThumbnail=function(t){t.preventDefault(),e.setState({clicked:!0})},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.song.id,n="/api/song/".concat(t,"/youtube");return x(n).then((function(t){e.dismounted||(200!==t.status?console.warn(t.status,"loading",n):t.json().then((function(t){t.snippet?e.setState({snippet:t.snippet,searched:!0}):e.setState({searched:!0})})))}))}},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"render",value:function(){var e,t=this.state,n=t.clicked,s=t.snippet;if(k||null===s)return null;var a=s.videoId,r="https://www.youtube.com/watch?v=".concat(a);if(n){var c="https://www.youtube-nocookie.com/embed/".concat(a,"?rel=0"),o=335,i=178,l=document.querySelector("div.result");l&&l.offsetWidth>335&&(o=560,i=315),e=Object(O.jsx)("iframe",{width:o,height:i,title:s.title||"YouTube Snippet",src:c,frameBorder:0,allow:"autoplay; encrypted-media",allowFullScreen:!0})}else{var u=s.thumbnails.medium,m=document.querySelector("div.result");m&&m.offsetWidth>335&&(u=s.thumbnails.high),e=Object(O.jsx)("a",{href:r,onClick:this.onClickThumbnail,children:Object(O.jsx)("img",{src:u.url,width:u.width,height:u.height,title:"Click to load video",alt:"Video thumbnail",loading:"lazy"})})}return Object(O.jsxs)("div",{className:"youtube",children:[Object(O.jsxs)("h4",{children:["YouTube\u2122"," ",n?null:Object(O.jsx)("small",{onClick:this.onClickThumbnail,children:"Click to load"})]}),Object(O.jsxs)("div",{style:{textAlign:"center"},children:[e,Object(O.jsx)("p",{children:Object(O.jsx)("small",{children:Object(O.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",children:"Watch on YouTube\u2122"})})})]})]})}}]),n}(a.a.PureComponent);function H(e){var t=e.render,n=Object(s.useState)(!1),a=Object(i.a)(n,2),r=a[0],c=a[1];return r?t():Object(O.jsx)(N.a,{onEnter:function(){c(!0)}})}function M(){var e=document.getElementById("carbonadsouter");if(e&&!e.querySelector("script")){var t=document.createElement("script");t.id="_carbonads_js",t.src="https://cdn.carbonads.com/carbon.js?serve=CK7DCK7W&placement=songsearch",t.async=!0,e.appendChild(t)}}var q=a.a.memo((function(e){var t=e.text;return Object(O.jsx)("blockquote",{dangerouslySetInnerHTML:{__html:t}})}));function B(e){return Object(O.jsx)(C.a,Object(l.a)({minPeriod:60,formatter:function(e,t,n,s,a){return"second"===t?"seconds ago":a(e,t,n,s)}},e))}function U(){return Object(O.jsxs)("div",{className:"not-found",children:[Object(O.jsx)("h3",{children:"Server Error"}),Object(O.jsx)("p",{children:Object(O.jsx)("img",{alt:"Skull",src:"/static/skull.png"})}),Object(O.jsxs)("p",{children:["Most likely a ",Object(O.jsx)("b",{children:"temporary problem"})," which will go away if you"," ",Object(O.jsx)("b",{children:"reload this page soon"}),"."]}),Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:"/",children:"Back to the home page"})})]})}n(49);var Y=n(25),W="submittedComments",z=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={loadingComments:!1,savingComment:!1,serverError:null,submissionError:null,comments:e.props.comments||null,commentsCount:e.props.commentsCount||null,submittedComments:[],commentSubmitted:null,commentEdited:null,commentDeleted:null,searchedId:e.props.searchedId,replyComment:null,editComment:null,csrfToken:null,highlightComment:null,highlitComment:null,hasCommented:!1},e.loadCSRFToken=function(){fetch("/api/comments?csrftoken=1").then((function(t){if(!e.dismounted)return t.ok?t.json().then((function(t){e.setState({csrfToken:t.csrf_token})})):void e.setState({serverError:t})})).catch((function(t){e.dismounted||e.setState({serverError:t})}))},e.loadComments=function(){var t=e.props,n=t.song,s=t.search,a=e.state,r=a.submittedComments,c=a.commentEdited,o=[],i="/api/comments";n?i+="?song=".concat(n.id):s&&(i+="?search=".concat(s.id)),r.length&&(o=r.filter((function(e){return n?e.song===n.id:s?e.search===s.id:!e.song&&!e.search})).map((function(e){return e.id}))),o.forEach((function(e){i+=i.includes("?")?"&":"?",i+="submitted=".concat(e)})),c&&(i+=i.includes("?")?"&":"?",i+="edited=".concat(c.id)),(c&&o.length?fetch:x)(i).then((function(t){if(!e.dismounted){if(e.setState({loadingComments:!1}),t.ok)return t.json().then((function(t){e.setState({csrfToken:t.csrf_token,comments:t.comments,commentsCount:t.comments_count,loadingComments:!1},e.consolidateSubmittedComments)}));e.setState({serverError:t,loadingComments:!1})}})).catch((function(t){e.dismounted||e.setState({serverError:t,loadingComments:!1})}))},e.consolidateSubmittedComments=function(){var t=e.state.comments,n=e.state.submittedComments;if(n.length&&t[""]&&t[""].length){var s=[];if(function e(t){t.forEach((function(a){a.not_approved||n.forEach((function(e){e.id===a.id&&s.push(e.id)})),t[a.id]&&e(t[a.id])}))}(t[""]),s.length){var a=n.filter((function(e){return!s.includes(e.id)}));e.setState({submittedComments:a},(function(){if(e.state.submittedComments.length)try{sessionStorage.setItem(W,JSON.stringify(e.state.submittedComments))}catch(t){console.warn("'sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY)' did't work")}else try{sessionStorage.removeItem(W)}catch(t){}}))}}},e.highlightComment=function(t){var n=e.state.highlitComment;n=n&&n===t?null:t,e.setState({highlitComment:n},(function(){window.setTimeout((function(){e.dismounted||e.state.highlitComment!==t||e.setState({highlitComment:null})}),1e4)}))},e.submitCommentHandler=function(t){e.setState({savingComment:!0},(function(){e._submitCommentHandler(t).then((function(){e.setState({savingComment:!1})}))}))},e._submitCommentHandler=function(){var t=Object(y.a)(S.a.mark((function t(n){var s,a,r,c,o,i,l,u,m;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.props,r=a.song,c=a.search,o=e.state,i=o.submittedComments,l=o.csrfToken){t.next=4;break}throw new Error("No csrfToken prepared");case 4:if((u=new FormData).append("csrfmiddlewaretoken",l),u.append("text",n.comment),u.append("name",n.name),u.append("email",n.email),i.length&&i.filter((function(e){return r?e.song===r.id:c?e.search===c.id:!e.song&&!e.search})).forEach((function(e){u.append("submitted",e.id)})),!n.editComment){t.next=15;break}if(u.append("id",n.editComment.id),n.editComment.oid){t.next=14;break}throw new Error("Can't edit if you don't have the oid");case 14:u.append("oid",n.editComment.oid);case 15:return n.replyComment&&u.append("parent",n.replyComment.id),n.askedWasSearchedFor&&u.append("was_searched_for",n.wasSearchedFor||!1),e.state.searchedId&&u.append("search",e.state.searchedId||null),n.parent&&u.append("parent",n.parent||null),u.append("experiment",n.experiment||{}),r?u.append("song",r.id):c&&u.append("search",c.id),t.prev=21,t.next=24,fetch("/api/comments",{method:"POST",body:u});case 24:if(!(s=t.sent).ok){t.next=37;break}if(e.state.searchedId)try{localStorage.removeItem("searched")}catch(h){console.warn("'localStorage.removeItem(\"searched\")' didn't work")}return t.next=29,s.json();case 29:if(m=t.sent,!n.editComment){t.next=34;break}return t.abrupt("return",e.setState({searchedId:null,commentEdited:m.submitted,submissionError:null,commentSubmitted:null,editComment:null,replyComment:null,comments:m.comments,commentsCount:m.comments_count}));case 34:return t.abrupt("return",e.setState({searchedId:null,submissionError:null,commentEdited:null,commentSubmitted:m.submitted,commentDeleted:null,replyComment:null,comments:m.comments,commentsCount:m.comments_count},(function(){1===document.querySelectorAll(".alert-comment").length&&document.querySelector(".alert-comment.alert-success").scrollIntoView({behavior:"smooth"});var t=e.state.commentSubmitted,n=e.props,s=n.song,a=n.search;e.highlightComment(t.id);var r=e.state.submittedComments.slice(0);if(!r.map((function(e){return e.id})).filter((function(e){return e===t.id})).length){var c={id:t.id,oid:t.oid};s?c.song=s.id:a&&(c.search=a.id),r.push(c)}e.setState({submittedComments:r,submissionError:null},(function(){e.loadComments();try{sessionStorage.setItem(W,JSON.stringify(e.state.submittedComments))}catch(h){}}))})));case 35:t.next=38;break;case 37:return t.abrupt("return",e.setState({submissionError:s}));case 38:t.next=44;break;case 40:return t.prev=40,t.t0=t.catch(21),console.warn("Submission failed:",t.t0),t.abrupt("return",e.setState({submissionError:t.t0}));case 44:case"end":return t.stop()}}),t,null,[[21,40]])})));return function(e){return t.apply(this,arguments)}}(),e.deleteCommentHandler=function(t){e.setState({savingComment:!0},(function(){e._deleteCommentHandler(t).then((function(){e.setState({savingComment:!1})}))}))},e._deleteCommentHandler=function(){var t=Object(y.a)(S.a.mark((function t(n){var s,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=new FormData,n.oid){t.next=3;break}throw new Error("Can't edit if you don't have the oid");case 3:return a.append("id",n.id),a.append("oid",n.oid),"/api/comments/delete",t.prev=6,t.next=9,fetch("/api/comments/delete",{method:"POST",body:a});case 9:s=t.sent,t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(6),t.abrupt("return",e.setState({submissionError:t.t0}));case 15:if(s.ok){t.next=17;break}return t.abrupt("return",e.setState({submissionError:s}));case 17:return t.abrupt("return",e.setState({commentDeleted:n,commentEdited:null,editComment:null,submissionError:null},(function(){var t=e.state.submittedComments.filter((function(e){return e.id!==n.id}));e.setState({submittedComments:t},(function(){e.loadComments();try{sessionStorage.setItem(W,JSON.stringify(e.state.submittedComments))}catch(t){}}))})));case 18:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e){return t.apply(this,arguments)}}(),e.setEditComment=function(t){e.setState({editComment:t})},e.setReplyComment=function(t){e.state.replyComment&&e.state.replyComment.id===t.id?e.setState({replyComment:null,highlitComment:null,commentEdited:null}):e.setState({replyComment:t,highlitComment:t.id,commentEdited:null})},e.clearCommentSubmitted=function(){e.setState({commentSubmitted:null})},e.clearCommentEdited=function(){e.setState({commentEdited:null})},e.clearCommentDeleted=function(){e.setState({commentDeleted:null})},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this,t="[]";try{t=sessionStorage.getItem(W)||"[]"}catch(o){console.warn("'sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY)' didn't work")}var n=JSON.parse(t);if(n.length){var s=!1,a=this.props.song;a&&(s=n.some((function(e){return e.song&&e.song===a.id}))),this.setState({submittedComments:n,hasCommented:s,loadingComments:!this.state.comments},this.loadComments)}else this.state.comments?this.loadCSRFToken():this.setState({loadingComments:!0},this.loadComments);if(window.location.hash){var r=/c(\d+)$/;if(window.location.hash.match(r)){var c=parseInt(window.location.hash.match(r)[1],10);this.setState({highlitComment:c},(function(){window.setTimeout((function(){if(!e.dismounted){var t=document.querySelector("#c".concat(e.state.highlitComment));t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth"})}}),1e3),window.setTimeout((function(){e.dismounted||e.state.highlitComment!==c||e.setState({highlitComment:null})}),1e4)}))}}}},{key:"componentDidUpdate",value:function(e){e.song!==this.props.song&&this.setState({loadingComments:!0,comments:null,commentsCount:null},this.loadComments)}},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"render",value:function(){var e=this.props.song,t=this.state,n=t.comments,s=t.commentsCount,a=t.submissionError,r=t.commentSubmitted,c=t.commentEdited,o=t.commentDeleted,i=t.submittedComments,u=t.searchedId,m=t.editComment,h=t.replyComment,d=t.savingComment,j=t.highlitComment,b=t.hasCommented,p=t.csrfToken;return Object(O.jsxs)("div",{className:"comments masters song-comments",children:[Object(O.jsx)(Y.a,{children:Object(O.jsx)("script",{type:"text/javascript",language:"javascript",src:"https://live.primis.tech/live/liveView.php?s=113482"})}),Object(O.jsxs)("h3",{children:["Song Comments ",s?Object(O.jsxs)("span",{children:["(",s,")"]}):null,Object(O.jsx)("br",{}),Object(O.jsxs)("small",{children:["On ",Object(O.jsx)("b",{children:e.name})," ",Object(O.jsx)("span",{className:"by",children:"by"})," ",e.artist.name]})]}),Object(O.jsx)(V,{commentDeleted:o,clearCommentDeleted:this.clearCommentDeleted}),Object(O.jsx)(Q,Object(l.a)(Object(l.a)({},this.props),{},{submissionError:a,comments:n,editComment:m,replyComment:h,searchedId:u,setEditComment:this.setEditComment,setReplyComment:this.setReplyComment,submitCommentHandler:this.submitCommentHandler,deleteCommentHandler:this.deleteCommentHandler,commentSubmitted:r,commentEdited:c,submittedComments:i,savingComment:d,highlitComment:j,highlightComment:this.highlightComment,clearCommentSubmitted:this.clearCommentSubmitted,clearCommentEdited:this.clearCommentEdited,csrfToken:p,hasCommented:b}))]})}}]),n}(a.a.PureComponent);function K(e){var t=e.commentSubmitted,n=e.clearCommentSubmitted;return t?Object(O.jsxs)("div",{className:"alert-comment alert-comment alert alert-success alert-dismissible",role:"alert",children:[Object(O.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(e){n()},children:Object(O.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:"Comment submitted. Thank you!"})}),Object(O.jsx)("p",{children:"It needs to be moderated before publishing."})]}):null}function G(e){var t=e.commentEdited,n=e.clearCommentEdited;return t?Object(O.jsxs)("div",{className:"alert-comment alert alert-success alert-dismissible",role:"alert",children:[Object(O.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(e){n()},children:Object(O.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:"Comment edited."})}),Object(O.jsx)("p",{children:"You can keep editing it until it gets approved."})]}):null}function V(e){var t=e.commentDeleted,n=e.clearCommentDeleted;return t?Object(O.jsxs)("div",{className:"alert-comment alert alert-success alert-dismissible",role:"alert",children:[Object(O.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(e){n()},children:Object(O.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:"Comment removed."})}),Object(O.jsx)("p",{children:"Feel free to write a new comment."})]}):null}function J(e){var t,n=e.submissionError,a=Object(s.useState)({}),r=Object(i.a)(a,2),c=r[0],o=r[1],l=!1;if(!k)try{l=n instanceof window.Response}catch(u){console.log("instanceof window.Response did not work:",u)}return Object(s.useEffect)((function(){!k&&l&&400===n.status&&n.json().then((function(e){o(e.errors)}))}),[n,l]),n?(t=!k&&l?400===n.status?Object(O.jsxs)("div",{children:[Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:"Something's not right with the submission"})}),Object.keys(c).map((function(e){return Object(O.jsxs)("p",{children:[Object(O.jsxs)("b",{children:[e,":"]})," ",c[e].map((function(e){return Object(O.jsxs)("span",{children:[Object(O.jsx)("i",{children:e.message})," ",e.code?Object(O.jsxs)("span",{children:["(",Object(O.jsx)("code",{children:e.code}),")"]}):null]},e.message+e.code)}))]},e)}))]}):n.status>=500?Object(O.jsx)("p",{children:"Server error. Perhaps simply try again a little later."}):Object(O.jsx)("p",{children:"The server basically failed to process the submission."}):Object(O.jsx)("p",{children:Object(O.jsx)("code",{children:n.toString()})}),Object(O.jsxs)("div",{className:"search-error",children:[Object(O.jsx)("h4",{children:"Sorry, an error occured"}),t]})):null}var Q=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this.props,t=e.comments,n=e.replyComment,s=e.editComment;return Object(O.jsxs)(O.Fragment,{children:[t&&t[""]&&Object(O.jsx)($,Object(l.a)(Object(l.a)({},this.props),{},{allComments:t,comments:t[""]})),!n&&!s&&Object(O.jsx)(X,Object(l.a)({replyingComment:!1},this.props))]})}}]),n}(a.a.PureComponent),$=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={confirmDelete:!1},e}return Object(m.a)(n,[{key:"render",value:function(){var e=this,t=this.state.confirmDelete,s=this.props,a=s.replyComment,r=s.editComment,c=s.setEditComment,o=s.setReplyComment,i=s.comments,u=s.allComments,m=s.submittedComments,h=s.deleteCommentHandler,d=s.highlightComment,j=s.highlitComment,b=s.commentSubmitted,p=s.clearCommentSubmitted,g=s.commentEdited,f=s.clearCommentEdited,x=s.csrfToken;return i.length?Object(O.jsx)("div",{className:"comments",children:i.map((function(s){var i=!1;s.not_approved&&m.filter((function(e){return e.id===s.id})).length&&(i=!0);var v=!i&&x,S=u[s.id],y=!(!i||!r||r.id!==s.id),w=!(!v||!a||a.id!==s.id);return Object(O.jsxs)("div",{className:"comment",id:"c".concat(s.id),children:[b&&b.id===s.id&&Object(O.jsx)(K,{commentSubmitted:b,clearCommentSubmitted:p}),g&&g.id===s.id&&Object(O.jsx)(G,{commentEdited:g,clearCommentEdited:f}),i&&!(r&&r.id===s.id)&&Object(O.jsx)("p",{className:"buttons",children:Object(O.jsx)("button",{type:"button",className:"btn btn-info btn-sm",onClick:function(e){e.preventDefault(),c(s)},children:"Edit your comment"})}),t&&r&&r.id===s.id&&Object(O.jsxs)("p",{style:{margin:20,textAlign:"center"},children:[Object(O.jsx)("b",{children:"Are you sure?"}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{type:"button",className:"btn btn-danger",onClick:function(e){e.preventDefault(),h(s)},children:"Yes"})," ",Object(O.jsx)("button",{type:"button",className:"btn btn-info",onClick:function(t){t.preventDefault(),e.setState({confirmDelete:!1})},children:"No"})]}),i&&r&&r.id===s.id&&Object(O.jsxs)("p",{className:"buttons",children:[!t&&Object(O.jsx)("button",{type:"button",className:"btn btn-warning btn-sm",onClick:function(t){t.preventDefault(),e.setState({confirmDelete:!0})},children:"Remove your comment"})," ",Object(O.jsx)("button",{type:"button",className:"btn btn-info btn-sm",onClick:function(n){n.preventDefault(),t?e.setState({confirmDelete:!1},(function(){c(null)})):c(null)},children:"Close edit"})]}),r&&r.id===s.id?Object(O.jsx)(X,Object(l.a)({focusOnMount:!0,editingComment:y,replyingComment:!1},e.props)):Object(O.jsx)(ee,{highlightComment:d,canReply:v,replyingComment:w,setReplyComment:o,comment:s,highlit:j&&j===s.id}),a&&s.id===a.id&&Object(O.jsx)(X,Object(l.a)(Object(l.a)({},e.props),{},{replyingComment:w,focusOnMount:!0})),S&&Object(O.jsx)(n,Object(l.a)(Object(l.a)({},e.props),{},{comments:S}))]},s.id)}))}):null}}]),n}(a.a.PureComponent),X=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),c=0;c<s;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={comment:e.props.editComment?e.props.editComment.text:"",name:"",email:"",showNameEmailInputs:!0,wasSearchedFor:!1,canSubmit:!1,warnAboutName:!1},e.textareaRef=a.a.createRef(),e.clearComment=function(){e.setState({comment:"",preview:!1})},e.submitHandler=function(t){t.preventDefault();var n=e.state,s=n.comment,a=n.name,r=n.email,c=n.warnAboutName,o=n.wasSearchedFor,i=e.props,l=i.submitCommentHandler,u=i.editComment,m=i.replyComment;if(s.trim()){try{a&&a.trim()&&localStorage.setItem("commentName",a.trim()),r&&r.trim()&&localStorage.setItem("commentEmail",r.trim())}catch(h){console.warn("'localStorage.stItem(\"commentName\")' didn't work")}a&&r||c?(c&&e.setState({warnAboutName:!1}),l({comment:s,email:r,name:a,wasSearchedFor:o,editComment:u,replyComment:m,askedWasSearchedFor:e.askWasSearchedFor()})):e.setState({warnAboutName:!0})}},e.getTextareaRows=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,s=(e.match(/\n/g)||[]).length;return Math.min(n,Math.max(t,s+2))},e.askWasSearchedFor=function(){var t=e.props,n=t.searchedId,s=t.replyingComment,a=t.hasCommented,r=t.editingComment;return!(!n||s||r||a)},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e={},t=this.state,n=t.canSubmit,s=t.name,a=t.email,r=t.showNameEmailInputs;try{s=localStorage.getItem("commentName")||"",a=localStorage.getItem("commentEmail")||""}catch(c){console.warn("'localStorage.getItem(\"commentName\")' didn't work")}(s||a)&&(e.name=s,e.email=a),n||!s&&!a||(e.canSubmit=!0),s&&a&&r&&!this.props.editComment&&(e.showNameEmailInputs=!1),Object.keys(e).length&&this.setState(e),this.props.focusOnMount&&this.textareaRef.current.focus()}},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"componentDidUpdate",value:function(e){e.commentSubmitted!==this.props.commentSubmitted&&this.setState({comment:""})}},{key:"render",value:function(){var e=this,t=this.state,n=t.comment,s=t.name,a=t.email,r=t.warnAboutName,c=t.showNameEmailInputs,o=this.props,i=o.editComment,l=o.savingComment,u=o.submissionError,m=o.editingComment;return o.csrfToken?Object(O.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(O.jsx)(J,{submissionError:u}),m&&Object(O.jsxs)("i",{children:["You can edit ",Object(O.jsx)("b",{children:"your"})," recently added, but not yet approved comments."]}),l&&Object(O.jsx)(Z,{}),this.askWasSearchedFor()&&Object(O.jsxs)("div",{style:{textAlign:"center",marginBottom:20},children:[Object(O.jsx)("h4",{children:"Was this the song you were looking for?"}),Object(O.jsxs)("label",{className:"radio-inline",children:[Object(O.jsx)("input",{type:"radio",name:"wasSearchedFor",value:"yes",disabled:l,onChange:function(t){e.setState({wasSearchedFor:!0},(function(){e.textareaRef.current&&e.textareaRef.current.focus()}))}})," ","Yes!"]}),Object(O.jsxs)("label",{className:"radio-inline",children:[Object(O.jsx)("input",{type:"radio",name:"wasSearchedFor",id:"inlineRadio2",value:"no",disabled:l,onChange:function(t){e.setState({wasSearchedFor:!1},(function(){e.textareaRef.current&&e.textareaRef.current.focus()}))}})," ","No :("]})]}),Object(O.jsx)("div",{className:"form-group",children:Object(O.jsx)("textarea",{className:"form-control",rows:this.getTextareaRows(this.state.comment),ref:this.textareaRef,value:n,disabled:l,onChange:function(t){return e.setState({comment:t.target.value})},onBlur:function(t){e.state.comment.trim()&&setTimeout((function(){e.dismounted||e.state.canSubmit||e.setState({canSubmit:!0})}),100)}})}),c&&Object(O.jsxs)("div",{className:"form-inlinexxx",children:[Object(O.jsxs)("div",{className:"form-group",children:[Object(O.jsx)("label",{htmlFor:"_name",className:"sr-only",children:"Your name"}),Object(O.jsx)("input",{type:"text",className:"form-control",id:"_name",placeholder:"Your name...",disabled:l,value:s,onChange:function(t){return e.setState({name:t.target.value})}})]}),Object(O.jsxs)("div",{className:"form-group",style:{marginBottom:3},children:[Object(O.jsx)("label",{htmlFor:"_email",className:"sr-only",children:"Email address"}),Object(O.jsx)("input",{type:"email",className:"form-control",id:"_email",placeholder:"Your email address...",disabled:l,value:a,onChange:function(t){return e.setState({email:t.target.value})}})]}),Object(O.jsx)("p",{children:Object(O.jsxs)("small",{children:["Your email will ",Object(O.jsx)("b",{children:"never be published"})," and"," ",Object(O.jsx)("b",{children:"never be shared"}),". Useful to receive reply comments."]})})]}),r&&Object(O.jsxs)("div",{className:"alert-comment alert alert-warning alert-dismissible",role:"alert",children:[Object(O.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(t){e.setState({warnAboutName:!1})},children:Object(O.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),Object(O.jsx)("p",{children:s?Object(O.jsx)("b",{children:"Please enter your email"}):Object(O.jsx)("b",{children:"Please enter your name"})}),Object(O.jsxs)("p",{children:["A real name and email helps the comment be approved.",Object(O.jsx)("br",{}),"An email address makes it possible to receive notification on replies to your comment."]})]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("div",{className:"col-md-8",children:s&&a&&!c&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("p",{children:["Commenting as ",Object(O.jsx)("b",{children:s}),". Replies sent to ",Object(O.jsx)("b",{children:a}),"."]}),Object(O.jsx)("p",{children:Object(O.jsx)("button",{type:"button",className:"btn btn-info btn-sm",onClick:function(t){t.preventDefault(),e.setState({showNameEmailInputs:!0})},children:"Change name"})})]})}),Object(O.jsx)("div",{className:"col-md-4",style:{textAlign:"right"},children:Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:!n.trim()||l,children:i?"Save Changes":"Post Comment"})})]}),!this.state.wasSearchedFor&&Object(O.jsx)("p",{style:{margin:"20px 0"},children:Object(O.jsxs)("small",{children:["Can't find the song you're looking for?"," ",Object(O.jsxs)("a",{href:"https://www.peterbe.com/plog/blogitem-040601-1",children:["Try posting on ",Object(O.jsx)("b",{children:"Find song by lyrics"})]}),"."]})})]}):k?Object(O.jsx)("i",{children:"Must have JavaScript enabled to comment."}):null}}]),n}(a.a.PureComponent);function Z(){return Object(O.jsx)("p",{children:Object(O.jsx)("i",{children:"Please wait...."})})}var ee=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this.props,t=e.highlit,n=e.highlightComment,s=e.canReply,a=e.replyingComment,r=e.setReplyComment,c=e.comment,o=c.id,i=c.name,l=c.created,u=c.not_approved,m=c.text_rendered;return Object(O.jsxs)("div",{className:t?"display highlit":"display",children:[s&&Object(O.jsx)("p",{className:"buttons",children:Object(O.jsx)("button",{type:"button",className:a?"btn btn-warning btn-sm":"btn btn-info btn-sm",onClick:function(e){e.preventDefault(),r(c)},children:a?"Close":"Reply"})}),Object(O.jsxs)("h5",{children:["By ",Object(O.jsx)("b",{children:i||Object(O.jsx)("i",{children:"Anonymous"})})]}),Object(O.jsxs)("p",{className:"meta",children:[Object(O.jsxs)("a",{href:"#c".concat(o),title:l,onClick:function(e){n(o)},children:["Posted ",Object(O.jsx)(B,{date:l,title:l})]}),u&&Object(O.jsx)("small",{children:"Not yet approved!"})]}),c.hasOwnProperty("was_searched_for")&&Object(O.jsxs)("p",{children:[Object(O.jsx)("i",{children:"Was it the song you were looking for?"})," ",Object(O.jsx)("b",{children:c.was_searched_for?"Yes":"No"})," ",c.was_searched_for&&function(){var e=["\ud83c\udf89","\ud83c\udf8a","\ud83e\udd73","\u2728","\ud83d\udc4d\ud83c\udffc","\ud83e\udd70","\ud83d\ude0d","\ud83c\udf7e"],t=e[Math.floor(Math.random()*e.length)];return Object(O.jsx)("span",{role:"img","aria-label":"muted",children:t})}()]}),"string"===typeof m?Object(O.jsx)("blockquote",{dangerouslySetInnerHTML:{__html:m}}):Object(O.jsx)("blockquote",{children:m})]})}}]),n}(a.a.PureComponent);n(50);var te=function(e){var t=e.recentComments,n=Object(j.g)().page,a=Object(s.useRef)(!1),r=Object(s.useState)(null),c=Object(i.a)(r,2),l=c[0],u=c[1],m=Object(s.useState)(t||null),h=Object(i.a)(m,2),d=h[0],b=h[1];function p(e){return parseInt(e||"1",10)}var g=Object(s.useCallback)((function(){var e="/api/comments/recent",t=p(n);return t>1&&(e+="?page=".concat(t)),x(e).then((function(e){if(!e.ok)return a.current&&u(e);e.json().then((function(e){return a.current&&b(e)}))})).catch((function(e){return a.current&&u(e)}))}),[n]);Object(s.useEffect)((function(){var e=p(n),t=" - Song Search";return A({title:e>1?"Recent Comments (page ".concat(e,")").concat(t):"Recent Comments".concat(t)}),b(null),a.current=!0,g(n),function(){a.current=!1}}),[n,g]);var f=!d&&!l,v=Object(s.useState)(!1),S=Object(i.a)(v,2),y=S[0],w=S[1];Object(s.useEffect)((function(){f?window.setTimeout((function(){a.current&&w(!0)}),1e3):w(!1)}),[f]);var C=p(n),N=null;return d&&(d.next_page||C>1)&&(N=Object(O.jsx)(se,{next:d.next_page,previous:C-1})),Object(O.jsxs)("div",{className:"recent-comments",children:[!l&&Object(O.jsxs)("h2",{children:["Recent Comments ",1!==C&&Object(O.jsxs)("small",{children:["Page ",C]})]}),Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:"/",children:"Back to the home page"})}),f&&y&&Object(O.jsx)(T,{text:"Loading..."}),l&&!d&&Object(O.jsx)(U,{}),N,d&&Object(O.jsx)(ne,{comments:d.comments,isRoot:!0}),N]})};function ne(e){var t=e.comments,n=e.isRoot,s=null,a=null;return Object(O.jsx)("div",{className:"comments",children:t.map((function(e){var t=null;n&&(e.image&&s!==e.song.id&&(t=Object(O.jsx)(o.b,{to:e._url,children:Object(O.jsx)("img",{className:"pull-right img-thumbnail found",loading:"lazy",src:e.image.thumbnail100||e.image.url,alt:e.song.artist.name})})),s=e.song.id);var r=null;e.geo&&(e.geo.city&&e.geo.country?r=" (from ".concat(e.geo.city,", ").concat(e.geo.country,") "):e.geo.country&&(r=" (from ".concat(e.geo.country,") ")));var c=null;return e.rating&&(a&&(c=e.rating.chronological-a-1),a=e.rating.chronological),Object(O.jsxs)("div",{className:"comment",children:[t,n&&Object(O.jsxs)("h4",{children:["On"," ",Object(O.jsxs)(o.b,{to:e._url,children:[Object(O.jsx)("b",{children:e.song.name})," ",Object(O.jsx)("span",{className:"by",children:"by"})," ",e.song.artist.name]})]}),Object(O.jsx)("blockquote",{dangerouslySetInnerHTML:{__html:e.text_rendered}}),n&&Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:e._url,className:"btn btn-info btn-sm",children:"Reply"})}),Object(O.jsxs)("p",{children:["By ",e.name?Object(O.jsx)("b",{children:e.name}):Object(O.jsx)("i",{children:"Anonymous"}),r,"on ",e.approved_human," ",e.rating&&Object(O.jsxs)("span",{children:["rating:",Object(O.jsx)("code",{children:e.rating.score}),"chronological: ",Object(O.jsx)("code",{children:e.rating.chronological}),!!c&&Object(O.jsx)("i",{children:c>0?" +".concat(c):c})]})]}),e.replies&&e.replies.length?Object(O.jsx)(ne,{comments:e.replies,isRoot:!1}):null]},e.id)}))})}function se(e){var t=e.previous,n=e.next;return Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("div",{className:"col-md-6",style:{textAlign:"right"},children:t?Object(O.jsx)("div",{className:"load-more",children:Object(O.jsx)(o.b,{to:1===t?"/comments":"/comments/p".concat(t),children:"Previous page"})}):null}),Object(O.jsx)("div",{className:"col-md-6",style:{textAlign:"left"},children:n&&Object(O.jsx)("div",{className:"load-more",children:Object(O.jsx)(o.b,{to:"/comments/p".concat(n),children:"Next page"})})})]})}var ae="/static/lazyload-thumbnail.png",re="/static/placeholder.png",ce="true"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_NO_ADS,oe=["Born to be wild","No one ever told me life was kind","But here it comes again, straight thru the heart","I'm an alligator","My mouth, it moves"];oe.sort((function(){return.5-Math.random()}));(new Date).getTime();var ie=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;Object(u.a)(this,n),(s=t.call(this,e)).artistRef=a.a.createRef(),s.languageRef=a.a.createRef(),s.searchRef=a.a.createRef(),s.startSearchFromLocation=function(e){var t=e.match,n=decodeURIComponent(t.params.q),a=new URLSearchParams(e.location.search||""),r=a.get("artist"),c=a.get("language"),o=a.get("year"),i=a.get("example");if(s.state.q!==n){var l={q:n};n.length>s.searchRef.current.maxLength-10&&(l.searchMaxLength=[n.length,s.searchRef.current.maxLength]),(c||o)&&(s.loadSearchAggregates(),l.advancedSearch=!0),c&&(l.searchLanguage=c),o&&(l.searchYear=o),r&&(l.artistName=r,l.advancedSearch=!0),i&&(l.searchExample=i),s.setState(l,(function(){s.startSearch(n,c,o,r,s.state.resultsPageIndex,s.state.searchExample)}))}else A({title:"".concat(n," - Song Search")})},s.onFocusSearch=function(){s.searchRef.current.placeholder="",clearInterval(s.placeholderSampleInterval),s.fillerInterval&&clearInterval(s.fillerInterval),s.state.showAutocompleteSuggestions||s.setState({showAutocompleteSuggestions:!0}),s.state.shareSearch&&s.setState({shareSearch:!1}),s._firstFocusSearch||(s._firstFocusSearch=!0,window.innerHeight&&window.innerHeight<600&&s.searchRef.current.scrollIntoView())},s.onBlurSearch=function(e){s.state.q||(s.setNextSamplePlaceholder(),s.startSamplePlaceholderInterval()),setTimeout((function(){s.dismounted||s.setState({showAutocompleteSuggestions:!1})}),300)},s.onFocusArtist=function(e){s.state.showAutocompleteArtistSuggestions||s.setState({showAutocompleteArtistSuggestions:!0})},s.onBlurArtist=function(e){setTimeout((function(){s.dismounted||s.setState({showAutocompleteArtistSuggestions:!1})}),300)},s.sampleSearch=function(e,t){e.preventDefault();var n={q:t.term,searchExample:t.id};(t.language||t.year)&&(s.state.searchLanguages.length&&s.state.searchYears.length||s.loadSearchAggregates()),t.language?(n.searchLanguage=t.language,n.advancedSearch=!0):s.state.searchLanguage&&(n.searchLanguage=""),t.year?(n.searchYear=t.year,n.advancedSearch=!0):s.state.searchYear&&(n.searchYear=""),t.artist?(n.artistName=t.artist,n.advancedSearch=!0):s.state.artistName&&(n.artistName=""),s.setState(n,(function(){s.submitSearch()}))},s.onSubmit=function(e){e.preventDefault(),s.submitSearch()},s._fetchSearchAlternatives=function(){var e="/api/search/alternatives?searched=".concat(s.state.parentSearch);return x(e).then((function(e){if(200===e.status)return e.json().then((function(e){s.dismounted||e&&s.setState({keyPhrases:e.key_phrases})}))}))},s.onChangeSearch=function(e){var t=e.target.value;s.setState({q:t},(function(){s.state.desperateSearch&&s.setState({desperateSearch:!1}),s.state.originalQ&&s.setState({originalQ:""});var e=t.length;if(e>s.searchRef.current.maxLength-10?s.setState({searchMaxLength:[e,s.searchRef.current.maxLength],showAutocompleteSuggestions:!1}):s.state.searchMaxLength&&s.setState({searchMaxLength:null,showAutocompleteSuggestions:!0}),s.state.q.trim()){if(s.autocompleteWaitingFor&&t.trim()===s.autocompleteWaitingFor)return;(e<4||t.endsWith(" "))&&e<24?s.fetchAutocompleteSuggestionsThrottled(t,s.state.searchLanguage):e>24?s.fetchAutocompleteSuggestionsDebouncedLong(t,s.state.searchLanguage):e?s.fetchAutocompleteSuggestionsDebounced(t,s.state.searchLanguage):s.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:!0})}else s.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:!0})}))},s.onKeyDownSearch=function(e){var t=s.state.autocompleteSuggestions;if(t){var n=s.state.autocompleteHighlight;if("Tab"===e.key){e.preventDefault();var a=n>-1?t[n]:t[0];a._url||(s.setState({q:a.text+" "}),s.fetchAutocompleteSuggestions(a.text,s.state.searchLanguage))}else if("ArrowDown"===e.key&&n<t.length)e.preventDefault(),s.setState({autocompleteHighlight:n+1});else if("ArrowUp"===e.key&&n>-1)s.setState({autocompleteHighlight:n-1});else if("Enter"===e.key&&n>-1){e.preventDefault();var r=s.state.autocompleteSearchSuggestions;if(0===n&&r&&r.total)return void s.submitSearch();if(!t[--n])return console.warn("SUGGESTIONS",t),console.warn("HIGHLIGHT",n),void s.setState({autocompleteSuggestions:null,autocompleteHighlight:-1},(function(){return s.submitSearch()}));t[n]._url?s.setState({redirectTo:{pathname:t[n]._url}}):s.setState({q:t[n].text,autocompleteSuggestions:null,autocompleteHighlight:-1},(function(){return s.submitSearch()}))}}},s.onKeyDownArtistSearch=function(e){var t=s.state.autocompleteArtistSuggestions;if(t){var n=s.state.autocompleteArtistHighlight;"Tab"===e.key?(e.preventDefault(),n>-1?(s.setState({artistName:t[n].text}),s.fetchAutocompleteArtistSuggestions(t[n].text)):t.length&&(s.setState({artistName:t[0].text}),s.fetchAutocompleteArtistSuggestions(t[0].text))):"ArrowDown"===e.key&&n<t.length?(e.preventDefault(),s.setState({autocompleteArtistHighlight:n+1})):"ArrowUp"===e.key&&n>-1?s.setState({autocompleteArtistHighlight:n-1}):"Enter"===e.key&&n>-1&&(e.preventDefault(),s.setState({artistName:t[n].text,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1}))}},s.toggleShareSearch=function(e){e.preventDefault(),s.setState({shareSearch:!s.state.shareSearch,advancedSearch:!1})},s.toggleAdvancedSearch=function(e){if(e.preventDefault(),!s.state.advancedSearch){var t=s.state.searchLanguages.filter((function(e){return e.count})),n=s.state.searchYears.filter((function(e){return e.count}));t.length&&n.length||s.loadSearchAggregates()}s.setState({advancedSearch:!s.state.advancedSearch,shareSearch:!1})},s.onChangeLanguage=function(e){e.preventDefault();var t=e.target.value;s.setState({searchLanguage:t})},s.onChangeYear=function(e){e.preventDefault();var t=e.target.value;s.setState({searchYear:t})},s.onChangeArtistName=function(e){e.preventDefault();var t=e.target.value;s.setState({artistName:t},(function(){t.length?s.fetchAutocompleteArtistSuggestions(s.state.artistName.trim()):s.setState({autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1})}))},s.onSelectSuggestion=function(e,t){if(e.preventDefault(),t._url)return s.setState({redirectTo:t._url});var n=t.text;t.append&&(n=function(e,t){var n=e.split(/\s+/);return n.pop(),n.push(t),n.join(" ")}(s.state.q,n)),s.setState({q:n,autocompleteSuggestions:null,autocompleteHighlight:-1},(function(){s.submitSearch()}))},s.onSelectSuggestionAll=function(e){e.preventDefault(),s.submitSearch()},s.onSelectArtistSuggestion=function(e,t){e.preventDefault(),s.setState({artistName:t.text,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1},(function(){s.submitSearch()}))},s.onLoadMore=function(e){e.preventDefault(),s.setState({resultsPageIndex:s.state.resultsPageIndex+1},(function(){s.startSearch(s.state.q,s.state.searchLanguage,s.state.searchYear,s.state.artistName,s.state.resultsPageIndex,s.state.searchExample)}))},s.submitPhrase=function(e,t){e.preventDefault();var n={q:t.phrase,originalQ:s.state.q};t.year&&(n.searchYear=t.year),t.language&&(n.searchLanguage=t.language),s.setState(n,(function(){s.submitSearch()}))},s.reloadSearch=function(e){e.preventDefault(),window.location.reload()},s.loadMoreByName=function(e){var t=s.state.by_name_limit;s.setState({by_name_total:0,by_name_limit:0},(function(){var e="/api/search?q=".concat(encodeURIComponent(s.state.q),"&by_name=").concat(t);fetch(e).then((function(e){s.dismounted||200===e.status&&e.json().then((function(e){e&&s.setState({by_name:e.by_name,by_name_total:e.by_name_total,by_name_limit:e.by_name_limit})}))}))}))},s.displayYears=function(e){var t=e+9,n=(new Date).getFullYear();return t>n&&(t=n),"".concat(e,"\u2026").concat(t)};var r="",c="",o="",i=0,l=null,m=!1,h=null,d=null,j=null,p=null,g="",f="",O=null,v=null,S=null,y=null,w=s.props.results;w&&(s.searched=w.searched,r=w.search,i=w.total,l=w.results,m=w.desperate,h=w.missing,d=w.by_name||null,j=w.by_name_total||null,p=w.by_name_limit||null,o=w.artist,c=w.original||"",g=w.language||"",f=w.year||"",O=w.searched||null,v=w.key_phrases||null,S=w.popularityFactor||null,y=w.search_example||null);var C=Boolean(o||g||f),N=null,_=!1;e.searchExamples&&e.searchExamples.examples&&(N=e.searchExamples.examples,_=!0);var k=null,E=!1;return e.recentComments&&e.recentComments.comments&&e.recentComments.comments.length&&(k=e.recentComments,E=!0),s.state={q:r,originalQ:c,artistName:o,searching:!1,searchError:null,total:i,results:l,resultsPageIndex:0,by_name:d,by_name_total:j,by_name_limit:p,placeholder:oe[0],slowSearch:null,showExamples:_,searchExamples:N,parentSearch:O,desperateSearch:m,missing:h,keyPhrases:v,popularityFactor:S,searchExample:y,showRecentComments:E,recentComments:k,onlyResults:null,searchMaxLength:null,autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:!0,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1,showAutocompleteArtistSuggestions:!0,advancedSearch:C,searchLanguage:g,searchLanguages:[],searchYear:f,searchYears:[],redirectTo:null,shareSearch:!1},s.fetchAutocompleteSuggestionsDebounced=Object(b.a)(800,s.fetchAutocompleteSuggestions),s.fetchAutocompleteSuggestionsDebouncedLong=Object(b.a)(1800,s.fetchAutocompleteSuggestions),s.fetchAutocompleteSuggestionsThrottled=Object(b.b)(1100,s.fetchAutocompleteSuggestions),s._autocompleteSuggestionsCache={},s}return Object(m.a)(n,[{key:"componentDidMount",value:function(){I(),this.props.match.params.q?this.startSearchFromLocation(this.props):(this.startSamplePlaceholderInterval(),this.state.searchExamples||this.fetchSearchExamples(),this.state.recentComments||this.fetchRecentComments()),this.state.results&&(this.state.desperateSearch||!this.state.total)&&this.state.q.length>10&&this._fetchSearchAlternatives()}},{key:"componentDidUpdate",value:function(e){this.props.match.params.q!==e.match.params.q&&(this.props.match.params.q?decodeURIComponent(this.props.match.params.q)!==this.state.q&&this.startSearchFromLocation(this.props):(I(),this.setState({q:"",originalQ:"",artistName:"",searching:!1,total:null,results:null,resultsPageIndex:0,slowSearch:null,showExamples:!1,searchExamples:null,showRecentComments:!1,parentSearch:null,desperateSearch:!1,searchExample:null,missing:null,searchError:null,by_name:null,by_name_total:null,by_name_limit:null,autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1,redirectTo:null,shareSearch:!1}),this.fetchSearchExamples()))}},{key:"componentWillUnmount",value:function(){this.dismounted=!0,this.stopSamplePlaceholderInterval(),this.fillerInterval&&window.clearInterval(this.fillerInterval),this.slowSearchTimer&&window.clearTimeout(this.slowSearchTimer)}},{key:"fetchSearchExamples",value:function(){var e=this;return fetch("/api/search/examples").then((function(t){if(200===t.status)return t.json().then((function(t){e.dismounted||t&&(e.state.results||e.state.searching||e.setState({searchExamples:t.examples,showExamples:!0}))}))}))}},{key:"fetchRecentComments",value:function(){var e=this;return fetch("/api/comments/recent/home").then((function(t){if(200===t.status)return t.json().then((function(t){e.dismounted||t&&(e.state.results||e.state.searching||e.setState({recentComments:t,showRecentComments:!0}))}))}))}},{key:"stopSamplePlaceholderInterval",value:function(){this.placeholderSampleInterval&&window.clearInterval(this.placeholderSampleInterval)}},{key:"startSamplePlaceholderInterval",value:function(){var e=this;this.state.q||(this.currentPlaceholder=0,this.placeholderSampleInterval&&window.clearInterval(this.placeholderSampleInterval),this.placeholderSampleInterval=window.setInterval((function(){e.setNextSamplePlaceholder()}),3e3))}},{key:"setNextSamplePlaceholder",value:function(){var e=this;this.fillerInterval&&window.clearInterval(this.fillerInterval);var t=oe[++this.currentPlaceholder%oe.length],n=this.searchRef.current;if(n){var s=0;this.fillerInterval=setInterval((function(){t&&(n.placeholder=t.substring(0,++s),s>=t.length&&(clearInterval(e.fillerInterval),n.placeholder+="..."))}),10)}}},{key:"submitSearch",value:function(){var e=this.state.q.trim(),t=this.state.searchLanguage,n=this.state.searchYear,s=this.artistRef.current&&this.artistRef.current.value.trim();if(!s&&this.state.artistName?this.state.advancedSearch||(s=this.state.artistName):s&&!this.state.artistName&&this.setState({artistName:s}),e){var a="/q/".concat(encodeURIComponent(e));t&&"en"!==t&&(a+="?language=".concat(t)),n&&(a+=a.includes("?")?"&":"?",a+="year=".concat(n)),s&&(a+=a.includes("?")?"&":"?",a+="artist=".concat(encodeURIComponent(s)));var r=this.props.location.pathname;if(this.props.location.search&&(r+=this.props.location.search),a===r)return;this.props.history.push(a),this.startSearch(e,t,n,s),document.querySelector('input[type="search"]').blur(),this.state.autocompleteSuggestions&&this.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:!0}),this.state.autocompleteArtistSuggestions&&this.setState({autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1})}}},{key:"startSearch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;A({title:"Searching... - Song Search"}),r?this.setState({searching:!0,searchError:null},(function(){t.sendSearch(e,n,s,a,r,c)})):this.setState({searching:!0,searchError:null,results:null,by_name:null,showExamples:!1,showRecentComments:!1,parentSearch:null},(function(){t.sendSearch(e,n,s,a,r,c),t.slowSearchTimer=window.setTimeout((function(){t.state.searchError||t.state.results||t.setState({slowSearch:!0})}),5e3)}))}},{key:"sendSearch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o="/api/search?q=".concat(encodeURIComponent(e));return n&&(o+="&language=".concat(n)),s&&(o+="&year=".concat(s)),a&&(o+="&artist=".concat(encodeURIComponent(a))),r?(o+="&page=".concat(r+1),o+="&searched=".concat(this.searched)):this.state.originalQ&&(o+="&original=".concat(this.searched)),this.state.desperateSearch&&!this.state.originalQ&&(o+="&desperate=true"),c&&(o+="&example=".concat(c)),x(o).then((function(n){if(200===n.status)return n.json().then((function(n){if(t.slowSearchTimer&&window.clearTimeout(t.slowSearchTimer),!t.dismounted&&n){if(n.error)return t.setState({searchError:n.error,searching:!1,slowSearch:null}),void A({title:"Sorry, search error"});t.state.searchError&&t.setState({searchError:null}),A({title:"".concat(e," - Song Search")}),r||(t.searched=n.searched);try{localStorage.setItem("searched","".concat(n.searched,",").concat((new Date).getTime()))}catch(a){console.warn("'localStorage.setItem(\"searched\")' didn't work")}var s;r?(s=[],t.state.results.forEach((function(e){return s.push(e)})),n.results.forEach((function(e){return s.push(e)}))):s=n.results,t.setState({desperateSearch:n.desperate,missing:n.missing,popularityFactor:n.popularity_factor,parentSearch:n.searched,searching:!1,results:s,keyPhrases:null,by_name:n.by_name,by_name_total:n.by_name_total,by_name_limit:n.by_name_limit,total:n.total,searchError:null,slowSearch:null},(function(){(t.state.desperateSearch||!t.state.total)&&t.state.q.length>10&&t._fetchSearchAlternatives()}))}}));n.text().then((function(e){A({title:"Search Error"}),t.setState({searching:!1,searchError:{status:n.status,text:e},slowSearch:!1})}))}))}},{key:"fetchAutocompleteSuggestions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=e.trim(),a="/api/search/autocomplete?q=".concat(encodeURIComponent(e));n&&(s+=n.trim(),a+="&language=".concat(n));var r=this._autocompleteSuggestionsCache[s];return r?Promise.resolve(r).then((function(e){t.setState({autocompleteSuggestions:e.matches,autocompleteSearchSuggestions:e.search_suggestions,autocompleteHighlight:-1,missing:e.missing})})):(this.autocompleteWaitingFor=e,fetch(a).then((function(n){if(200===n.status)return n.json().then((function(n){t.dismounted||e.startsWith(t.autocompleteWaitingFor)&&(t._autocompleteSuggestionsCache[s]=n,t.state.q&&t.setState({autocompleteSuggestions:n.matches,autocompleteSearchSuggestions:n.search_suggestions,autocompleteHighlight:-1}))}))})))}},{key:"fetchAutocompleteArtistSuggestions",value:function(e){var t=this,n="/api/search/autocomplete?q=".concat(e,"&artist=true");return fetch(n).then((function(e){if(200===e.status)return e.json()})).then((function(e){t.dismounted||e&&t.setState({autocompleteArtistSuggestions:e.matches,autocompleteArtistHighlight:-1})}))}},{key:"loadSearchAggregates",value:function(){var e=this;return fetch("/api/search/aggregates").then((function(t){200===t.status&&t.json().then((function(t){e.setState({searchLanguages:t.languages,searchYears:t.years})}))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.redirectTo,s=t.searchYear;if(n)return Object(O.jsx)(j.a,{to:n,push:!0});var a=null,r=null;if(this.state.results){var c=this.state.results;if(this.state.onlyResults){var o=this.state.onlyResults.map((function(e){return e.id}));c=c.filter((function(e){return o.includes(e.id)}))}a=Object(O.jsx)(we,{results:c,searched:this.searched,popularityFactor:this.state.popularityFactor,showYear:Boolean(s)}),this.state.results.length<this.state.total&&(r=Object(O.jsx)(Ie,{location:this.props.location,page:this.state.resultsPageIndex,onLoadMore:this.onLoadMore}))}var i=null;this.state.by_name&&this.state.by_name.length&&(i=Object(O.jsx)(Ee,{results:this.state.by_name,total:this.state.by_name_total,limit:this.state.by_name_limit,loadMoreByName:this.loadMoreByName}));var l=Object(O.jsxs)("span",{className:"help-block toggles",children:[this.state.results&&this.state.results.length?Object(O.jsx)("button",{type:"button",className:this.state.shareSearch?"btn btn-default btn-sm active":"btn btn-default btn-sm",onClick:this.toggleShareSearch,children:this.state.shareSearch?"Hide share search":"Share search results"}):null,Object(O.jsx)("button",{type:"button",className:this.state.advancedSearch?"btn btn-default btn-sm active":"btn btn-default btn-sm",onClick:this.toggleAdvancedSearch,children:this.state.advancedSearch?"Hide search options":"Search options"})]}),u=null;if(!this.state.advancedSearch){var m=[];if(this.state.searchLanguage&&"en"!==this.state.searchLanguage){var h=this.state.searchLanguages.filter((function(t){return t.code===e.state.searchLanguage}))[0].language;m.push("Language: ".concat(h))}this.state.searchYear&&m.push("Years: ".concat(this.displayYears(parseInt(this.state.searchYear)))),this.state.artistName&&m.push("Artist: ".concat(this.state.artistName)),m.length&&(u=Object(O.jsxs)("span",{className:"help-block advanced-search-status",children:[Object(O.jsx)("b",{children:"Search options:"})," ",m.join(", ")]}))}var d=null;this.state.advancedSearch&&(d=Object(O.jsxs)("div",{className:"advanced",children:[Object(O.jsxs)("div",{className:"form-group",style:{position:"relative"},children:[Object(O.jsx)("input",{type:"search",ref:this.artistRef,value:this.state.artistName,className:"form-control input-lg",maxLength:100,onFocus:this.onFocusArtist,onBlur:this.onBlurArtist,onChange:this.onChangeArtistName,onKeyDown:this.onKeyDownArtistSearch,"aria-label":"Artist search",placeholder:"Artist or band name"}),this.state.autocompleteArtistSuggestions&&this.state.showAutocompleteArtistSuggestions?Object(O.jsx)(ge,{onSelectSuggestion:this.onSelectArtistSuggestion,highlight:this.state.autocompleteArtistHighlight,suggestions:this.state.autocompleteArtistSuggestions}):null]}),Object(O.jsx)("div",{className:"form-group",children:Object(O.jsxs)("select",{ref:this.languageRef,onChange:this.onChangeLanguage,value:this.state.searchLanguage,className:"form-control",children:[Object(O.jsx)("option",{value:"",children:"Any language"}),this.state.searchLanguages.map((function(e){var t=e.language;return 1===e.count?t+=" (1 song)":e.count&&(t+=" (".concat(e.count.toLocaleString()," songs)")),Object(O.jsx)("option",{value:e.code,children:t},e.code)}))]})}),Object(O.jsx)("div",{className:"form-group",children:Object(O.jsxs)("select",{onChange:this.onChangeYear,value:this.state.searchYear,className:"form-control",children:[Object(O.jsx)("option",{value:"",children:"Any year"}),this.state.searchYears.map((function(t){var n=e.displayYears(t.year);return 1===t.count?n+=" (1 song)":t.count&&(n+=" (".concat(t.count.toLocaleString()," songs)")),Object(O.jsx)("option",{value:t.year,children:n},n)}))]})}),Object(O.jsx)("div",{className:"form-group text-right",children:Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Search Now"})})]}));var b=null;return this.state.results&&this.state.keyPhrases&&this.state.keyPhrases.length&&(b=Object(O.jsx)(de,{nothingFound:!this.state.results.length,phrases:this.state.keyPhrases,submitPhrase:this.submitPhrase})),Object(O.jsxs)("div",{children:[Object(O.jsxs)("form",{onSubmit:this.onSubmit,action:"/api/search/redirect",children:[Object(O.jsxs)("div",{className:"form-group",style:{position:"relative"},children:[Object(O.jsxs)("div",{className:"input-group input-group-lg",children:[Object(O.jsx)("input",{type:"search",ref:this.searchRef,name:"q",autoComplete:"off",value:this.state.q,onFocus:this.onFocusSearch,onBlur:this.onBlurSearch,onChange:this.onChangeSearch,onKeyDown:this.onKeyDownSearch,className:"form-control",maxLength:150,"aria-label":"Lyrics search",placeholder:this.state.placeholder}),Object(O.jsx)("span",{className:"input-group-btn",children:Object(O.jsx)("button",{className:"btn btn-default btn-lg",type:"submit",title:"Click to search",children:"Search"})})]}),this.state.searchMaxLength?Object(O.jsx)(fe,{length:this.state.searchMaxLength[0],maxLength:this.state.searchMaxLength[1]}):null,!(this.state.desperateSearch&&this.state.results&&this.state.results.length)||this.state.showAutocompleteSuggestions&&this.state.autocompleteSuggestions?null:Object(O.jsx)(xe,{}),this.state.desperateSearch||!this.state.missing||!this.state.results||!this.state.results.length||this.state.showAutocompleteSuggestions&&this.state.autocompleteSuggestions?null:Object(O.jsx)(Oe,{missing:this.state.missing}),this.state.autocompleteSuggestions&&this.state.showAutocompleteSuggestions?Object(O.jsx)(je,{q:this.state.q,onSelectSuggestion:this.onSelectSuggestion,onSelectSuggestionAll:this.onSelectSuggestionAll,highlight:this.state.autocompleteHighlight,suggestions:this.state.autocompleteSuggestions,searchSuggestions:this.state.autocompleteSearchSuggestions}):null]}),Object(O.jsx)(me,{results:this.state.results,total:this.state.total,byName:this.state.by_name,onlyResults:this.state.onlyResults}),l,u,this.state.shareSearch?Object(O.jsx)(he,{searched:this.searched}):null,d]}),Object(O.jsx)("div",{id:"waldo-tag-11815",children:Object(O.jsxs)("script",{children:['googletag.cmd.push(function() {\n              googletag.display = "waldo-tag-11815";\n            })',";"]})}),this.state.searchError?Object(O.jsx)(ye,{error:this.state.searchError}):null,this.state.showExamples?Object(O.jsx)(ve,{sampleSearch:this.sampleSearch,examples:this.state.searchExamples}):null,this.state.showRecentComments&&this.state.recentComments?Object(O.jsx)(ue,{comments:this.state.recentComments.comments}):null,i,b,a,this.state.searching?Object(O.jsx)(T,{text:"Searching..."}):null,r,this.state.slowSearch?Object(O.jsx)(Se,{reloadSearch:this.reloadSearch}):null]})}}]),n}(a.a.Component),le=ie,ue=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this.props.comments;return Object(O.jsxs)("div",{className:"recent-comments",style:{marginTop:50},children:[Object(O.jsxs)("h4",{children:["Recent Comments (",Object(O.jsx)(o.b,{to:"/comments",children:"All"}),")"]}),Object(O.jsx)(ne,{comments:e,isRoot:!0}),Object(O.jsx)("div",{className:"load-more",children:Object(O.jsx)(o.b,{to:"/comments",children:"More recent comments"})})]})}}]),n}(a.a.PureComponent),me=a.a.memo((function(e){var t=e.results,n=e.total,s=e.onlyResults,a=e.byName;if(!t)return null;var r=null;if(t){var c=a?a.length:0;r=s?s.length+c:t.length+c}return Object(O.jsxs)("p",{className:"result-metadata text-right",children:[Object(O.jsxs)("b",{children:[n>=1e4?"More than ":"",n.toLocaleString()," ",1===n?"song found":"songs found"]})," ",r&&r<n?"(showing ".concat(r,")"):null]})})),he=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),c=0;c<s;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={copied:!1,failed:!1,hasFocused:!1},e.absurlRef=a.a.createRef(),e}return Object(m.a)(n,[{key:"render",value:function(){var e=this,t=window.location.href;return Object(O.jsxs)("div",{className:"form-group",style:{marginTop:30},children:[Object(O.jsxs)("div",{className:"input-group",children:[Object(O.jsx)("label",{className:"sr-only",children:"URL:"}),Object(O.jsx)("input",{ref:this.absurlRef,type:"text",className:"form-control",readOnly:!0,value:t,onFocus:function(){e.state.hasFocused||(e.absurlRef.current.select(),e.setState({hasFocused:!0}))}}),Object(O.jsx)("span",{className:"input-group-btn",children:Object(O.jsx)("button",{type:"button",className:this.state.copied?"btn btn-success":"btn btn-primary",title:"Click to copy to clipboard",onClick:function(n){n.preventDefault(),e.absurlRef.current.select(),g()(t)?e.setState({copied:!0,failed:!1},(function(){e.props.searched&&!e.copied&&(e.copied=e.props.searched,fetch("/api/search/copied/".concat(e.props.searched),{method:"POST"}))})):e.setState({copied:!1,failed:!0})},children:this.state.copied?"Copied to clipboard":"Copy to clipboard"})})]}),this.state.copied?Object(O.jsx)("p",{children:"The URL to this search has now been copied to your clipboard so you can paste it anywhere. Thanks!"}):null]})}}]),n}(a.a.PureComponent),de=a.a.memo((function(e){var t=e.phrases,n=e.submitPhrase,s=e.nothingFound,a=null;return s&&(a=1===t.length?Object(O.jsx)("h4",{children:"But, try this..."}):Object(O.jsx)("h4",{children:"But, try these..."})),Object(O.jsxs)("div",{className:"key-phrases",children:[s?Object(O.jsx)("h3",{children:"Nothing found"}):Object(O.jsx)("h3",{children:"Fuzzy results. Try breaking it up..."}),a,Object(O.jsx)("table",{className:"table suggestions table-condensed",children:Object(O.jsx)("tbody",{children:t.map((function(e){var t="/q/".concat(e.phrase);return e.year&&(t+="?year=".concat(e.year)),Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("a",{href:t,onClick:function(t){return n(t,e)},children:e.diff_html?Object(O.jsx)("span",{dangerouslySetInnerHTML:{__html:e.diff_html}}):e.phrase})}),Object(O.jsxs)("td",{children:[Object(O.jsx)("b",{children:e.total})," ",1===e.total?"song":"songs"]})]},e.phrase)}))})})]})})),je=a.a.memo((function(e){var t=e.q,n=e.highlight,s=e.suggestions,a=e.searchSuggestions,r=e.onSelectSuggestion,c=e.onSelectSuggestionAll;return s.length?Object(O.jsx)("div",{className:"autocomplete",children:Object(O.jsxs)("ul",{children:[a&&t&&a.total?Object(O.jsxs)("li",{onClick:c,className:0===n?"active search-suggestion":"search-suggestion",children:[a.capped?Object(O.jsxs)("a",{style:{float:"right"},href:"/q/"+encodeURIComponent(a.term),children:[a.total.toLocaleString()," ",a.desperate?"approximate matches":"good matches"]}):null,Object(O.jsxs)("a",{href:"/q/"+encodeURIComponent(a.term),children:["Search for ",Object(O.jsx)("i",{children:t})]})]}):null,s.map((function(e,t){var s=t+1===n?"active":"";return Object(O.jsx)("li",{className:s,onClick:function(t){return r(t,e)},children:e.id?Object(O.jsx)(pe,{song:e}):Object(O.jsx)(be,{text:e.text,html:e.html,found:e.found})},e.id?e.id:e.text)}))]})}):null})),be=a.a.memo((function(e){var t=e.found,n=e.html;return t?Object(O.jsxs)("p",{className:"search",children:[Object(O.jsx)("small",{children:t}),Object(O.jsx)("span",{dangerouslySetInnerHTML:{__html:n}})]}):Object(O.jsx)("p",{className:"search",dangerouslySetInnerHTML:{__html:n}})})),pe=a.a.memo((function(e){var t=e.song,n=re;return t.image&&(n=t.image.thumbnail100?t.image.thumbnail100:t.image.url),Object(O.jsxs)("div",{className:"media autocomplete-suggestion-song",children:[Object(O.jsx)("div",{className:"media-left",children:Object(O.jsx)(ke,{url:n,name:t.name})}),Object(O.jsxs)("div",{className:"media-body",children:[Object(O.jsxs)("h5",{className:"artist-name",children:[Object(O.jsx)("b",{children:t.name}),Object(O.jsx)("span",{className:"by",children:" by "}),t.artist.name]}),t.fragments.map((function(e,n){return Object(O.jsx)("p",{dangerouslySetInnerHTML:{__html:e}},"".concat(t.id,":").concat(n))}))]})]})})),ge=a.a.memo((function(e){var t=e.highlight,n=e.suggestions,s=e.onSelectSuggestion;return n.length?Object(O.jsx)("div",{className:"autocomplete",children:Object(O.jsx)("ul",{children:n.map((function(e,n){var a=n===t?"active":"";return Object(O.jsx)("li",{className:a,onClick:function(t){return s(t,e)},children:Object(O.jsxs)("div",{className:"media",children:[Object(O.jsx)("div",{className:"media-left",children:Object(O.jsx)(ke,{url:e.thumbnail100||e.image||re,name:e.text})}),Object(O.jsxs)("div",{className:"media-body",children:[Object(O.jsx)("h5",{className:"artist-name",dangerouslySetInnerHTML:{__html:e.html}}),Object(O.jsxs)("span",{className:"artist-metadata",children:[e.songs?e.songs:"0"," songs"]})]})]})},"".concat(e.text).concat(n))}))})}):null}));function fe(e){var t=e.length,n=e.maxLength,s="help-block maxlength";return t===n&&(s+=" danger"),Object(O.jsxs)("span",{className:s,children:[t," of max ",n," characters!"]})}function xe(){return Object(O.jsxs)("span",{className:"help-block warning",children:[Object(O.jsx)("b",{children:"Note!"})," Nothing could be found with that exact search. Showing fuzzy matches."]})}function Oe(e){var t=e.missing;return Object(O.jsxs)("span",{className:"help-block warning",children:[Object(O.jsx)("b",{children:"Note!"})," Results found by discarding"," ",Object(O.jsx)("i",{style:{textDecoration:"line-through"},children:t}),"."]})}var ve=a.a.memo((function(e){var t=e.sampleSearch,n=e.examples;return Object(O.jsxs)("div",{className:"examples",children:[Object(O.jsx)("h4",{children:"Successful searches for songs by lyrics"}),Object(O.jsx)("ul",{children:n.map((function(e){var n="/q/"+encodeURIComponent(e.term);n+="?example=".concat(e.id),e.artist&&(n+="&artist=".concat(encodeURIComponent(e.artist))),e.language&&(n+="&language=".concat(encodeURIComponent(e.language))),e.year&&(n+="&year=".concat(e.year));var s=null,r=[];return e.artist&&r.push(["artist",e.artist]),e.language&&r.push(["language",e.language_human]),e.year&&r.push(["year",e.year]),r.length&&(s=Object(O.jsxs)("span",{children:["(",r.map((function(e,t){return Object(O.jsxs)(a.a.Fragment,{children:[e[0]," ",Object(O.jsx)("b",{children:e[1]}),t+1<r.length?", ":""]},e[0])})),")"]})),Object(O.jsxs)("li",{children:[Object(O.jsx)(o.b,{to:n,onClick:function(n){return t(n,e)},children:Object(O.jsx)("b",{children:e.term})})," ",s," ",Object(O.jsxs)("i",{children:[e.total_found," found"]}),Object(O.jsx)("br",{}),e.opened.map((function(e){return Object(O.jsxs)("span",{className:"opened",children:["clicked on"," ",Object(O.jsxs)(o.b,{to:e._url,children:[Object(O.jsx)("b",{children:e.name})," by ",Object(O.jsx)("b",{children:e.artist.name})]})]},e.id)}))]},e.id)}))})]})}));function Se(e){var t=e.reloadSearch;return Object(O.jsxs)("div",{className:"slow-search",children:[Object(O.jsx)("h4",{children:"Sorry, search seems to take longer than normal!"}),Object(O.jsxs)("p",{children:["Perhaps it got stuck? ",Object(O.jsx)("br",{}),Object(O.jsx)("button",{type:"button",className:"btn btn-default btn-sm",onClick:t,children:"Reload search"})]})]})}function ye(e){var t=e.error;return Object(O.jsxs)("div",{className:"search-error",children:[Object(O.jsx)("h4",{children:"Sorry, an error occured"}),400===t.status?Object(O.jsxs)("p",{children:["The query was invalid ",Object(O.jsx)("code",{children:t.text})]}):Object(O.jsx)("p",{children:"The server basically failed to compute the search"}),t.status>=500&&Object(O.jsx)("p",{children:"Perhaps simply try again a little later."}),t.status>=500&&Object(O.jsx)("p",{children:Object(O.jsx)("button",{type:"button",className:"btn btn-default",onClick:function(e){window.location.reload(!0)},children:"Reload to try again"})})]})}var we=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).firstLoad=!0,e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){k||M(),this.firstLoad=!1}},{key:"componentDidUpdate",value:function(e){k||e.results===this.props.results||M()}},{key:"render",value:function(){var e=this,t=this.props,n=t.results,s=t.searched,a=t.popularityFactor,r=t.showYear;return Object(O.jsxs)("div",{children:[ce?Object(O.jsx)("span",{id:"_nocardonads"}):Object(O.jsx)("div",{id:"carbonadsouter"}),Object(O.jsx)("div",{className:"results",children:n.map((function(t,c){return Object(O.jsx)(Ce,{result:t,searched:s,expandedByDefault:1===n.length,firstResult:0===c,popularityFactor:a,firstLoad:e.firstLoad,showYear:r},t.id)}))})]})}}]),n}(a.a.PureComponent),Ce=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={collapsed:!0,itunes:null,amazon:null,textHtml:e.props.result.text_html},e.affiliateLookupStarted=[],e.onExpandClick=function(t){t.preventDefault(),e.expand()},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.props.expandedByDefault&&this.expand()}},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"expand",value:function(){var e=this,t=this.state.collapsed;this.setState({collapsed:!1}),this.fetchTextHTML().then((function(){if(t&&e.props.searched){var n="/api/song/".concat(e.props.result.id,"/");n+="expand/".concat(e.props.searched),fetch(n,{method:"POST"}).then((function(e){return e.json()})).then((function(e){}))}}))}},{key:"fetchTextHTML",value:function(){var e=this;if(this.state.textHtml)return Promise.resolve();var t="/api/song/".concat(this.props.result.id,"?text_only=true");return fetch(t).then((function(e){return e.json()})).then((function(t){e.dismounted||e.setState({textHtml:t.song.text_html})}))}},{key:"render",value:function(){var e=this.props,t=e.result,n=(e.popularityFactor,e.firstResult),s=e.firstLoad,a=e.showYear,r="result";this.state.collapsed&&(r+=" collapsed");var c,i=t._url;c=t.image?Object(O.jsx)(Ne,{url:t.image.url,className:"pull-right img-thumbnail album",name:t.image.name,forceLoad:n||!s}):Object(O.jsx)(Ne,{url:null,className:"pull-right img-thumbnail",name:t.artist.name,forceLoad:n||!s});var l=Object(O.jsxs)("p",{className:"read-more",children:[Object(O.jsx)(o.b,{to:i,children:"VIEW SONG"})," ",Object(O.jsx)(o.b,{to:i,onClick:this.onExpandClick,children:"EXPAND SONG"})]});if(!this.state.collapsed){var u=null,m=null;try{m=localStorage.getItem("searched")}catch(j){console.warn("'localStorage.getItem(\"searched\")' didn't work")}m&&(u=m.includes(",")?parseInt(m.split(",")[0],10):parseInt(m,10)),l=Object(O.jsx)("div",{className:"rest",children:Object(O.jsxs)("div",{className:"text",children:[Object(O.jsx)("h3",{children:"Full Text"}),this.state.textHtml?Object(O.jsx)(q,{text:this.state.textHtml}):Object(O.jsx)("i",{children:"Loading full text..."}),Object(O.jsx)(z,{comments:null,commentsCount:null,song:t,searchedId:u}),Object(O.jsx)(L,{song:t}),Object(O.jsx)("p",{className:"load-more",children:Object(O.jsx)(o.b,{to:i,children:"GO TO SONG PAGE"})})]})})}var h,d=Object(O.jsx)("b",{children:t.artist.name});return t.artist.fragment&&(d=Object(O.jsx)("b",{dangerouslySetInnerHTML:{__html:t.artist.fragment}})),h="Click to view just this song",Object(O.jsxs)("div",{className:r,children:[Object(O.jsxs)("div",{className:"head",children:[Object(O.jsx)(o.b,{to:i,children:c}),Object(O.jsxs)("h2",{title:h,children:[Object(O.jsx)(o.b,{to:i,children:t.name}),a&&t.year&&Object(O.jsxs)("span",{className:"year",children:[" ",t.year]}),null]}),Object(O.jsxs)("h3",{children:[Object(O.jsx)("span",{className:"by",children:"by"})," ",d]}),t.albums.length?Object(O.jsx)(Ae,{albums:t.albums}):null]}),Object(O.jsx)("div",{className:"fragments",children:t.fragments.map((function(e,n){return Object(O.jsx)("p",{dangerouslySetInnerHTML:{__html:e}},"".concat(t.id).concat(n))}))}),l]})}}]),n}(a.a.PureComponent),Ne=a.a.memo((function(e){var t=e.url,n=e.name,s=e.forceLoad,a=e.className;return t?Object(O.jsx)("img",{src:t,className:a,title:n,alt:n,loading:s?void 0:"lazy"}):Object(O.jsx)("img",{src:re,className:a,title:n,alt:n})}));k||((new Image).src=ae);var _e=new Set;function ke(e){var t=e.url,n=e.name,a=Object(s.useState)(_e.has(t)?t:ae),r=Object(i.a)(a,2),c=r[0],o=r[1];return Object(s.useEffect)((function(){var e=null,n=!1;if(c===ae){var s=function(){n||o(t),_e.add(t)};(e=new Image).src=t,e.decode?e.decode().then(s,s):e.onload=s,e.decoding="sync"}return function(){e&&(e.src=""),n=!0}}),[t,c]),t?Object(O.jsx)("img",{className:"img-rounded",src:c,alt:n,title:n}):Object(O.jsx)("img",{className:"img-rounded",src:ae,alt:n,title:n})}var Ee=a.a.memo((function(e){var t=e.results,n=e.total,s=e.limit,a=e.loadMoreByName;return Object(O.jsxs)("div",{className:"by-name",children:[Object(O.jsx)("h4",{children:"Songs by name"}),Object(O.jsx)("ul",{children:t.map((function(e){return Object(O.jsx)("li",{children:Object(O.jsxs)(o.b,{to:e._url,children:[Object(O.jsx)("b",{dangerouslySetInnerHTML:{__html:e.fragment}})," by"," ",Object(O.jsx)("b",{children:e.artist.name})]})},e.id)}))}),n>s?Object(O.jsx)("button",{className:"btn btn-default btn-sm",onClick:a,children:n>20?"Show more songs by name":"Show all (".concat(n,") songs by name")}):null]})})),Ae=a.a.memo((function(e){var t=e.albums;return Object(O.jsx)("p",{className:"albums",children:t.map((function(e,n){var s=[Object(O.jsx)("b",{children:e.name},e.id)];return e.year&&s.push(" (".concat(e.year,")")),n+1<t.length&&s.push(", "),s}))})})),Ie=a.a.memo((function(e){var t=e.location,n=e.onLoadMore,s=t.pathname+t.search;return Object(O.jsx)("div",{className:"load-more",children:Object(O.jsx)("a",{href:s,onClick:n,children:"LOAD MORE RESULTS"})})})),Te=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={serverError:null,totals:e.props.totalStats&&e.props.totalStats.totals||null},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(A({title:"About - Song Search"}),!this.state.totals)return x("/api/stats/totals-simple").then((function(t){if(t.ok)return t.json().then((function(t){t&&e.setState({serverError:null,totals:t.totals})}));e.setState({serverError:t})}))}},{key:"render",value:function(){var e=this.state,t=e.serverError,n=e.totals;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("p",{children:["Made by Peter Bengtsson",Object(O.jsx)("br",{}),"For all inquires email ",Object(O.jsx)("a",{href:"mailto:info@songsear.ch",children:" info@songsear.ch"})]}),t&&Object(O.jsx)(U,{}),n?Object(O.jsx)(Le,{numbers:n}):null]})}}]),n}(s.Component),Re=Te;function Le(e){var t=e.numbers;return Object(O.jsxs)("div",{className:"numbers",children:[Object(O.jsxs)("p",{children:["There are currently"," ",Object(O.jsxs)("b",{children:[Object(O.jsx)(R,{value:t.songs})," songs"]})," ","to search amongst"," ",Object(O.jsxs)("b",{children:[Object(O.jsx)(R,{value:t.artists})," artists"]})," ","in"," ",Object(O.jsxs)("b",{children:[Object(O.jsx)(R,{value:t.albums})," albums"]}),"."]}),Object(O.jsxs)("p",{children:["In total"," ",Object(O.jsxs)("b",{children:[Object(O.jsx)(R,{value:t.searches})," searches"]})," ","have been made."]})]})}var De=function(){Object(s.useEffect)((function(){document.title="Privacy Policy of Song Search"}));var e=Object(_.a)("".concat("","/static/privacy-policy-text.html"),function(){var e=Object(y.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=6;break}throw new Error("".concat(n.status," on ").concat(t));case 6:return e.next=8,n.text();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{revalidateOnFocus:!1}),t=e.data;return e.error?Object(O.jsx)(U,{}):Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"Privacy Policy"}),t?Object(O.jsx)("div",{dangerouslySetInnerHTML:{__html:t}}):Object(O.jsx)("p",{children:Object(O.jsx)("i",{children:"Loading privacy policy text..."})})]})},Fe=(n(51),"true"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_NO_ADS),Pe=function(e){return Object(s.useEffect)((function(){void 0===window.cf_async&&(window.cf_async=!1),document.getElementById("inject_ad");var t=Math.floor(999999999*Math.random()),n={artist:e.Artistname,song:e.Songname,adunit_id:100004858,div_id:"cf_async_"+t},s=document.createElement("div");s.setAttribute("id",n.div_id),document.getElementById("inject_ad").parentNode.setAttribute("id","ad_"+t),document.getElementById("ad_"+t).appendChild(s);var a=function(){cf.showAsyncAd(n)};if("undefined"!==typeof window.cf)a();else{cf_async=!0;var r=document.createElement("script"),c=document.getElementsByTagName("script")[0];r.async=!0,r.src="//srv.tunefindforfans.com/fruits/apricots.js",r.readyState?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(r.onreadystatechange=null,a())}:r.onload=a,c.parentNode.insertBefore(r,c)}}),[]),Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("div",{id:"inject_ad"})})},He=function(e){return Object(s.useEffect)((function(){void 0===window.ddcf_async&&(window.ddcf_async=!1),document.getElementById("inject_cf_ad");var t=Math.floor(999999999*Math.random()),n={cf_page_artist:e.Artistname,cf_page_song:e.Songname,cf_adunit_id:"100005466",cf_flex:!0,div_id:"cff_async_"+t},s=document.createElement("div");s.setAttribute("id",n.div_id),document.getElementById("inject_cf_ad").parentNode.setAttribute("id","cf_ad_"+t),document.getElementById("cf_ad_"+t).appendChild(s)}),[]),Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("div",{id:"inject_cf_ad"})})},Me=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={song:e.props.song||null,loading:!1,notFound:e.props.songNotFound||!1,serverError:null},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.match,t=parseInt(e.params.id,10);this.state.song&&this.state.song.id===t||this.props.songNotFound||this.loadSong(t)}},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.match.params.id!==e.match.params.id&&this.setState({song:null,loading:!1,notFound:!1,serverError:null},(function(){try{localStorage.removeItem("searched")}catch(e){console.warn("'localStorage.removeItem(\"searched\")' didn't work")}t.loadSong(t.props.match.params.id)}))}},{key:"loadSong",value:function(e){var t=this;A({title:"Loading... - Song Search"}),k||(this.showLoadingSoon=window.setTimeout((function(){t.dismounted||t.state.serverError||t.state.notFound||t.state.song||t.state.loading||t.setState({loading:!0})}),500));var n="/api/song/".concat(e),s=null;try{s=localStorage.getItem("searched")}catch(r){console.warn("'localStorage.getItem(\"searched\")' didn't work")}if(s){if(s.includes(",")){var a=parseInt(s.split(",")[1],10);s=((new Date).getTime()-a)/1e3>3600?null:s.split(",")[0]}s&&(n+="?searched=".concat(encodeURIComponent(s)))}return x(n).then((function(e){if(!k&&t.showLoadingSoon&&window.clearTimeout(t.showLoadingSoon),400===e.status)return e.json().then((function(e){t.setState({loading:!1}),e.error&&"redirected"===e.error?k?t.setState({notFound:!0}):document.location.href=e.new_url:t.setState({serverError:!0})}));if(404===e.status)t.setState({loading:!1,notFound:!0}),A({title:"Not Found"});else{if(500!==e.status)return e.json().then((function(e){return e&&!e.error?t.renderResult(e):e&&e.error&&console.log("ERROR:",e.error),e}));t.setState({loading:!1,serverError:!0}),A({title:"Song loading error :("})}}))}},{key:"renderResult",value:function(e){var t="".concat(e.song.name," lyrics by ").concat(e.song.artist.name);k||A({title:t,image:e.song.image}),this.setState({loading:!1,song:e.song})}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.song,s=e.serverError,a=e.notFound;return Object(O.jsxs)("div",{children:[t&&Object(O.jsx)(T,{text:"Loading..."}),n&&Object(O.jsx)(qe,{song:n}),s&&!n&&Object(O.jsx)(U,{}),a&&Object(O.jsx)(Ke,{})]})}}]),n}(a.a.Component);function qe(e){var t,n=e.song;if(!k){var s=null;try{s=localStorage.getItem("searched")}catch(c){console.warn("'localStorage.getItem(\"searched\")' didn't work")}s&&(t=s.includes(",")?parseInt(s.split(",")[0],10):parseInt(s,10))}var a=null,r=null;return n.comments&&(a=n.comments.comments,r=n.comments.comments_count),Object(O.jsxs)("div",{className:"new-add",children:[Object(O.jsx)(He,{Songname:n.name,Artistname:n.artist.name}),Object(O.jsxs)("div",{className:"result song oka",children:[Object(O.jsx)(Ye,{song:n}),Object(O.jsx)(q,{song:n.id,text:n.text_html}),!Fe&&Object(O.jsx)(Be,{song:n}),Object(O.jsx)(z,{comments:a,commentsCount:r,song:n,searchedId:t}),Object(O.jsx)(Ue,{song:n}),Object(O.jsx)(L,{song:n}),k?null:Object(O.jsx)(H,{render:function(){return Object(O.jsx)(F,{song:n})}}),k?null:Object(O.jsx)(H,{render:function(){return Object(O.jsx)(P,{song:n})}}),k?null:Object(O.jsx)(We,{song:n})]})]})}function Be(e){var t=e.song;return Object(s.useEffect)((function(){!function(e){var t=e.song,n=e.artist,s=document.getElementById("amplifiedouter");if(s&&!s.querySelector("script")){window.amplified=window.amplified||{init:[]},window.amplified.init.push((function(){amplified.setParams({artist:n,song:t}),amplified.pushAdUnit(100003500),amplified.run()}));var a=document.createElement("script");a.id="_amplified_js",a.src="https://srv.clickfuse.com/ads/ads.js",a.async=!0,s.appendChild(a)}}({song:t.name,artist:t.artist.name})}),[t]),Object(O.jsx)("div",{id:"amplifiedouter",children:Object(O.jsx)("div",{id:"amplified_100003500"})})}function Ue(e){var t=e.song,n=Object(s.useState)(!1),a=Object(i.a)(n,2),r=a[0],c=a[1],o=Object(s.useState)(!1),l=Object(i.a)(o,2),u=l[0],m=l[1],h=Object(s.useState)(null),d=Object(i.a)(h,2),j=d[0],b=d[1];return Object(s.useEffect)((function(){navigator.share&&c(!0)}),[]),r?Object(O.jsxs)("div",{style:{margin:"30px 0",textAlign:"center"},children:[Object(O.jsx)("button",{className:"btn btn-primary",onClick:function(){var e={title:t.name,text:"I found '".concat(t.name,"' on Song Search!"),url:window.location.href};try{navigator.share(e).then((function(){m(!0),b(null)})).catch((function(e){b(e)})).finally((function(){fetch("/api/song/".concat(t.id,"/shared/"),{method:"POST"})}))}catch(n){b(n)}},children:u?"Thanks!":"Share this song"}),j&&Object(O.jsx)("p",{children:"Sharing failed or was canceled. Oh well."})]}):null}var Ye=a.a.memo((function(e){var t=e.song,n=null;n=t.image?Object(O.jsx)("img",{src:t.image.url,alt:t.image.name,className:"song-picture"}):Object(O.jsx)("img",{src:"/static/placeholder.png",alt:t.artist.name,width:150,height:150});var s=null;if(t.albums.length){var a=t.albums.map((function(e){return e.year?"".concat(e.name," (").concat(e.year,")"):e.name})).join(", ");s=Object(O.jsxs)("h3",{children:[Object(O.jsx)("span",{className:"by",children:"on"})," ",a]})}return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("div",{className:"text-center last",children:[n,Object(O.jsx)("h2",{className:"",children:t.name}),Object(O.jsxs)("h3",{children:[Object(O.jsx)("span",{className:"by",children:"by"})," ",t.artist.name]}),s,Object(O.jsx)(Pe,{Songname:t.name,Artistname:t.artist.name})]})})})),We=a.a.memo((function(e){var t=e.song,n=Object(s.useState)(null),r=Object(i.a)(n,2),c=r[0],o=r[1],l=Object(s.useState)(!1),u=Object(i.a)(l,2),m=u[0],h=u[1],d=a.a.useRef(!1);Object(s.useEffect)((function(){m&&c&&h(!1)}),[c,m]);var j=Object(s.useRef)();function b(){j.current||(j.current=(new Date).getTime(),function(){var e="/api/song/".concat(t.id,"/related");x(e).then((function(e){e.ok&&e.json().then((function(e){e&&e.categories&&o(e.categories)}))}))}())}return Object(s.useEffect)((function(){return d.current=!0,function(){d.current=!1}}),[]),c?c.length?Object(O.jsx)("div",{className:"related",children:c.map((function(e){return Object(O.jsx)(ze,{label:e.label,songs:e.results},e.label)}))}):null:m?null:Object(O.jsx)(N.a,{onEnter:function(){c||m||b()}})}));function ze(e){var t=e.label,n=e.songs;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{children:t}),Object(O.jsx)("ul",{children:n.map((function(e){return Object(O.jsx)("li",{children:Object(O.jsxs)(o.b,{to:e._url,children:[Object(O.jsx)("b",{children:e.name})," ",Object(O.jsx)("span",{className:"by",children:"by"})," ",e.artist.name]})},e.id)}))})]})}function Ke(){return Object(O.jsxs)("div",{className:"not-found",children:[Object(O.jsx)("h3",{children:"Song Not Found"}),Object(O.jsx)("p",{children:Object(O.jsx)("img",{alt:"Skull",src:"/static/skull.png"})}),Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:"/",children:"Try another search"})})]})}var Ge=Me,Ve=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={error:null,submittedErrorId:null},e}return Object(m.a)(n,[{key:"componentDidCatch",value:function(){var e=Object(y.a)(S.a.mark((function e(t,n){var s,a,r,c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(s=new FormData).append("error",t.toString()),s.append("error_info",JSON.stringify(n)),s.append("url",document.location.href),s.append("stack",t.stack);try{localStorage.getItem("searched")&&s.append("searched",localStorage.getItem("searched")),localStorage.getItem("commentEmail")&&s.append("commentEmail",localStorage.getItem("commentEmail"))}catch(o){console.log("Unable to extract localStorage keys")}return e.prev=6,e.next=9,fetch("/api/errorboundary",{method:"POST",body:s});case 9:if(!(a=e.sent).ok){e.next=18;break}return e.next=13,a.json();case 13:r=e.sent,c=r.id,this.setState({submittedErrorId:c}),e.next=20;break;case 18:console.log("Bad response trying to store error boundary."),console.error(a);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(6),console.log("Unable to send error info to server."),console.error(e.t0);case 26:case"end":return e.stop()}}),e,this,[[6,22]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?Object(O.jsxs)("div",{style:{textAlign:"center"},children:[Object(O.jsx)("h3",{style:{color:"#b12704"},children:"Application Error"}),Object(O.jsx)("p",{children:Object(O.jsx)("img",{alt:"Skull",src:"/static/skull.png"})}),Object(O.jsxs)("p",{children:[Object(O.jsx)("b",{children:"Soooo sorry!"}),Object(O.jsx)("br",{}),"It appears the application encountered a crash trying to render this page.",Object(O.jsx)("br",{}),"Please try again later or ",Object(O.jsx)("a",{href:"/",children:"try another search"}),"."]}),Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:Object(O.jsx)("a",{href:"/",children:"Return to home page"})})}),this.state.submittedErrorId&&Object(O.jsxs)("p",{children:["Your error has been submitted to our server. ",Object(O.jsx)("br",{}),"Submission ID: ",Object(O.jsx)("code",{children:this.state.submittedErrorId})]})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(a.a.Component),Je=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={loading:!1,comment:null,muted:!1,notFound:!1,serverError:null},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=Object(y.a)(S.a.mark((function e(){var t,n,s,a,r=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A({title:"Mute Comment - Song Search"}),window.setTimeout((function(){var e=r.state,t=e.comment,n=e.loading,s=e.notFound,a=e.serverError;r.dismounted||t||n||s||a||r.setState({loading:!0})}),1e3),t=new FormData,n=this.props.match,t.append("oid",n.params.oid),t.append("id",n.params.id),e.prev=6,e.next=9,fetch("/api/comments/mute",{method:"POST",body:t});case 9:s=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),this.setState({serverError:e.t0,loading:!1});case 15:if(!s.ok){e.next=22;break}return e.next=18,s.json();case 18:a=e.sent,this.setState({comment:a.comment,muted:!0,notFound:!1,loading:!1,serverError:null},(function(){A({title:"Comment Muted - Song Search"})})),e.next=23;break;case 22:400===s.status?this.setState({comment:null,notFound:!0,loading:!1,serverError:null},(function(){A({title:"Comment Not Found - Song Search"})})):this.setState({serverError:s,loading:!1});case 23:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.comment,s=e.muted,a=e.notFound,r=e.serverError;return t?Object(O.jsx)(T,{text:"One sec..."}):r?Object(O.jsx)(U,{}):Object(O.jsxs)("div",{children:[s&&Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"Comment Muted"}),Object(O.jsx)("p",{children:"You will not receive any more email notifications to replies on this comment."}),Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:"/",children:"Go back to the Home page"})})]}),a&&Object(O.jsx)($e,{}),n&&Object(O.jsx)(Xe,{comment:n})]})}}]),n}(a.a.Component),Qe=Je;function $e(){return Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"Comment Not Found"}),Object(O.jsx)("p",{children:"Sorry, but the instructions to mute this particular comment could not be found."}),Object(O.jsx)("p",{children:Object(O.jsx)(o.b,{to:"/",children:"Go back to the Home page"})})]})}function Xe(e){var t=e.comment;return Object(O.jsxs)("div",{style:{marginTop:70},children:[t.song&&Object(O.jsxs)("h4",{style:{marginBottom:20},children:["Song:"," ",Object(O.jsxs)("a",{href:"".concat(t.song._url,"#c").concat(t.id),children:[Object(O.jsx)("b",{children:t.song.name})," ",Object(O.jsx)("span",{className:"by",children:"by"})," ",Object(O.jsx)("b",{children:t.song.artist.name})]})]}),Object(O.jsx)("h4",{children:"Comment:"}),Object(O.jsx)("blockquote",{dangerouslySetInnerHTML:{__html:t.text_rendered}}),Object(O.jsxs)("p",{children:["Posted ",Object(O.jsx)(B,{date:t.created})]})]})}function Ze(e){var t=e.location;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"Page Not Found"}),Object(O.jsxs)("h3",{children:["No match for ",Object(O.jsx)("code",{children:t.pathname})]})]})}var et=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this.props,t=e.song,n=e.related,s=e.songNotFound,a=e.results,r=e.totalStats,c=e.searchExamples,i=e.recentComments,u=e.recentCommentsHomepage,m=!1;return k?t&&(m=!0):/\/song\//.test(window.location.pathname)&&(m=!0),Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"container",children:[Object(O.jsxs)("div",{className:"page-header",children:[Object(O.jsx)("h1",{children:Object(O.jsx)(o.b,{to:"/",children:"Song Search"})}),m?Object(O.jsx)("h5",{className:"home-link",children:Object(O.jsx)(o.b,{to:"/",children:"Try another search"})}):Object(O.jsx)(st,{})]}),Object(O.jsx)("div",{className:"container children",children:Object(O.jsx)(Ve,{children:Object(O.jsxs)(j.d,{children:[Object(O.jsx)(j.b,{exact:!0,path:"/",render:function(e){return Object(O.jsx)(le,Object(l.a)(Object(l.a)({},e),{},{searchExamples:c,recentComments:u}))}}),Object(O.jsx)(j.b,{path:"/q/:q",render:function(e){return Object(O.jsx)(le,Object(l.a)(Object(l.a)({},e),{},{results:a}))}}),Object(O.jsx)(j.b,{path:"/song/:artist/:name/:id",render:function(e){return Object(O.jsx)(Ge,Object(l.a)(Object(l.a)({},e),{},{song:t,related:n,songNotFound:s}))}}),Object(O.jsx)(j.b,{path:"/about",render:function(e){return Object(O.jsx)(Re,Object(l.a)(Object(l.a)({},e),{},{totalStats:r}))}}),Object(O.jsx)(j.b,{path:"/privacy",component:De}),Object(O.jsx)(j.b,{path:"/comments",exact:!0,render:function(e){return Object(O.jsx)(te,Object(l.a)(Object(l.a)({},e),{},{recentComments:i}))}}),Object(O.jsx)(j.b,{path:"/comments/p:page",render:function(e){return Object(O.jsx)(te,Object(l.a)(Object(l.a)({},e),{},{recentComments:i}))}}),Object(O.jsx)(j.b,{path:"/mute/:oid/:id",render:function(e){return Object(O.jsx)(Qe,Object(l.a)({},e))}}),Object(O.jsx)(j.b,{component:Ze})]})})})]}),Object(O.jsx)("footer",{className:"footer",children:Object(O.jsx)("div",{className:"container",children:Object(O.jsxs)("p",{className:"text-muted",children:[Object(O.jsx)(o.b,{to:"/",children:"Home"})," \u2022 ",Object(O.jsx)(o.b,{to:"/comments",children:"Recent comments"})," \u2022 ",Object(O.jsx)(o.b,{to:"/about",children:"About this site"})," \u2022 ",Object(O.jsx)(o.b,{to:"/privacy",children:"Privacy Policy"}),null]})})})]})}}]),n}(a.a.Component),tt=et,nt=["I'm looking for a song that I heard.","I'm looking for a song I don't know the name of.","I'm looking for a song that goes like this.","Looking for a song I don't know the name of.","Find me a song by lyrics."];function st(){var e=Object(s.useState)(nt[0]),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(s.useEffect)((function(){var e=!1;return function t(){setTimeout((function(){if(!e){var s=(nt.indexOf(n)+1)%nt.length;a(nt[s]),t()}}),1e4)}(),function(){e=!0}}),[n]),Object(O.jsxs)("h5",{children:["\u201c",n,"\u201d"]})}!function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),s=[e[n],e[t]];e[t]=s[0],e[n]=s[1]}}(nt);var at=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function rt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(52),n(53),n(54),n(55),n(56),n(57);var ct=document.getElementById("root"),ot=Object(O.jsx)(o.a,{children:Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(tt,{song:window.__song__,related:window.__related__,results:window.__results__,songNotFound:window.__songNotFound__,totalStats:window.__totalStats__,searchExamples:window.__searchExamples__,recentComments:window.__recentComments__,recentCommentsHomepage:window.__recentCommentsHomepage__})})});ct.firstElementChild?"https://translate.googleusercontent.com"!==window.origin&&c.a.hydrate(ot,ct):c.a.render(ot,ct),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");at?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var s=n.headers.get("content-type");404===n.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):rt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):rt(t,e)}))}}()}},[[58,1,2]]]);
//# sourceMappingURL=main.5403c96d.chunk.js.map